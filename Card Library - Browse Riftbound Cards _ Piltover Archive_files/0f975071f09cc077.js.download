(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,722777,928976,542664,942040,e=>{"use strict";let t,r;e.s(["useStackApp",()=>eK,"useUser",()=>eM],722777);var i=e.i(106772);e.s(["StackContext",()=>eD,"StackProviderClient",()=>eF,"UserSetter",()=>e$],942040);var s=e.i(906360);function n(e){return 1e-5>Math.random()&&Math.random()>.99999&&1e-5>Math.random()&&Math.random()>.99999?"this will never happen":e}e.i(850821);var a=e.i(431737),o=e.i(91e3),c=e.i(160118);function l(e){let t=[],r=`/projects/${e.id}/domains`;for(let{domain:i}of(e.config.allow_localhost&&t.push({message:"Localhost is not allowed in production mode, turn off 'Allow localhost' in project settings",relativeFixUrl:r}),e.config.domains)){let s;try{let e=i.replace(/\*+/g,"wildcard-placeholder");s=new URL(e)}catch(s){(0,o.captureError)("production-mode-domain-not-valid",new o.StackAssertionError("Domain was somehow not a valid URL; we should've caught this when setting the domain in the first place",{domain:i,projectId:e})),t.push({message:"Trusted domain is not a valid URL: "+i,relativeFixUrl:r});continue}(0,c.isLocalhost)(s)?t.push({message:"Localhost domains are not allowed to be trusted in production mode: "+i,relativeFixUrl:r}):s.hostname.match(/^\d+(\.\d+)*$/)?t.push({message:"Direct IPs are not valid for trusted domains in production mode: "+i,relativeFixUrl:r}):"https:"!==s.protocol&&t.push({message:"Trusted domains should be HTTPS: "+i,relativeFixUrl:r})}return t}var u=e.i(683767),d=e.i(85298),h=Symbol.for("StackAuth--DO-NOT-USE-OR-YOU-WILL-BE-FIRED--StackAppInternals");function p(e){return{display_name:e.displayName,description:e.description,is_production_mode:e.isProductionMode,logo_url:e.logoUrl,full_logo_url:e.fullLogoUrl,config:{domains:e.config?.domains?.map(e=>({domain:e.domain,handler_path:e.handlerPath})),oauth_providers:e.config?.oauthProviders?.map(e=>({id:e.id,type:e.type,..."standard"===e.type&&{client_id:e.clientId,client_secret:e.clientSecret,facebook_config_id:e.facebookConfigId,microsoft_tenant_id:e.microsoftTenantId}})),email_config:e.config?.emailConfig&&("shared"===e.config.emailConfig.type?{type:"shared"}:{type:"standard",host:e.config.emailConfig.host,port:e.config.emailConfig.port,username:e.config.emailConfig.username,password:e.config.emailConfig.password,sender_name:e.config.emailConfig.senderName,sender_email:e.config.emailConfig.senderEmail}),email_theme:e.config?.emailTheme,sign_up_enabled:e.config?.signUpEnabled,credential_enabled:e.config?.credentialEnabled,magic_link_enabled:e.config?.magicLinkEnabled,passkey_enabled:e.config?.passkeyEnabled,allow_localhost:e.config?.allowLocalhost,create_team_on_sign_up:e.config?.createTeamOnSignUp,client_team_creation_enabled:e.config?.clientTeamCreationEnabled,client_user_deletion_enabled:e.config?.clientUserDeletionEnabled,team_creator_default_permissions:e.config?.teamCreatorDefaultPermissions,team_member_default_permissions:e.config?.teamMemberDefaultPermissions,user_default_permissions:e.config?.userDefaultPermissions,oauth_account_merge_strategy:e.config?.oauthAccountMergeStrategy,allow_user_api_keys:e.config?.allowUserApiKeys,allow_team_api_keys:e.config?.allowTeamApiKeys}}}e.s(["stackAppInternalsSymbol",()=>h],928976);var m=e.i(963087),f=e.i(934217),y=e.i(218111),_=e.i(510835),w=e.i(550726);function g(e){let t=new y.DependenciesMap;return(...r)=>{if(t.has(r))return t.get(r);let i=e(...r);return t.set(r,i),i}}var v=class{constructor(e,t={}){this._fetcher=e,this._options=t,this._map=new y.DependenciesMap,this.isCacheAvailable=this._createKeyed("isCacheAvailable"),this.getIfCached=this._createKeyed("getIfCached"),this.getOrWait=this._createKeyed("getOrWait"),this.forceSetCachedValue=this._createKeyed("forceSetCachedValue"),this.forceSetCachedValueAsync=this._createKeyed("forceSetCachedValueAsync"),this.refresh=this._createKeyed("refresh"),this.invalidate=this._createKeyed("invalidate"),this.onStateChange=this._createKeyed("onStateChange"),this.isDirty=this._createKeyed("isDirty")}_createKeyed(e){return(t,...r)=>{let i=this.getValueCache(t);return i[e].apply(i,r)}}getValueCache(e){let t=this._map.get(e);return t||(t=new T(async()=>await this._fetcher(e),{...this._options,onSubscribe:this._options.onSubscribe?t=>this._options.onSubscribe(e,t):void 0}),this._map.set(e,t)),t}async refreshWhere(e){let t=[];for(let[r,i]of this._map)e(r)&&t.push(i.refresh());await Promise.all(t)}async invalidateWhere(e){let t=[];for(let[r,i]of this._map)e(r)&&t.push(i.invalidate().catch(()=>void 0));await Promise.all(t)}},T=class{constructor(e,t={}){this._options=t,this._subscriptionsCount=0,this._unsubscribers=[],this._mostRecentRefreshPromiseIndex=0,this._store=new w.AsyncStore,this._rateLimitOptions={concurrency:1,throttleMs:300,...(0,u.filterUndefined)(t.rateLimiter??{})},this._fetcher=(0,_.rateLimited)(e,{...this._rateLimitOptions,batchCalls:!0})}isCacheAvailable(){return this._store.isAvailable()}getIfCached(){return this._store.get()}getOrWait(e){let t=this.getIfCached();return"read-write"===e&&"ok"===t.status?(0,_.resolved)(t.data):this._refetch(e)}_set(e){this._store.set(e)}_setAsync(e){0!==this._subscriptionsCount||(0,f.isBrowserLike)()||this._invalidateCacheSoon();let t=(0,_.pending)(e);return this._pendingPromise=t,(0,_.pending)(this._store.setAsync(t).then(()=>void 0))}_refetch(e){if("read-write"===e&&this._pendingPromise)return this._pendingPromise;let t=(0,_.pending)(this._fetcher());return"never"===e?t:(0,_.pending)(this._setAsync(t).then(()=>t))}forceSetCachedValue(e){this._set(e)}forceSetCachedValueAsync(e){return this._setAsync(e)}async refresh(){this._subscriptionsCount>0&&await this.getOrWait("write-only")}async invalidate(){this._store.setUnavailable(),this._pendingPromise=void 0,await this.refresh()}isDirty(){return void 0===this._pendingPromise}_invalidateCacheSoon(){let e=++this._mostRecentRefreshPromiseIndex;(0,_.runAsynchronously)(async()=>{await (0,_.wait)(5e3),0===this._subscriptionsCount&&e===this._mostRecentRefreshPromiseIndex&&await this.invalidate()})}onStateChange(e){let t=this._store.onChange(e);if((0,_.runAsynchronously)(this.getOrWait("read-write")),0==this._subscriptionsCount++&&this._options.onSubscribe){let e=this._options.onSubscribe(()=>{(0,_.runAsynchronously)(this.refresh())});this._unsubscribers.push(e)}let r=!1;return{unsubscribe:()=>{if(!r&&(r=!0,t.unsubscribe(),0==--this._subscriptionsCount))for(let e of(this._invalidateCacheSoon(),this._unsubscribers))e()}}}};e.s(["AsyncCache",()=>v,"cacheFunction",()=>g],542664);var k=e.i(732517),C="js @stackframe/stack@2.8.51";if(C.startsWith("STACK_COMPILE_TIME"))throw new o.StackAssertionError("Client version was not replaced. Something went wrong during build!");var S=e=>new v(async t=>await d.Result.fromThrowingAsync(async()=>await e(t)),{}),b=e=>new v(async([t,...r])=>await d.Result.fromThrowingAsync(async()=>await e(t,r)),{onSubscribe:([e],t)=>{let r=e.onInvalidate(()=>t());return()=>r.unsubscribe()}});function E(e){return{...e.inheritsFrom?.[h].getConstructorOptions()??{},...(0,u.filterUndefined)((0,u.omit)(e,["inheritsFrom"]))}}function A(){return"7ff26b94-a89e-4b4f-83aa-c5ceed082566"}function I(){return"pck_zseeqc83tv9rvz5j6tsnd66fj3gr4beb833p7gkwcafcr"}function R(){return m.default.env.STACK_SECRET_SERVER_KEY||(0,o.throwErr)(Error("No secret server key provided. Please copy your key from the Stack dashboard and put it in the STACK_SECRET_SERVER_KEY environment variable."))}function O(){return JSON.parse(m.default.env.NEXT_PUBLIC_STACK_EXTRA_REQUEST_HEADERS||m.default.env.STACK_EXTRA_REQUEST_HEADERS||"{}")}function P(e){let t;var r=(t=e?"string"==typeof e?e:(0,f.isBrowserLike)()?e.browser:e.server:(t=(0,f.isBrowserLike)()?m.default.env.NEXT_PUBLIC_BROWSER_STACK_API_URL||m.default.env.NEXT_PUBLIC_STACK_API_URL_BROWSER||m.default.env.STACK_API_URL_BROWSER:m.default.env.NEXT_PUBLIC_SERVER_STACK_API_URL||m.default.env.NEXT_PUBLIC_STACK_API_URL_SERVER||m.default.env.STACK_API_URL_SERVER)||m.default.env.NEXT_PUBLIC_STACK_API_URL||m.default.env.STACK_API_URL||m.default.env.NEXT_PUBLIC_STACK_URL||x).endsWith("/")?t.slice(0,-1):t;if(!r)return r;let i=m.default.env.NEXT_PUBLIC_STACK_PORT_PREFIX;return i?r.replace(/\$\{NEXT_PUBLIC_STACK_PORT_PREFIX:-81\}/g,i):r}var x="https://api.stack-auth.com";function j(){return new w.Store({refreshToken:null,accessToken:null})}var U=new Map;function N(e,t,r){for(let i of((0,k.suspendIfSsr)(r),(0,s.getGlobal)("use-async-cache-execution-hooks")??[]))i({cache:e,caller:r,dependencies:t});let n=i.default.useId();i.default.useEffect(()=>{U.delete(n)},[...t,n]);let a=(0,i.useCallback)(r=>{let{unsubscribe:i}=e.onStateChange(t,()=>{U.delete(n),r()});return i},[e,...t]),c=(0,i.useCallback)(()=>(U.has(n)||U.set(n,e.getOrWait(t,"read-write")),U.get(n)),[e,...t]),l=i.default.useSyncExternalStore(a,c,()=>(0,o.throwErr)(Error("getServerSnapshot should never be called in useAsyncCache because we restrict to CSR earlier"))),u=(0,k.use)(l);if("error"===u.status){let e=u.error;throw e instanceof Error&&!e.__stackHasConcatenatedStacktraces&&((0,o.concatStacktraces)(e,Error()),e.__stackHasConcatenatedStacktraces=!0),e}return u.data}var D=e.i(205263),F=e.i(401750),$=e.i(926942);function M(e,t){if("undefined"==typeof window||!window.location)throw new o.StackAssertionError(`${t} option is required in a non-browser environment.`,{redirectUrl:e});let r=new URL(window.location.href),i=e?new URL(e,window.location.href):new URL(window.location.href);for(let e of["after_auth_return_to"])r.searchParams.has(e)&&i.searchParams.set(e,r.searchParams.get(e));return i.hash="",i.toString()}async function K(e,t,r){return{description:r.description,expires_at_millis:null==r.expiresAt?r.expiresAt:r.expiresAt.getTime(),is_public:r.isPublic,..."user"===e?{user_id:t}:{team_id:t}}}async function q(e,t){return(0,u.filterUndefined)({description:t.description,expires_at_millis:null==t.expiresAt?t.expiresAt:t.expiresAt.getTime(),revoked:t.revoked})}function L(e){return{display_name:e.displayName,profile_image_url:e.profileImageUrl,creator_user_id:e.creatorUserId}}var V=e.i(145010);function W(e){let t=Object.getOwnPropertyDescriptor(e,"user");t?.get!==J&&Object.defineProperty(e,"user",{get:J,configurable:!1,enumerable:!1})}function J(){throw Error("Stack Auth: useUser() already returns the user object. Use `const user = useUser()` (or `const user = await app.getUser()`) instead of destructuring it like `const { user } = ...`.")}var H=e.i(676829),B=e.i(684291),z=e.i(717817),Y=e.i(675174),G=e.i(502627),X=e.i(359990),Q=e.i(894736);let Z=Q.cookies,ee=Q.headers;var et=e.i(464143),er=e.i(485736);function ei(){if(!(0,f.isBrowserLike)())throw Error("cookieClient functions can only be called in a browser environment, yet window is undefined")}async function es(){function e(){throw new o.StackAssertionError("Throwing cookie helper is just a placeholder. This should never be called")}return{get:e,getAll:e,set:e,setOrDelete:e,delete:e}}async function en(){var e,t;let r;return(0,f.isBrowserLike)()?ea():(e=await Z(),t=await ee(),r={get:e=>r.getAll()[e]??null,getAll:()=>{try{e.set("stack-is-https","true",{secure:!0})}catch(e){if("object"==typeof e&&null!==e&&"message"in e&&"string"==typeof e.message&&e.message.includes("Cookies can only be modified in a Server Action or Route Handler"));else throw e}return e.getAll().reduce((e,t)=>(e[t.name]=t.value,e),{})},set:(r,i,s)=>{let n=eh(e,t);try{e.set(r,i,{secure:n,maxAge:s.maxAge,domain:s.domain})}catch(e){eo(e,s)}},setOrDelete(e,t,r={}){null===t?this.delete(e,r):this.set(e,t,r)},delete(t,r={}){try{void 0!==r.domain?e.delete({name:t,domain:r.domain}):e.delete(t)}catch(e){eo(e,r)}}})}function ea(){return{get:ec,getAll:el,set:ew,setOrDelete:ef,delete:e_}}function eo(e,t){if(e instanceof Error&&e.message.includes("Cookies can only be modified in"))if(t.noOpIfServerComponent);else throw new o.StackAssertionError("Attempted to set cookie in server component. Pass { noOpIfServerComponent: true } in the options of Stack's cookie functions if this is intentional and you want to ignore this error. Read more: https://nextjs.org/docs/app/api-reference/functions/cookies#options");else throw e}function ec(e){return el()[e]??null}function el(){return ei(),et.default.set("stack-is-https","true",{secure:!0}),et.default.get()}async function eu(){return(0,f.isBrowserLike)()?ed():eh(await Z(),await ee())}function ed(){return"undefined"!=typeof window&&"https:"===window.location.protocol}function eh(e,t){return e.has("stack-is-https")||"https"===t.get("x-forwarded-proto")}function ep(e,t,r={}){let i=r.secure??ed();et.default.set(e,t,{expires:void 0===r.maxAge?void 0:new Date(Date.now()+1e3*r.maxAge),domain:r.domain,secure:i})}function em(e,t={}){void 0!==t.domain&&et.default.remove(e,{domain:t.domain}),et.default.remove(e)}function ef(e,t,r={}){ei(),null===t?em(e,r):ep(e,t,r)}async function ey(e,t,r={}){(await en()).setOrDelete(e,t,r)}function e_(e,t={}){ei(),em(e,t)}function ew(e,t,r={}){ei(),ep(e,t,r)}async function eg(e,t,r={}){(await en()).set(e,t,r)}async function ev(){let e=(0,er.generateRandomCodeVerifier)(),t=await (0,er.calculatePKCECodeChallenge)(e),r=(0,er.generateRandomState)();return await eg("stack-oauth-outer-"+r,e,{maxAge:3600}),{codeChallenge:t,state:r}}async function eT(e,t,r){let{codeChallenge:i,state:s}=await ev(),n=await e.getOAuthUrl({provider:t.provider,redirectUrl:M(t.redirectUrl,"redirectUrl"),errorRedirectUrl:M(t.errorRedirectUrl,"errorRedirectUrl"),codeChallenge:i,state:s,type:"authenticate",providerScope:t.providerScope,session:r});window.location.assign(n),await (0,_.neverResolve)()}async function ek(e,t,r){let{codeChallenge:i,state:s}=await ev(),n=await e.getOAuthUrl({provider:t.provider,redirectUrl:M(t.redirectUrl,"redirectUrl"),errorRedirectUrl:M(t.errorRedirectUrl,"errorRedirectUrl"),afterCallbackRedirectUrl:M(window.location.href,"afterCallbackRedirectUrl"),codeChallenge:i,state:s,type:"link",session:r,providerScope:t.providerScope});window.location.assign(n),await (0,_.neverResolve)()}async function eC(e,t){let r=function(){let e,t,r=["code","state"],i=new URL(window.location.href);for(let e of r)if(!i.searchParams.has(e))return console.warn(Error(`Missing required query parameter on OAuth callback: ${e}. Maybe you opened or reloaded the oauth-callback page from your history?`)),null;let s=i.searchParams.get("state")??(0,o.throwErr)("This should never happen; isn't state required above?"),n=(ei(),(t=ec(e="stack-oauth-outer-"+s))?(e_(e),{codeVerifier:t}):null);if(!n)return console.warn(z.deindent`
      Stack found an outer OAuth callback state in the query parameters, but not in cookies.
      
      This could have multiple reasons:
        - The cookie expired, because the OAuth flow took too long.
        - The user's browser deleted the cookie, either manually or because of a very strict cookie policy.
        - The cookie was already consumed by this page, and the user already logged in.
        - You are using another OAuth client library with the same callback URL as Stack.
        - The user opened the OAuth callback page from their history.

      Either way, it is probably safe to ignore this warning unless you are debugging an OAuth issue.
    `),null;let a=new URL(i);for(let e of r)a.searchParams.delete(e);return window.history.replaceState({},"",a.toString()),{originalUrl:i,codeVerifier:n.codeVerifier,state:s}}();if(!r)return d.Result.ok(void 0);try{return d.Result.ok(await e.callOAuthCallback({oauthParams:r.originalUrl.searchParams,redirectUri:M(t,"redirectUri"),codeVerifier:r.codeVerifier,state:r.state}))}catch(e){if(D.KnownError.isKnownError(e))throw e;throw new o.StackAssertionError("Error signing in during OAuth callback. Please try again.",{cause:e})}}function eS(e){return d.Result.fromThrowing(()=>JSON.parse(e))}var eb=!1;eb=!1;var eE=n(X),eA=new Map,eI=class e{constructor(r,i){this._uniqueIdentifier=void 0,this.__DEMO_ENABLE_SLIGHT_FETCH_DELAY=!1,this._ownedAdminApps=new y.DependenciesMap,this._currentUserCache=b(async e=>(this.__DEMO_ENABLE_SLIGHT_FETCH_DELAY&&await (0,_.wait)(2e3),e.isKnownToBeInvalid())?null:await this._interface.getClientUserByToken(e)),this._currentProjectCache=S(async()=>d.Result.orThrow(await this._interface.getClientProject())),this._ownedProjectsCache=b(async e=>await this._interface.listProjects(e)),this._currentUserPermissionsCache=b(async(e,[t,r])=>await this._interface.listCurrentUserTeamPermissions({teamId:t,recursive:r},e)),this._currentUserProjectPermissionsCache=b(async(e,[t])=>await this._interface.listCurrentUserProjectPermissions({recursive:t},e)),this._currentUserTeamsCache=b(async e=>await this._interface.listCurrentUserTeams(e)),this._currentUserOAuthConnectionAccessTokensCache=b(async(e,[t,r])=>{try{return{accessToken:(await this._interface.createProviderAccessToken(t,r||"",e)).access_token}}catch(e){if(!(D.KnownErrors.OAuthConnectionDoesNotHaveRequiredScope.isInstance(e)||D.KnownErrors.OAuthConnectionNotConnectedToUser.isInstance(e)))throw e}return null}),this._currentUserOAuthConnectionCache=b(async(e,[t,r,i])=>await this._getUserOAuthConnectionCacheFn({getUser:async()=>d.Result.orThrow(await this._currentUserCache.getOrWait([e],"write-only")),getOrWaitOAuthToken:async()=>d.Result.orThrow(await this._currentUserOAuthConnectionAccessTokensCache.getOrWait([e,t,r||""],"write-only")),useOAuthToken:()=>N(this._currentUserOAuthConnectionAccessTokensCache,[e,t,r||""],"connection.useAccessToken()"),providerId:t,scope:r,redirect:i,session:e})),this._teamMemberProfilesCache=b(async(e,[t])=>await this._interface.listTeamMemberProfiles({teamId:t},e)),this._teamInvitationsCache=b(async(e,[t])=>await this._interface.listTeamInvitations({teamId:t},e)),this._currentUserTeamProfileCache=b(async(e,[t])=>await this._interface.getTeamMemberProfile({teamId:t,userId:"me"},e)),this._clientContactChannelsCache=b(async e=>await this._interface.listClientContactChannels(e)),this._userApiKeysCache=b(async e=>await this._interface.listProjectApiKeys({user_id:"me"},e,"client")),this._teamApiKeysCache=b(async(e,[t])=>await this._interface.listProjectApiKeys({team_id:t},e,"client")),this._notificationCategoriesCache=b(async e=>await this._interface.listNotificationCategories(e)),this._currentUserOAuthProvidersCache=b(async e=>await this._interface.listOAuthProviders({user_id:"me"},e)),this._userItemCache=b(async(e,[t,r])=>await this._interface.getItem({userId:t,itemId:r},e)),this._teamItemCache=b(async(e,[t,r])=>await this._interface.getItem({teamId:t,itemId:r},e)),this._customItemCache=b(async(e,[t,r])=>await this._interface.getItem({customCustomerId:t,itemId:r},e)),this._userProductsCache=b(async(e,[t,r,i])=>await this._interface.listProducts({customer_type:"user",customer_id:t,cursor:r??void 0,limit:i??void 0},e)),this._teamProductsCache=b(async(e,[t,r,i])=>await this._interface.listProducts({customer_type:"team",customer_id:t,cursor:r??void 0,limit:i??void 0},e)),this._customProductsCache=b(async(e,[t,r,i])=>await this._interface.listProducts({customer_type:"custom",customer_id:t,cursor:r??void 0,limit:i??void 0},e)),this._convexPartialUserCache=S(async([e])=>await this._getPartialUserFromConvex(e)),this._trustedParentDomainCache=S(async([e])=>await this._getTrustedParentDomain(e)),this._anonymousSignUpInProgress=null,this._memoryTokenStore=j(),this._nextServerCookiesTokenStores=new WeakMap,this._requestTokenStores=new WeakMap,this._storedBrowserCookieTokenStore=null,this._mostRecentQueuedCookieRefreshIndex=0,this._sessionsByTokenStoreAndSessionKey=new WeakMap;const s=E(r);if(!e.LazyStackAdminAppImpl.value)throw new o.StackAssertionError("Admin app implementation not initialized. Did you import the _StackClientApp from stack-app/apps/implementations/index.ts? You can't import it directly from ./apps/implementations/client-app-impl.ts as that causes a circular dependency (see the comment at _LazyStackAdminAppImpl for more details).");this._options=s,this._extraOptions=i;const n=s.projectId??A();if("internal"!==n&&!n.match(/^[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[089ab][0-9a-f]{3}-[0-9a-f]{12}$/i))throw Error(`Invalid project ID: ${n}. Project IDs must be UUIDs. Please check your environment variables and/or your StackApp.`);i&&i.interface?this._interface=i.interface:this._interface=new B.StackClientInterface({getBaseUrl:()=>P(s.baseUrl),extraRequestHeaders:s.extraRequestHeaders??O(),projectId:n,clientVersion:C,publishableClientKey:s.publishableClientKey??I(),prepareRequest:async()=>{await t?.()}}),this._tokenStoreInit=s.tokenStore,this._redirectMethod=s.redirectMethod||"none",this._redirectMethod=s.redirectMethod||"nextjs",this._urlOptions=s.urls??{},this._oauthScopesOnSignIn=s.oauthScopesOnSignIn??{},i&&i.uniqueIdentifier&&(this._uniqueIdentifier=i.uniqueIdentifier,this._initUniqueIdentifier())}async _createCookieHelper(){return"nextjs-cookie"===this._tokenStoreInit||"cookie"===this._tokenStoreInit?await en():await es()}async _getUserOAuthConnectionCacheFn(e){let t=await e.getUser(),r=!0;if(t&&t.oauth_providers.find(t=>t.id===e.providerId)||(r=!1),await e.getOrWaitOAuthToken()||(r=!1),!r&&e.redirect){if(!e.session)throw Error(z.deindent`
          Cannot add new scopes to a user that is not a CurrentUser. Please ensure that you are calling this function on a CurrentUser object, or remove the 'or: redirect' option.

          Often, you can solve this by calling this function in the browser instead, or by removing the 'or: redirect' option and dealing with the case where the user doesn't have enough permissions.
        `);return await ek(this._interface,{provider:e.providerId,redirectUrl:this.urls.oauthCallback,errorRedirectUrl:this.urls.error,providerScope:(0,z.mergeScopeStrings)(e.scope||"",(this._oauthScopesOnSignIn[e.providerId]??[]).join(" "))},e.session),await (0,_.neverResolve)()}return r?{id:e.providerId,async getAccessToken(){let t=await e.getOrWaitOAuthToken();if(!t)throw new o.StackAssertionError("No access token available");return t},useAccessToken(){let t=e.useOAuthToken();if(!t)throw new o.StackAssertionError("No access token available");return t}}:null}_initUniqueIdentifier(){if(!this._uniqueIdentifier)throw new o.StackAssertionError("Unique identifier not initialized");if(eA.has(this._uniqueIdentifier))throw new o.StackAssertionError("A Stack client app with the same unique identifier already exists");eA.set(this._uniqueIdentifier,[this._extraOptions?.checkString??void 0,this])}_getUniqueIdentifier(){return this._uniqueIdentifier||(this._uniqueIdentifier=(0,Y.generateUuid)(),this._initUniqueIdentifier()),this._uniqueIdentifier}async _checkFeatureSupport(e,t){return await this._interface.checkFeatureSupport({...t,name:e})}_useCheckFeatureSupport(e,t){throw(0,_.runAsynchronously)(this._checkFeatureSupport(e,t)),new o.StackAssertionError(`${e} is not currently supported. Please reach out to Stack support for more information.`)}get _legacyRefreshTokenCookieName(){return`stack-refresh-${this.projectId}`}get _refreshTokenCookieName(){return`stack-refresh-${this.projectId}`}_getRefreshTokenDefaultCookieNameForSecure(e){return`${e?"__Host-":""}${this._refreshTokenCookieName}--default`}_getCustomRefreshCookieName(e){let t=(0,V.encodeBase32)(new TextEncoder().encode(e.toLowerCase()));return`${this._refreshTokenCookieName}--custom-${t}`}_formatRefreshCookieValue(e,t){return JSON.stringify({refresh_token:e,updated_at_millis:t})}_formatAccessCookieValue(e,t){return e&&t?JSON.stringify([e,t]):null}_parseStructuredRefreshCookie(e){if(!e)return null;let t=eS(e);if("ok"!==t.status||"object"!=typeof t.data||null===t.data)return console.warn("Failed to parse structured refresh cookie"),null;let r=t.data,i="refresh_token"in r&&"string"==typeof r.refresh_token?r.refresh_token:null,s="updated_at_millis"in r&&"number"==typeof r.updated_at_millis?r.updated_at_millis:null;return i?{refreshToken:i,updatedAt:s}:(console.warn("Refresh token not found in structured refresh cookie"),null)}_extractRefreshTokenFromCookieMap(e){let{legacyNames:t,structuredPrefixes:r}=this._getRefreshTokenCookieNamePatterns();for(let r of t){let t=e[r];if(t)return{refreshToken:t,updatedAt:null}}let i=null;for(let[t,s]of Object.entries(e)){if(!r.some(e=>t.startsWith(e)))continue;let e=this._parseStructuredRefreshCookie(s);if(!e)continue;let n=e.updatedAt??-1/0,a=i?.updatedAt??-1/0;(!i||n>a)&&(i=e)}return i?{refreshToken:i.refreshToken,updatedAt:i.updatedAt??null}:{refreshToken:null,updatedAt:null}}_getTokensFromCookies(e){let{refreshToken:t}=this._extractRefreshTokenFromCookieMap(e),r=e[this._accessTokenCookieName]??null,i=null;if(r&&r.startsWith('["')){let e=eS(r);"ok"===e.status&&"object"==typeof e.data&&null!==e.data&&Array.isArray(e.data)&&2===e.data.length&&"string"==typeof e.data[0]&&"string"==typeof e.data[1]?e.data[0]===t&&(i=e.data[1]):console.warn("Access token cookie has invalid format")}return{refreshToken:t,accessToken:i}}get _accessTokenCookieName(){return"stack-access"}_getAllBrowserCookies(){if(!(0,f.isBrowserLike)())throw new o.StackAssertionError("Cannot get browser cookies on the server!");return G.parse(document.cookie||"")}_getRefreshTokenCookieNamePatterns(){return{legacyNames:[this._legacyRefreshTokenCookieName,"stack-refresh"],structuredPrefixes:[`${this._refreshTokenCookieName}--`,`__Host-${this._refreshTokenCookieName}--`]}}_collectRefreshTokenCookieNames(e){let{legacyNames:t,structuredPrefixes:r}=this._getRefreshTokenCookieNamePatterns(),i=new Set;for(let r of t)e[r]&&i.add(r);for(let t of Object.keys(e))r.some(e=>t.startsWith(e))&&i.add(t);return i}_prepareRefreshCookieUpdate(e,t,r,i){let s=this._collectRefreshTokenCookieNames(e);s.delete(i);let n=t?Date.now():null,a=t&&null!==n?this._formatRefreshCookieValue(t,n):null;return{updatedAt:n,refreshCookieValue:a,accessTokenPayload:this._formatAccessCookieValue(t,r),cookieNamesToDelete:[...s]}}_queueCustomRefreshCookieUpdate(e,t,i){(0,_.runAsynchronously)(async()=>{let s;this._mostRecentQueuedCookieRefreshIndex++;let n=this._mostRecentQueuedCookieRefreshIndex;if(!(s=(0,f.isBrowserLike)()?window.location.hostname:(await r?.())?.get("host")))return void console.warn("No hostname found when queueing custom refresh cookie update");let a=await this._trustedParentDomainCache.getOrWait([s],"read-write"),o=async(e,t)=>{let r=this._getCustomRefreshCookieName(e),s={maxAge:31536e3,domain:e,noOpIfServerComponent:!0};"browser"===i?ef(r,t,s):await ey(r,t,s)};if("error"===a.status||!a.data||n!==this._mostRecentQueuedCookieRefreshIndex)return;let c=e&&t?this._formatRefreshCookieValue(e,t):null;await o(a.data,c)})}async _getTrustedParentDomain(e){let t=d.Result.orThrow(await this._interface.getClientProject()).config.domains.map(e=>e.domain.trim().replace(/^https?:\/\//,"").split("/")[0]?.toLowerCase()),r=t.filter(e=>e.startsWith("**.")),i=e.split(".");for(let e=i.length-2;e>=0;e--){let s=i.slice(e).join(".");if(t.includes(s)&&r.includes("**."+s))return s}return null}_getBrowserCookieTokenStore(){if(!(0,f.isBrowserLike)())throw Error("Cannot use cookie token store on the server!");if(null===this._storedBrowserCookieTokenStore){let e=e=>{let t=this._getTokensFromCookies(this._getAllBrowserCookies());return{refreshToken:t.refreshToken,accessToken:t.accessToken??(e?.refreshToken===t.refreshToken?e.accessToken:null)}};this._storedBrowserCookieTokenStore=new w.Store(e(null));let t=!0;setInterval(()=>{if(t){let t=this._storedBrowserCookieTokenStore.get(),r=e(t);(0,u.deepPlainEquals)(r,t)||this._storedBrowserCookieTokenStore.set(r)}},100),this._storedBrowserCookieTokenStore.onChange(e=>{try{let r=e.refreshToken,i="https:"===window.location.protocol,s=this._getRefreshTokenDefaultCookieNameForSecure(i),{updatedAt:n,refreshCookieValue:a,accessTokenPayload:o,cookieNamesToDelete:c}=this._prepareRefreshCookieUpdate(this._getAllBrowserCookies(),r,e.accessToken??null,s);ef(s,a,{maxAge:31536e3,secure:i}),ef(this._accessTokenCookieName,o,{maxAge:86400}),c.forEach(e=>e_(e)),this._queueCustomRefreshCookieUpdate(r,n,"browser"),t=!0}catch(e){if((0,f.isBrowserLike)())throw e;t=!1}})}return this._storedBrowserCookieTokenStore}_getOrCreateTokenStore(e,t){let r=void 0===t?this._tokenStoreInit:t;switch(r){case"cookie":return this._getBrowserCookieTokenStore();case"nextjs-cookie":if((0,f.isBrowserLike)())return this._getBrowserCookieTokenStore();{let t=this._getTokensFromCookies(e.getAll()),r=new w.Store(t);return r.onChange(t=>{(0,_.runAsynchronously)(async()=>{let r=t.refreshToken,i=await eu(),s=this._getRefreshTokenDefaultCookieNameForSecure(i),{updatedAt:n,refreshCookieValue:a,accessTokenPayload:o,cookieNamesToDelete:c}=this._prepareRefreshCookieUpdate(e.getAll(),r,t.accessToken??null,s);await Promise.all([ey(s,a,{maxAge:31536e3,noOpIfServerComponent:!0}),ey(this._accessTokenCookieName,o,{maxAge:86400,noOpIfServerComponent:!0})]),c.length>0&&await Promise.all(c.map(e=>ey(e,null,{noOpIfServerComponent:!0}))),this._queueCustomRefreshCookieUpdate(r,n,"server")})}),r}case"memory":return this._memoryTokenStore;default:if(null===r)return j();if("object"==typeof r&&"headers"in r){if(this._requestTokenStores.has(r))return this._requestTokenStores.get(r);let t=r.headers.get("x-stack-auth");if(t){let r;try{if(r=JSON.parse(t),"object"!=typeof r)throw Error("x-stack-auth header must be a JSON object");if(null===r)throw Error("x-stack-auth header must not be null")}catch(e){throw Error(`Invalid x-stack-auth header: ${t}`,{cause:e})}return this._getOrCreateTokenStore(e,{accessToken:r.accessToken??null,refreshToken:r.refreshToken??null})}let i=r.headers.get("cookie"),s=G.parse(i||""),n=new w.Store(this._getTokensFromCookies(s));return this._requestTokenStores.set(r,n),n}if("accessToken"in r||"refreshToken"in r)return new w.Store({refreshToken:r.refreshToken,accessToken:r.accessToken});throw Error(`Invalid token store ${r}`)}}_useTokenStore(e){(0,k.suspendIfSsr)();let t=ea();return this._getOrCreateTokenStore(t,e)}_getSessionFromTokenStore(e){let t=e.get(),r=$.InternalSession.calculateSessionKey(t),i=r?this._sessionsByTokenStoreAndSessionKey.get(e)?.get(r):null;if(i)return i;let s=this._interface.createSession({refreshToken:t.refreshToken,accessToken:t.accessToken});s.onAccessTokenChange(t=>{e.update(e=>({...e,accessToken:t?.token??null}))}),s.onInvalidate(()=>{e.update(e=>({...e,accessToken:null,refreshToken:null}))});let n=this._sessionsByTokenStoreAndSessionKey.get(e)??new Map;return this._sessionsByTokenStoreAndSessionKey.set(e,n),n.set(r,s),s}async _getSession(e){let t=this._getOrCreateTokenStore(await this._createCookieHelper(),e);return this._getSessionFromTokenStore(t)}_useSession(e){let t=this._useTokenStore(e),r=(0,i.useCallback)(e=>{let{unsubscribe:r}=t.onChange(()=>{e()});return r},[t]),s=(0,i.useCallback)(()=>this._getSessionFromTokenStore(t),[t]);return i.default.useSyncExternalStore(r,s,s)}async _signInToAccountWithTokens(e){if(!("accessToken"in e)||!("refreshToken"in e))throw new o.StackAssertionError("Invalid tokens object; can't sign in with this",{tokens:e});this._getOrCreateTokenStore(await this._createCookieHelper()).set(e)}_hasPersistentTokenStore(e){return(void 0!==e?e:this._tokenStoreInit)!==null}_ensurePersistentTokenStore(e){if(!this._hasPersistentTokenStore(e))throw Error("Cannot call this function on a Stack app without a persistent token store. Make sure the tokenStore option on the constructor is set to a non-null value when initializing Stack.\n\nStack uses token stores to access access tokens of the current user. For example, on web frontends it is commonly the string value 'cookies' for cookie storage.")}_isInternalProject(){return"internal"===this.projectId}_ensureInternalProject(){if(!this._isInternalProject())throw Error("Cannot call this function on a Stack app with a project ID other than 'internal'.")}_clientProjectFromCrud(e){return{id:e.id,displayName:e.display_name,config:{signUpEnabled:e.config.sign_up_enabled,credentialEnabled:e.config.credential_enabled,magicLinkEnabled:e.config.magic_link_enabled,passkeyEnabled:e.config.passkey_enabled,clientTeamCreationEnabled:e.config.client_team_creation_enabled,clientUserDeletionEnabled:e.config.client_user_deletion_enabled,allowTeamApiKeys:e.config.allow_team_api_keys,allowUserApiKeys:e.config.allow_user_api_keys,oauthProviders:e.config.enabled_oauth_providers.map(e=>({id:e.id}))}}}_clientPermissionFromCrud(e){return{id:e.id}}_clientTeamUserFromCrud(e){return{id:e.user_id,teamProfile:{displayName:e.display_name,profileImageUrl:e.profile_image_url}}}_clientTeamInvitationFromCrud(e,t){return{id:t.id,recipientEmail:t.recipient_email,expiresAt:new Date(t.expires_at_millis),revoke:async()=>{await this._interface.revokeTeamInvitation(t.id,t.team_id,e),await this._teamInvitationsCache.refresh([e,t.team_id])}}}_baseApiKeyFromCrud(e){return{id:e.id,description:e.description,expiresAt:e.expires_at_millis?new Date(e.expires_at_millis):void 0,manuallyRevokedAt:e.manually_revoked_at_millis?new Date(e.manually_revoked_at_millis):null,createdAt:new Date(e.created_at_millis),..."team"===e.type?{type:"team",teamId:e.team_id}:{type:"user",userId:e.user_id},value:"string"==typeof e.value?e.value:{lastFour:e.value.last_four},isValid:function(){return null===this.whyInvalid()},whyInvalid:function(){return this.manuallyRevokedAt?"manually-revoked":this.expiresAt&&this.expiresAt<new Date?"expired":null}}}_clientApiKeyFromCrud(e,t){return{...this._baseApiKeyFromCrud(t),async revoke(){await this.update({revoked:!0})},update:async r=>{await this._interface.updateProjectApiKey("team"===t.type?{team_id:t.team_id}:{user_id:t.user_id},t.id,r,e,"client"),"team"===t.type?await this._teamApiKeysCache.refresh([e,t.team_id]):await this._userApiKeysCache.refresh([e])}}}_clientTeamFromCrud(e,t){let r=this;return{id:e.id,displayName:e.display_name,profileImageUrl:e.profile_image_url,clientMetadata:e.client_metadata,clientReadOnlyMetadata:e.client_read_only_metadata,...this._createCustomer(e.id,"team",t),async inviteUser(i){await r._interface.sendTeamInvitation({teamId:e.id,email:i.email,session:t,callbackUrl:i.callbackUrl??M(r.urls.teamInvitation,"callbackUrl")}),await r._teamInvitationsCache.refresh([t,e.id])},listUsers:async()=>d.Result.orThrow(await r._teamMemberProfilesCache.getOrWait([t,e.id],"write-only")).map(e=>r._clientTeamUserFromCrud(e)),useUsers:()=>N(r._teamMemberProfilesCache,[t,e.id],"team.useUsers()").map(e=>r._clientTeamUserFromCrud(e)),listInvitations:async()=>d.Result.orThrow(await r._teamInvitationsCache.getOrWait([t,e.id],"write-only")).map(e=>r._clientTeamInvitationFromCrud(t,e)),useInvitations:()=>N(r._teamInvitationsCache,[t,e.id],"team.useInvitations()").map(e=>r._clientTeamInvitationFromCrud(t,e)),async update(i){await r._interface.updateTeam({data:{display_name:i.displayName,profile_image_url:i.profileImageUrl,client_metadata:i.clientMetadata},teamId:e.id},t),await r._currentUserTeamsCache.refresh([t])},async delete(){await r._interface.deleteTeam(e.id,t),await r._currentUserTeamsCache.refresh([t])},useApiKeys:()=>N(r._teamApiKeysCache,[t,e.id],"team.useApiKeys()").map(e=>r._clientApiKeyFromCrud(t,e)),listApiKeys:async()=>d.Result.orThrow(await r._teamApiKeysCache.getOrWait([t,e.id],"write-only")).map(e=>r._clientApiKeyFromCrud(t,e)),async createApiKey(i){let s=await r._interface.createProjectApiKey(await K("team",e.id,i),t,"client");return await r._teamApiKeysCache.refresh([t,e.id]),r._clientApiKeyFromCrud(t,s)}}}_clientContactChannelFromCrud(e,t){let r=this;return{id:e.id,value:e.value,type:e.type,isVerified:e.is_verified,isPrimary:e.is_primary,usedForAuth:e.used_for_auth,async sendVerificationEmail(i){await r._interface.sendCurrentUserContactChannelVerificationEmail(e.id,i?.callbackUrl||M(r.urls.emailVerification,"callbackUrl"),t)},async update(i){await r._interface.updateClientContactChannel(e.id,{value:i.value,used_for_auth:i.usedForAuth,is_primary:i.isPrimary},t),await r._clientContactChannelsCache.refresh([t])},async delete(){await r._interface.deleteClientContactChannel(e.id,t),await r._clientContactChannelsCache.refresh([t])}}}_clientNotificationCategoryFromCrud(e,t){let r=this;return{id:e.notification_category_id,name:e.notification_category_name,enabled:e.enabled,canDisable:e.can_disable,async setEnabled(i){await r._interface.setNotificationsEnabled(e.notification_category_id,i,t),await r._notificationCategoriesCache.refresh([t])}}}_clientOAuthProviderFromCrud(e,t){let r=this;return{id:e.id,type:e.type,userId:e.user_id,email:e.email,allowSignIn:e.allow_sign_in,allowConnectedAccounts:e.allow_connected_accounts,async update(i){try{return await r._interface.updateOAuthProvider(e.user_id,e.id,{allow_sign_in:i.allowSignIn,allow_connected_accounts:i.allowConnectedAccounts},t),await r._currentUserOAuthProvidersCache.refresh([t]),d.Result.ok(void 0)}catch(e){if(D.KnownErrors.OAuthProviderAccountIdAlreadyUsedForSignIn.isInstance(e))return d.Result.error(e);throw e}},async delete(){await r._interface.deleteOAuthProvider(e.user_id,e.id,t),await r._currentUserOAuthProvidersCache.refresh([t])}}}_clientItemFromCrud(e){return{displayName:e.display_name,quantity:e.quantity,nonNegativeQuantity:Math.max(0,e.quantity)}}_customerProductsFromResponse(e){return Object.assign(e.items.map(e=>({id:e.id,quantity:e.quantity,displayName:e.product.display_name,customerType:e.product.customer_type,isServerOnly:e.product.server_only,stackable:e.product.stackable})),{nextCursor:e.pagination.next_cursor??null})}_createAuth(e){let t=this;return{_internalSession:e,currentSession:{async getTokens(){let t=await e.getOrFetchLikelyValidTokens(2e4);return{accessToken:t?.accessToken.token??null,refreshToken:t?.refreshToken?.token??null}}},async getAuthHeaders(){return{"x-stack-auth":JSON.stringify(await this.getAuthJson())}},async getAuthJson(){return await this.currentSession.getTokens()},signOut:r=>t._signOut(e,r)}}_editableTeamProfileFromCrud(e,t){let r=this;return{displayName:e.display_name,profileImageUrl:e.profile_image_url,async update(i){await r._interface.updateTeamMemberProfile({teamId:e.team_id,userId:e.user_id,profile:{display_name:i.displayName,profile_image_url:i.profileImageUrl}},t),await r._currentUserTeamProfileCache.refresh([t,e.team_id])}}}_createBaseUser(e){return{id:e.id,displayName:e.display_name,primaryEmail:e.primary_email,primaryEmailVerified:e.primary_email_verified,profileImageUrl:e.profile_image_url,signedUpAt:new Date(e.signed_up_at_millis),clientMetadata:e.client_metadata,clientReadOnlyMetadata:e.client_read_only_metadata,hasPassword:e.has_password,emailAuthEnabled:e.auth_with_email,otpAuthEnabled:e.otp_auth_enabled,oauthProviders:e.oauth_providers,passkeyAuthEnabled:e.passkey_auth_enabled,isMultiFactorRequired:e.requires_totp_mfa,isAnonymous:e.is_anonymous,toClientJson:()=>e}}_createUserExtraFromCurrent(e,t){let r=this;return{getActiveSessions:async()=>(await r._interface.listSessions(t)).items.map(e=>r._clientSessionFromCrud(e)),async revokeSession(e){await r._interface.deleteSession(e,t)},setDisplayName(e){return this.update({displayName:e})},setClientMetadata(e){return this.update({clientMetadata:e})},async setSelectedTeam(e){await this.update({selectedTeamId:e?.id??null})},getConnectedAccount:async function e(e,i){let s=i?.scopes?.join(" ");return d.Result.orThrow(await r._currentUserOAuthConnectionCache.getOrWait([t,e,s||"",i?.or==="redirect"],"write-only"))},useConnectedAccount:function(e,i){let s=i?.scopes?.join(" ");return N(r._currentUserOAuthConnectionCache,[t,e,s||"",i?.or==="redirect"],"user.useConnectedAccount()")},async getTeam(e){return(await this.listTeams()).find(t=>t.id===e)??null},useTeam(e){let t=this.useTeams();return(0,i.useMemo)(()=>t.find(t=>t.id===e)??null,[t,e])},listTeams:async()=>d.Result.orThrow(await r._currentUserTeamsCache.getOrWait([t],"write-only")).map(e=>r._clientTeamFromCrud(e,t)),useTeams(){let e=N(r._currentUserTeamsCache,[t],"user.useTeams()");return(0,i.useMemo)(()=>e.map(e=>r._clientTeamFromCrud(e,t)),[e])},async createTeam(e){let i=await r._interface.createClientTeam({display_name:e.displayName,profile_image_url:e.profileImageUrl,creator_user_id:"me"},t);return await r._currentUserTeamsCache.refresh([t]),await this.update({selectedTeamId:i.id}),r._clientTeamFromCrud(i,t)},async leaveTeam(e){await r._interface.leaveTeam(e.id,t)},async listPermissions(e,i){if(e&&"id"in e){let s=i?.recursive??!0;return d.Result.orThrow(await r._currentUserPermissionsCache.getOrWait([t,e.id,s],"write-only")).map(e=>r._clientPermissionFromCrud(e))}{let i=e?.recursive??!0;return d.Result.orThrow(await r._currentUserProjectPermissionsCache.getOrWait([t,i],"write-only")).map(e=>r._clientPermissionFromCrud(e))}},usePermissions(e,s){if(e&&"id"in e){let n=s?.recursive??!0,a=N(r._currentUserPermissionsCache,[t,e.id,n],"user.usePermissions()");return(0,i.useMemo)(()=>a.map(e=>r._clientPermissionFromCrud(e)),[a])}{let s=e?.recursive??!0,n=N(r._currentUserProjectPermissionsCache,[t,s],"user.usePermissions()");return(0,i.useMemo)(()=>n.map(e=>r._clientPermissionFromCrud(e)),[n])}},usePermission(e,t){if(e&&"string"!=typeof e){let r=this.usePermissions(e);return(0,i.useMemo)(()=>r.find(e=>e.id===t)??null,[r,t])}{let t=this.usePermissions();return(0,i.useMemo)(()=>t.find(t=>t.id===e)??null,[t,e])}},async getPermission(e,t){return e&&"string"!=typeof e?(await this.listPermissions(e)).find(e=>e.id===t)??null:(await this.listPermissions()).find(t=>t.id===e)??null},async hasPermission(e,t){return e&&"string"!=typeof e?await this.getPermission(e,t)!==null:await this.getPermission(e)!==null},update:async e=>await r._updateClientUser(e,t),async sendVerificationEmail(i){if(!e.primary_email)throw new o.StackAssertionError("User does not have a primary email");return await r._interface.sendVerificationEmail(e.primary_email,i?.callbackUrl??M(r.urls.emailVerification,"callbackUrl"),t)},async updatePassword(e){let i=await r._interface.updatePassword(e,t);return await r._currentUserCache.refresh([t]),i},async setPassword(e){let i=await r._interface.setPassword(e,t);return await r._currentUserCache.refresh([t]),i},selectedTeam:e.selected_team&&this._clientTeamFromCrud(e.selected_team,t),async getTeamProfile(e){let i=d.Result.orThrow(await r._currentUserTeamProfileCache.getOrWait([t,e.id],"write-only"));return r._editableTeamProfileFromCrud(i,t)},useTeamProfile(e){let i=N(r._currentUserTeamProfileCache,[t,e.id],"user.useTeamProfile()");return r._editableTeamProfileFromCrud(i,t)},async delete(){await r._interface.deleteCurrentUser(t),t.markInvalid()},listContactChannels:async()=>d.Result.orThrow(await r._clientContactChannelsCache.getOrWait([t],"write-only")).map(e=>r._clientContactChannelFromCrud(e,t)),useContactChannels:()=>N(r._clientContactChannelsCache,[t],"user.useContactChannels()").map(e=>r._clientContactChannelFromCrud(e,t)),async createContactChannel(e){let i=await r._interface.createClientContactChannel({value:e.value,type:e.type,used_for_auth:e.usedForAuth,is_primary:e.isPrimary,user_id:"me"},t);return await r._clientContactChannelsCache.refresh([t]),r._clientContactChannelFromCrud(i,t)},useNotificationCategories:()=>N(r._notificationCategoriesCache,[t],"user.useNotificationCategories()").map(e=>r._clientNotificationCategoryFromCrud(e,t)),listNotificationCategories:async()=>d.Result.orThrow(await r._notificationCategoriesCache.getOrWait([t],"write-only")).map(e=>r._clientNotificationCategoryFromCrud(e,t)),useApiKeys:()=>N(r._userApiKeysCache,[t],"user.useApiKeys()").map(e=>r._clientApiKeyFromCrud(t,e)),listApiKeys:async()=>(await r._interface.listProjectApiKeys({user_id:"me"},t,"client")).map(e=>r._clientApiKeyFromCrud(t,e)),async createApiKey(e){let i=await r._interface.createProjectApiKey(await K("user","me",e),t,"client");return await r._userApiKeysCache.refresh([t]),r._clientApiKeyFromCrud(t,i)},useOAuthProviders:()=>N(r._currentUserOAuthProvidersCache,[t],"user.useOAuthProviders()").map(e=>r._clientOAuthProviderFromCrud(e,t)),listOAuthProviders:async()=>d.Result.orThrow(await r._currentUserOAuthProvidersCache.getOrWait([t],"write-only")).map(e=>r._clientOAuthProviderFromCrud(e,t)),useOAuthProvider(e){let t=this.useOAuthProviders();return(0,i.useMemo)(()=>t.find(t=>t.id===e)??null,[t,e])},async getOAuthProvider(e){return(await this.listOAuthProviders()).find(t=>t.id===e)??null},async registerPasskey(e){let i,s=(await r._getCurrentUrl())?.hostname;if(!s)throw new o.StackAssertionError("hostname must be provided if the Stack App does not have a redirect method");let n=await r._interface.initiatePasskeyRegistration({},t);if("ok"!==n.status)return d.Result.error(new D.KnownErrors.PasskeyRegistrationFailed("Failed to get initiation options for passkey registration"));let{options_json:a,code:c}=n.data;if("THIS_VALUE_WILL_BE_REPLACED.example.com"!==a.rp.id)throw new o.StackAssertionError(`Expected returned RP ID from server to equal sentinel, but found ${a.rp.id}`);a.rp.id=s;try{i=await (0,H.startRegistration)({optionsJSON:a})}catch(e){if(e instanceof H.WebAuthnError)return d.Result.error(new D.KnownErrors.PasskeyWebAuthnError(e.message,e.name));return(0,o.captureError)("passkey-registration-failed",e),d.Result.error(new D.KnownErrors.PasskeyRegistrationFailed("Failed to start passkey registration due to unknown error"))}let l=await r._interface.registerPasskey({credential:i,code:c},t);return await r._refreshUser(t),l}}}_createInternalUserExtra(e){let t=this;return this._ensureInternalProject(),{createProject:r=>t._createProject(e,r),async transferProject(r,i){await t._interface.transferProject(e,r,i),await t._refreshProject()},listOwnedProjects:()=>t._listOwnedProjects(e),useOwnedProjects:()=>t._useOwnedProjects(e)}}_createCustomer(e,t,r){let i=this,s="user"===t?{userId:e}:{teamId:e};return{getItem:async e=>await i.getItem({itemId:e,...s}),useItem:e=>i.useItem({itemId:e,...s}),listProducts:async e=>await i.listProducts({...e,...s}),useProducts:e=>i.useProducts({...e,...s}),createCheckoutUrl:async s=>await i._interface.createCheckoutUrl(t,e,s.productId,r,s.returnUrl)}}async getItem(e){let t,r=await this._getSession();return t="userId"in e?d.Result.orThrow(await this._userItemCache.getOrWait([r,e.userId,e.itemId],"write-only")):"teamId"in e?d.Result.orThrow(await this._teamItemCache.getOrWait([r,e.teamId,e.itemId],"write-only")):d.Result.orThrow(await this._customItemCache.getOrWait([r,e.customCustomerId,e.itemId],"write-only")),this._clientItemFromCrud(t)}useItem(e){let t=this._useSession(),[r,i]="userId"in e?[this._userItemCache,e.userId]:"teamId"in e?[this._teamItemCache,e.teamId]:[this._customItemCache,e.customCustomerId],s=N(r,[t,i,e.itemId],"app.useItem()");return this._clientItemFromCrud(s)}async listProducts(e){let t=await this._getSession();if("userId"in e){let r=d.Result.orThrow(await this._userProductsCache.getOrWait([t,e.userId,e.cursor??null,e.limit??null],"write-only"));return this._customerProductsFromResponse(r)}if("teamId"in e){let r=d.Result.orThrow(await this._teamProductsCache.getOrWait([t,e.teamId,e.cursor??null,e.limit??null],"write-only"));return this._customerProductsFromResponse(r)}let r=d.Result.orThrow(await this._customProductsCache.getOrWait([t,e.customCustomerId,e.cursor??null,e.limit??null],"write-only"));return this._customerProductsFromResponse(r)}useProducts(e){let t=this._useSession(),r=N("userId"in e?this._userProductsCache:"teamId"in e?this._teamProductsCache:this._customProductsCache,[t,"userId"in e?e.userId:"teamId"in e?e.teamId:e.customCustomerId,e.cursor??null,e.limit??null],"clientApp.useProducts()");return this._customerProductsFromResponse(r)}_currentUserFromCrud(e,t){let r={...this._createBaseUser(e),...this._createAuth(t),...this._createUserExtraFromCurrent(e,t),...this._isInternalProject()?this._createInternalUserExtra(t):{},...this._createCustomer(e.id,"user",t)};return W(r),Object.freeze(r),r}_clientSessionFromCrud(e){return{id:e.id,userId:e.user_id,createdAt:new Date(e.created_at),isImpersonation:e.is_impersonation,lastUsedAt:e.last_used_at?new Date(e.last_used_at):void 0,isCurrentSession:e.is_current_session??!1,geoInfo:e.last_used_at_end_user_ip_info}}_getOwnedAdminApp(t,r){return this._ownedAdminApps.has([r,t])||this._ownedAdminApps.set([r,t],new e.LazyStackAdminAppImpl.value({baseUrl:this._interface.options.getBaseUrl(),projectId:t,tokenStore:null,projectOwnerSession:r,noAutomaticPrefetch:!0})),this._ownedAdminApps.get([r,t])}get projectId(){return this._interface.projectId}async _isTrusted(e){return(0,c.isRelative)(e)}get urls(){var e;let t,r,i;return t=(e=this._urlOptions).handler??"/handler",r=e.home??"/",i=e.afterSignIn??r,{handler:t,signIn:`${t}/sign-in`,afterSignIn:r,signUp:`${t}/sign-up`,afterSignUp:i,signOut:`${t}/sign-out`,afterSignOut:r,emailVerification:`${t}/email-verification`,passwordReset:`${t}/password-reset`,forgotPassword:`${t}/forgot-password`,oauthCallback:`${t}/oauth-callback`,magicLinkCallback:`${t}/magic-link-callback`,home:r,accountSettings:`${t}/account-settings`,error:`${t}/error`,teamInvitation:`${t}/team-invitation`,mfa:`${t}/mfa`,...(0,u.filterUndefined)(e)}}async _getCurrentUrl(){return"none"===this._redirectMethod?null:new URL(window.location.href)}async _redirectTo(e){"none"!==this._redirectMethod&&(eb&&"nextjs"===this._redirectMethod?eE.redirect(e.url.toString(),e.replace?eE.RedirectType.replace:eE.RedirectType.push):"object"==typeof this._redirectMethod&&this._redirectMethod.navigate?this._redirectMethod.navigate(e.url.toString()):e.replace?window.location.replace(e.url):window.location.assign(e.url),await (0,_.wait)(2e3))}useNavigate(){if("object"==typeof this._redirectMethod)return this._redirectMethod.useNavigate();if("window"===this._redirectMethod)return e=>window.location.assign(e);if("nextjs"!==this._redirectMethod)return e=>{};{let e=eE.useRouter();return t=>e.push(t)}}async _redirectIfTrusted(e,t){if(!await this._isTrusted(e))throw Error(`Redirect URL ${e} is not trusted; should be relative.`);return await this._redirectTo({url:e,...t})}async _redirectToHandler(e,t){let r=this.urls[e];if(!r)throw Error(`No URL for handler name ${e}`);if(!t?.noRedirectBack){if("afterSignIn"===e||"afterSignUp"===e)eb||"undefined"==typeof window||(r=new URLSearchParams(window.location.search).get("after_auth_return_to")||r);else if("signIn"===e||"signUp"===e)if(eb||"undefined"==typeof window);else{let e=new URL(window.location.href),t=new URL(r,e);e.searchParams.has("after_auth_return_to")?t.searchParams.set("after_auth_return_to",e.searchParams.get("after_auth_return_to")):e.protocol===t.protocol&&e.host===t.host&&t.searchParams.set("after_auth_return_to",(0,c.getRelativePart)(e)),r=(0,c.getRelativePart)(t)}}await this._redirectIfTrusted(r,t)}async redirectToSignIn(e){return await this._redirectToHandler("signIn",e)}async redirectToSignUp(e){return await this._redirectToHandler("signUp",e)}async redirectToSignOut(e){return await this._redirectToHandler("signOut",e)}async redirectToEmailVerification(e){return await this._redirectToHandler("emailVerification",e)}async redirectToPasswordReset(e){return await this._redirectToHandler("passwordReset",e)}async redirectToForgotPassword(e){return await this._redirectToHandler("forgotPassword",e)}async redirectToHome(e){return await this._redirectToHandler("home",e)}async redirectToOAuthCallback(e){return await this._redirectToHandler("oauthCallback",e)}async redirectToMagicLinkCallback(e){return await this._redirectToHandler("magicLinkCallback",e)}async redirectToAfterSignIn(e){return await this._redirectToHandler("afterSignIn",e)}async redirectToAfterSignUp(e){return await this._redirectToHandler("afterSignUp",e)}async redirectToAfterSignOut(e){return await this._redirectToHandler("afterSignOut",e)}async redirectToAccountSettings(e){return await this._redirectToHandler("accountSettings",e)}async redirectToError(e){return await this._redirectToHandler("error",e)}async redirectToTeamInvitation(e){return await this._redirectToHandler("teamInvitation",e)}async redirectToMfa(e){return await this._redirectToHandler("mfa",e)}async sendForgotPasswordEmail(e,t){return await this._interface.sendForgotPasswordEmail(e,t?.callbackUrl??M(this.urls.passwordReset,"callbackUrl"))}async sendMagicLinkEmail(e,t){return await this._interface.sendMagicLinkEmail(e,t?.callbackUrl??M(this.urls.magicLinkCallback,"callbackUrl"))}async resetPassword(e){return await this._interface.resetPassword(e)}async verifyPasswordResetCode(e){return await this._interface.verifyPasswordResetCode(e)}async verifyTeamInvitationCode(e){return await this._interface.acceptTeamInvitation({type:"check",code:e,session:await this._getSession()})}async acceptTeamInvitation(e){let t=await this._interface.acceptTeamInvitation({type:"use",code:e,session:await this._getSession()});return"ok"===t.status?d.Result.ok(void 0):d.Result.error(t.error)}async getTeamInvitationDetails(e){let t=await this._interface.acceptTeamInvitation({type:"details",code:e,session:await this._getSession()});return"ok"===t.status?d.Result.ok({teamDisplayName:t.data.team_display_name}):d.Result.error(t.error)}async verifyEmail(e){let t=await this._interface.verifyEmail(e);return await this._currentUserCache.refresh([await this._getSession()]),await this._clientContactChannelsCache.refresh([await this._getSession()]),t}async getUser(e){this._ensurePersistentTokenStore(e?.tokenStore);let t=await this._getSession(e?.tokenStore),r=d.Result.orThrow(await this._currentUserCache.getOrWait([t],"write-only"));if(r?.is_anonymous&&e?.or!=="anonymous"&&e?.or!=="anonymous-if-exists[deprecated]"&&(r=null),null===r)switch(e?.or){case"redirect":await this.redirectToSignIn({replace:!0});break;case"throw":throw Error("User is not signed in but getUser was called with { or: 'throw' }");case"anonymous":{let e=await this._signUpAnonymously();return await this.getUser({tokenStore:e,or:"anonymous-if-exists[deprecated]"})??(0,o.throwErr)("Something went wrong while signing up anonymously")}case void 0:case"anonymous-if-exists[deprecated]":case"return-null":return null}return r&&this._currentUserFromCrud(r,t)}useUser(e){this._ensurePersistentTokenStore(e?.tokenStore);let t=this._useSession(e?.tokenStore),r=N(this._currentUserCache,[t],"clientApp.useUser()");if(r?.is_anonymous&&e?.or!=="anonymous"&&e?.or!=="anonymous-if-exists[deprecated]"&&(r=null),null===r)switch(e?.or){case"redirect":throw(0,_.runAsynchronously)(this.redirectToSignIn({replace:!0})),(0,k.suspend)(),new o.StackAssertionError("suspend should never return");case"throw":throw Error("User is not signed in but useUser was called with { or: 'throw' }");case"anonymous":throw(0,_.runAsynchronously)(async()=>{await this._signUpAnonymously(),"undefined"!=typeof window&&window.location.reload()}),(0,k.suspend)(),new o.StackAssertionError("suspend should never return")}return(0,i.useMemo)(()=>r&&this._currentUserFromCrud(r,t),[r,t,e?.or])}_getTokenPartialUserFromSession(e,t){let r=e.getAccessTokenIfNotExpiredYet(0);if(!r)return null;let i=r.payload.is_anonymous;return i&&"anonymous"!==t.or?null:{id:r.payload.sub,primaryEmail:r.payload.email,displayName:r.payload.name,primaryEmailVerified:r.payload.email_verified,isAnonymous:i}}async _getPartialUserFromConvex(e){let t=await e.auth.getUserIdentity();return t?{id:t.subject,displayName:t.name??null,primaryEmail:t.email??null,primaryEmailVerified:t.email_verified,isAnonymous:t.is_anonymous}:null}async getPartialUser(e){switch(e.from){case"token":{this._ensurePersistentTokenStore(e.tokenStore??this._tokenStoreInit);let t=await this._getSession(e.tokenStore);return this._getTokenPartialUserFromSession(t,e)}case"convex":return await this._getPartialUserFromConvex(e.ctx);default:throw Error(`Invalid 'from' option: ${e.from}`)}}usePartialUser(e){switch(e.from){case"token":{this._ensurePersistentTokenStore(e.tokenStore??this._tokenStoreInit);let t=this._useSession(e.tokenStore);return this._getTokenPartialUserFromSession(t,e)}case"convex":return N(this._convexPartialUserCache,[e.ctx],"clientApp.usePartialUser()");default:throw Error(`Invalid 'from' option: ${e.from}`)}}getConvexClientAuth(e){return async t=>{let r=await this._getSession(e.tokenStore??this._tokenStoreInit);if(!t.forceRefreshToken){let e=await r.getOrFetchLikelyValidTokens(2e4);return e?.accessToken.token??null}let i=await r.fetchNewTokens();return i?.accessToken.token??null}}async getConvexHttpClientAuth(e){let t=await this._getSession(e.tokenStore),r=await t.getOrFetchLikelyValidTokens(2e4);return r?.accessToken.token??""}async _updateClientUser(e,t){let r=await this._interface.updateClientUser({display_name:e.displayName,client_metadata:e.clientMetadata,selected_team_id:e.selectedTeamId,totp_secret_base64:null!=e.totpMultiFactorSecret?(0,V.encodeBase64)(e.totpMultiFactorSecret):e.totpMultiFactorSecret,profile_image_url:e.profileImageUrl,otp_auth_enabled:e.otpAuthEnabled,passkey_auth_enabled:e.passkeyAuthEnabled},t);return await this._refreshUser(t),r}async signInWithOAuth(e,t){if("undefined"==typeof window)throw Error("signInWithOAuth can currently only be called in a browser environment");this._ensurePersistentTokenStore();let r=await this._getSession();await eT(this._interface,{provider:e,redirectUrl:t?.returnTo??this.urls.oauthCallback,errorRedirectUrl:this.urls.error,providerScope:this._oauthScopesOnSignIn[e]?.join(" ")},r)}async _experimentalMfa(e,t){throw"undefined"!=typeof window&&window.sessionStorage.setItem("stack_mfa_attempt_code",e.details?.attempt_code??(0,o.throwErr)("attempt code missing")),await this.redirectToMfa(),new o.StackAssertionError("we should have redirected in redirectToMfa()")}async _catchMfaRequiredError(e){try{return await e()}catch(e){if(D.KnownErrors.MultiFactorAuthenticationRequired.isInstance(e))return d.Result.ok(await this._experimentalMfa(e,await this._getSession()));throw e}}async signInWithCredential(e){let t;this._ensurePersistentTokenStore();let r=await this._getSession();try{t=await this._catchMfaRequiredError(async()=>await this._interface.signInWithCredential(e.email,e.password,r))}catch(e){if(D.KnownErrors.InvalidTotpCode.isInstance(e))return d.Result.error(e);throw e}return"ok"===t.status?(await this._signInToAccountWithTokens(t.data),e.noRedirect||await this.redirectToAfterSignIn({replace:!0}),d.Result.ok(void 0)):d.Result.error(t.error)}async signUpWithCredential(e){if(e.noVerificationCallback&&e.verificationCallbackUrl)throw new o.StackAssertionError("verificationCallbackUrl is not allowed when noVerificationCallback is true");this._ensurePersistentTokenStore();let t=await this._getSession(),r=e.noVerificationCallback?void 0:e.verificationCallbackUrl??M(this.urls.emailVerification,"verificationCallbackUrl"),i=await this._interface.signUpWithCredential(e.email,e.password,r,t);return("error"===i.status&&i.error instanceof D.KnownErrors.RedirectUrlNotWhitelisted&&!e.noVerificationCallback&&void 0!==r&&(console.error("Warning: The verification callback URL is not trusted. Proceeding with signup without email verification. Please add your domain to the trusted domains list in your Stack Auth dashboard.",{url:r}),i=await this._interface.signUpWithCredential(e.email,e.password,void 0,t)),"ok"===i.status)?(await this._signInToAccountWithTokens(i.data),e.noRedirect||await this.redirectToAfterSignUp({replace:!0}),d.Result.ok(void 0)):d.Result.error(i.error)}async _signUpAnonymously(){return this._ensurePersistentTokenStore(),this._anonymousSignUpInProgress||(this._anonymousSignUpInProgress=(async()=>{this._ensurePersistentTokenStore();let e=await this._getSession(),t=await this._interface.signUpAnonymously(e);if("ok"===t.status)await this._signInToAccountWithTokens(t.data);else throw new o.StackAssertionError("signUpAnonymously() should never return an error");return this._anonymousSignUpInProgress=null,t.data})()),await this._anonymousSignUpInProgress}async signInWithMagicLink(e,t){let r;this._ensurePersistentTokenStore();let i=await this._getSession();try{r=await this._catchMfaRequiredError(async()=>await this._interface.signInWithMagicLink(e,i))}catch(e){if(D.KnownErrors.InvalidTotpCode.isInstance(e))return d.Result.error(e);throw e}return"ok"===r.status?(await this._signInToAccountWithTokens(r.data),t?.noRedirect||(r.data.newUser?await this.redirectToAfterSignUp({replace:!0}):await this.redirectToAfterSignIn({replace:!0})),d.Result.ok(void 0)):d.Result.error(r.error)}async promptCliLogin(e){let t=await this._interface.sendClientRequest("/auth/cli",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({expires_in_millis:e.expiresInMillis})},null);if(!t.ok)return d.Result.error(new D.KnownErrors.CliAuthError(`Failed to initiate CLI auth: ${t.status} ${await t.text()}`));let r=await t.json(),i=r.polling_code,s=r.login_code,n=`${e.appUrl}/handler/cli-auth-confirm?login_code=${encodeURIComponent(s)}`;e.promptLink?e.promptLink(n):console.log(`Please visit the following URL to authenticate:
${n}`);let a=0;for(;a<(e.maxAttempts??1/0);){a++;let t=await this._interface.sendClientRequest("/auth/cli/poll",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({polling_code:i})},null);if(!t.ok)return d.Result.error(new D.KnownErrors.CliAuthError(`Failed to initiate CLI auth: ${t.status} ${await t.text()}`));let r=await t.json();if(201===t.status&&"success"===r.status)return d.Result.ok(r.refresh_token);if("waiting"===r.status){await (0,_.wait)(e.waitTimeMillis??2e3);continue}if("expired"===r.status)return d.Result.error(new D.KnownErrors.CliAuthExpiredError("CLI authentication request expired. Please try again."));if("used"===r.status)return d.Result.error(new D.KnownErrors.CliAuthUsedError("This authentication token has already been used."));return d.Result.error(new D.KnownErrors.CliAuthError(`Unexpected status from CLI auth polling: ${r.status}`))}return d.Result.error(new D.KnownErrors.CliAuthError("Timed out waiting for CLI authentication."))}async signInWithMfa(e,t,r){let i;this._ensurePersistentTokenStore();let s=await this._getSession();try{i=await this._catchMfaRequiredError(async()=>await this._interface.signInWithMfa(e,t,s))}catch(e){if(e instanceof D.KnownErrors.InvalidTotpCode)return d.Result.error(e);throw e}return"ok"===i.status?(await this._signInToAccountWithTokens(i.data),r?.noRedirect||(i.data.newUser?await this.redirectToAfterSignUp({replace:!0}):await this.redirectToAfterSignIn({replace:!0})),d.Result.ok(void 0)):d.Result.error(i.error)}async signInWithPasskey(){let e;this._ensurePersistentTokenStore();let t=await this._getSession();try{e=await this._catchMfaRequiredError(async()=>{let e=await this._interface.initiatePasskeyAuthentication({},t);if("ok"!==e.status)return d.Result.error(new D.KnownErrors.PasskeyAuthenticationFailed("Failed to get initiation options for passkey authentication"));let{options_json:r,code:i}=e.data;if("THIS_VALUE_WILL_BE_REPLACED.example.com"!==r.rpId)throw new o.StackAssertionError(`Expected returned RP ID from server to equal sentinel, but found ${r.rpId}`);r.rpId=window.location.hostname;let s=await (0,H.startAuthentication)({optionsJSON:r});return await this._interface.signInWithPasskey({authentication_response:s,code:i},t)})}catch(e){if(e instanceof H.WebAuthnError)return d.Result.error(new D.KnownErrors.PasskeyWebAuthnError(e.message,e.name));return d.Result.error(new D.KnownErrors.PasskeyAuthenticationFailed("Failed to sign in with passkey"))}return"ok"===e.status?(await this._signInToAccountWithTokens(e.data),await this.redirectToAfterSignIn({replace:!0}),d.Result.ok(void 0)):d.Result.error(e.error)}async callOAuthCallback(){let e;if("undefined"==typeof window)throw Error("callOAuthCallback can currently only be called in a browser environment");this._ensurePersistentTokenStore();try{e=await this._catchMfaRequiredError(async()=>await eC(this._interface,this.urls.oauthCallback))}catch(e){if(D.KnownErrors.InvalidTotpCode.isInstance(e))return alert("Invalid TOTP code. Please try signing in again."),!1;throw e}return"ok"===e.status&&!!e.data&&((await this._signInToAccountWithTokens(e.data),"afterCallbackRedirectUrl"in e.data&&e.data.afterCallbackRedirectUrl)?await this._redirectTo({url:e.data.afterCallbackRedirectUrl,replace:!0}):e.data.newUser?await this.redirectToAfterSignUp({replace:!0}):await this.redirectToAfterSignIn({replace:!0}),!0)}async _signOut(e,t){await w.storeLock.withWriteLock(async()=>{await this._interface.signOut(e),t?.redirectUrl?await this._redirectTo({url:t.redirectUrl,replace:!0}):await this.redirectToAfterSignOut()})}async signOut(e){let t=await this.getUser({tokenStore:e?.tokenStore??void 0});t&&await t.signOut({redirectUrl:e?.redirectUrl})}async getAuthHeaders(e){return{"x-stack-auth":JSON.stringify(await this.getAuthJson(e))}}async getAuthJson(e){let t=await this.getUser({tokenStore:e?.tokenStore??void 0});return t?await t.getAuthJson():{accessToken:null,refreshToken:null}}async getProject(){let e=d.Result.orThrow(await this._currentProjectCache.getOrWait([],"write-only"));return this._clientProjectFromCrud(e)}useProject(){let e=N(this._currentProjectCache,[],"clientApp.useProject()");return(0,i.useMemo)(()=>this._clientProjectFromCrud(e),[e])}async _listOwnedProjects(e){return this._ensureInternalProject(),d.Result.orThrow(await this._ownedProjectsCache.getOrWait([e],"write-only")).map(t=>this._getOwnedAdminApp(t.id,e)._adminOwnedProjectFromCrud(t,()=>this._refreshOwnedProjects(e)))}_useOwnedProjects(e){this._ensureInternalProject();let t=N(this._ownedProjectsCache,[e],"clientApp.useOwnedProjects()");return(0,i.useMemo)(()=>t.map(t=>this._getOwnedAdminApp(t.id,e)._adminOwnedProjectFromCrud(t,()=>this._refreshOwnedProjects(e))),[t])}async _createProject(e,t){this._ensureInternalProject();let r=await this._interface.createProject({...p(t),display_name:t.displayName,owner_team_id:t.teamId},e),i=this._getOwnedAdminApp(r.id,e)._adminOwnedProjectFromCrud(r,()=>this._refreshOwnedProjects(e));return await this._refreshOwnedProjects(e),i}async _refreshUser(e){await this._refreshSession(e)}async _refreshSession(e){await this._currentUserCache.refresh([e])}async _refreshUsers(){}async _refreshProject(){await this._currentProjectCache.refresh([])}async _refreshOwnedProjects(e){await this._ownedProjectsCache.refresh([e])}static get[h](){return{fromClientJson:t=>{let r=JSON.stringify((0,u.omit)(t,[])),i=eA.get(t.uniqueIdentifier);if(i){let[e,s]=i;if(void 0!==e&&e!==r)throw new o.StackAssertionError("The provided app JSON does not match the configuration of the existing client app with the same unique identifier",{providedObj:t,existingString:e});return s}return new e({...(0,u.omit)(t,["uniqueIdentifier"])},{uniqueIdentifier:t.uniqueIdentifier,checkString:r})}}}get[h](){return{toClientJson:()=>{if(!("publishableClientKey"in this._interface.options))throw new o.StackAssertionError("Cannot serialize to JSON from an application without a publishable client key");if("string"!=typeof this._redirectMethod)throw new o.StackAssertionError("Cannot serialize to JSON from an application with a non-string redirect method");return{baseUrl:this._options.baseUrl,projectId:this.projectId,publishableClientKey:this._interface.options.publishableClientKey,tokenStore:this._tokenStoreInit,urls:this._urlOptions,oauthScopesOnSignIn:this._oauthScopesOnSignIn,uniqueIdentifier:this._getUniqueIdentifier(),redirectMethod:this._redirectMethod,extraRequestHeaders:this._options.extraRequestHeaders}},setCurrentUser:e=>{(0,_.runAsynchronously)(async()=>{await this._currentUserCache.forceSetCachedValueAsync([await this._getSession()],d.Result.fromPromise(e))})},getConstructorOptions:()=>this._options,sendRequest:async(e,t,r="client")=>await this._interface.sendClientRequest(e,t,await this._getSession(),r)}}};eI.LazyStackAdminAppImpl={value:void 0};var eR=eI,eO=class extends eR{constructor(e,t){const r=E(e);super(r,{...t,interface:t?.interface??new F.StackServerInterface({getBaseUrl:()=>P(r.baseUrl),projectId:r.projectId??A(),extraRequestHeaders:r.extraRequestHeaders??O(),clientVersion:C,publishableClientKey:r.publishableClientKey??I(),secretServerKey:r.secretServerKey??R()})}),this._currentServerUserCache=b(async e=>e.isKnownToBeInvalid()?null:await this._interface.getServerUserByToken(e)),this._serverUsersCache=S(async([e,t,r,i,s,n])=>await this._interface.listServerUsers({cursor:e,limit:t,orderBy:r,desc:i,query:s,includeAnonymous:n})),this._serverUserCache=S(async([e])=>{let t=await this._interface.getServerUserById(e);return d.Result.or(t,null)}),this._serverTeamsCache=S(async([e])=>await this._interface.listServerTeams({userId:e})),this._serverTeamUserPermissionsCache=S(async([e,t,r])=>await this._interface.listServerTeamPermissions({teamId:e,userId:t,recursive:r},null)),this._serverUserProjectPermissionsCache=S(async([e,t])=>await this._interface.listServerProjectPermissions({userId:e,recursive:t},null)),this._serverUserOAuthConnectionAccessTokensCache=S(async([e,t,r])=>{try{return{accessToken:(await this._interface.createServerProviderAccessToken(e,t,r||"")).access_token}}catch(e){if(!(D.KnownErrors.OAuthConnectionDoesNotHaveRequiredScope.isInstance(e)||D.KnownErrors.OAuthConnectionNotConnectedToUser.isInstance(e)))throw e}return null}),this._serverUserOAuthConnectionCache=S(async([e,t,r,i])=>await this._getUserOAuthConnectionCacheFn({getUser:async()=>d.Result.orThrow(await this._serverUserCache.getOrWait([e],"write-only")),getOrWaitOAuthToken:async()=>d.Result.orThrow(await this._serverUserOAuthConnectionAccessTokensCache.getOrWait([e,t,r||""],"write-only")),useOAuthToken:()=>N(this._serverUserOAuthConnectionAccessTokensCache,[e,t,r||""],"user.useConnectedAccount()"),providerId:t,scope:r,redirect:i,session:null})),this._serverTeamMemberProfilesCache=S(async([e])=>await this._interface.listServerTeamMemberProfiles({teamId:e})),this._serverTeamInvitationsCache=S(async([e])=>await this._interface.listServerTeamInvitations({teamId:e})),this._serverUserTeamProfileCache=S(async([e,t])=>await this._interface.getServerTeamMemberProfile({teamId:e,userId:t})),this._serverContactChannelsCache=S(async([e])=>await this._interface.listServerContactChannels(e)),this._serverNotificationCategoriesCache=S(async([e])=>await this._interface.listServerNotificationCategories(e)),this._serverDataVaultStoreValueCache=S(async([e,t,r])=>await this._interface.getDataVaultStoreValue(r,e,t)),this._serverUserApiKeysCache=S(async([e])=>await this._interface.listProjectApiKeys({user_id:e},null,"server")),this._serverTeamApiKeysCache=S(async([e])=>await this._interface.listProjectApiKeys({team_id:e},null,"server")),this._convexIdentitySubjectCache=S(async([e])=>{let t=await e.auth.getUserIdentity();return t?t.subject:null}),this._serverCheckApiKeyCache=S(async([e,t])=>await this._interface.checkProjectApiKey(e,t,null,"server")),this._serverOAuthProvidersCache=S(async([e])=>await this._interface.listServerOAuthProviders({user_id:e})),this._serverTeamItemsCache=S(async([e,t])=>await this._interface.getItem({teamId:e,itemId:t},null)),this._serverUserItemsCache=S(async([e,t])=>await this._interface.getItem({userId:e,itemId:t},null)),this._serverCustomItemsCache=S(async([e,t])=>await this._interface.getItem({customCustomerId:e,itemId:t},null)),this._serverUserProductsCache=S(async([e,t,r])=>await this._interface.listProducts({customer_type:"user",customer_id:e,cursor:t??void 0,limit:r??void 0},null)),this._serverTeamProductsCache=S(async([e,t,r])=>await this._interface.listProducts({customer_type:"team",customer_id:e,cursor:t??void 0,limit:r??void 0},null)),this._serverCustomProductsCache=S(async([e,t,r])=>await this._interface.listProducts({customer_type:"custom",customer_id:e,cursor:t??void 0,limit:r??void 0},null))}_createServerCustomer(e,t){let r=this,i="user"===t?r._serverUserProductsCache:r._serverTeamProductsCache,s="user"===t?{userId:e}:{teamId:e};return{...this._createCustomer(e,t,null),getItem:async e=>await r.getItem({itemId:e,...s}),useItem:e=>r.useItem({itemId:e,...s}),async grantProduct(s){"user"===t?"productId"in s?await r.grantProduct({userId:e,productId:s.productId,quantity:s.quantity}):await r.grantProduct({userId:e,product:s.product,quantity:s.quantity}):"productId"in s?await r.grantProduct({teamId:e,productId:s.productId,quantity:s.quantity}):await r.grantProduct({teamId:e,product:s.product,quantity:s.quantity}),await i.refresh([e,null,null])},async createCheckoutUrl(i){let s="productId"in i?i.productId:i.product;return await r._interface.createCheckoutUrl(t,e,s,null,i.returnUrl)}}}async _updateServerUser(e,t){let r=await this._interface.updateServerUser(e,{display_name:t.displayName,primary_email:t.primaryEmail,client_metadata:t.clientMetadata,client_read_only_metadata:t.clientReadOnlyMetadata,server_metadata:t.serverMetadata,selected_team_id:t.selectedTeamId,primary_email_auth_enabled:t.primaryEmailAuthEnabled,primary_email_verified:t.primaryEmailVerified,password:t.password,profile_image_url:t.profileImageUrl,totp_secret_base64:null!=t.totpMultiFactorSecret?(0,V.encodeBase64)(t.totpMultiFactorSecret):t.totpMultiFactorSecret});return await this._refreshUsers(),r}_serverEditableTeamProfileFromCrud(e){let t=this;return{displayName:e.display_name,profileImageUrl:e.profile_image_url,async update(r){await t._interface.updateServerTeamMemberProfile({teamId:e.team_id,userId:e.user_id,profile:{display_name:r.displayName,profile_image_url:r.profileImageUrl}}),await t._serverUserTeamProfileCache.refresh([e.team_id,e.user_id])}}}_serverContactChannelFromCrud(e,t){let r=this;return{id:t.id,value:t.value,type:t.type,isVerified:t.is_verified,isPrimary:t.is_primary,usedForAuth:t.used_for_auth,async sendVerificationEmail(i){await r._interface.sendServerContactChannelVerificationEmail(e,t.id,i?.callbackUrl??M(r.urls.emailVerification,"callbackUrl"))},async update(i){await r._interface.updateServerContactChannel(e,t.id,{value:i.value,is_verified:i.isVerified,used_for_auth:i.usedForAuth,is_primary:i.isPrimary}),await Promise.all([r._serverContactChannelsCache.refresh([e]),r._serverUserCache.refresh([e])])},async delete(){await r._interface.deleteServerContactChannel(e,t.id),await Promise.all([r._serverContactChannelsCache.refresh([e]),r._serverUserCache.refresh([e])])}}}_serverNotificationCategoryFromCrud(e,t){let r=this;return{id:t.notification_category_id,name:t.notification_category_name,enabled:t.enabled,canDisable:t.can_disable,async setEnabled(i){await r._interface.setServerNotificationsEnabled(e,t.notification_category_id,i),await r._serverNotificationCategoriesCache.refresh([e])}}}_serverOAuthProviderFromCrud(e){let t=this;return{id:e.id,type:e.type,userId:e.user_id,accountId:e.account_id,email:e.email,allowSignIn:e.allow_sign_in,allowConnectedAccounts:e.allow_connected_accounts,async update(r){try{return await t._interface.updateServerOAuthProvider(e.user_id,e.id,{account_id:r.accountId,email:r.email,allow_sign_in:r.allowSignIn,allow_connected_accounts:r.allowConnectedAccounts}),await t._serverOAuthProvidersCache.refresh([e.user_id]),d.Result.ok(void 0)}catch(e){if(D.KnownErrors.OAuthProviderAccountIdAlreadyUsedForSignIn.isInstance(e))return d.Result.error(e);throw e}},async delete(){await t._interface.deleteServerOAuthProvider(e.user_id,e.id),await t._serverOAuthProvidersCache.refresh([e.user_id])}}}_serverApiKeyFromCrud(e){return{...this._baseApiKeyFromCrud(e),async revoke(){await this.update({revoked:!0})},update:async t=>{await this._interface.updateProjectApiKey("team"===e.type?{team_id:e.team_id}:{user_id:e.user_id},e.id,await q(e.type,t),null,"server"),"team"===e.type?await this._serverTeamApiKeysCache.refresh([e.team_id]):await this._serverUserApiKeysCache.refresh([e.user_id])}}}_serverUserFromCrud(t){let r=this;async function s(e,i){let s=i?.scopes?.join(" ");return d.Result.orThrow(await r._serverUserOAuthConnectionCache.getOrWait([t.id,e,s||"",i?.or==="redirect"],"write-only"))}let n={...super._createBaseUser(t),lastActiveAt:new Date(t.last_active_at_millis),serverMetadata:t.server_metadata,async setPrimaryEmail(e,i){await r._updateServerUser(t.id,{primaryEmail:e,primaryEmailVerified:i?.verified})},async grantPermission(e,i){if(e&&"string"!=typeof e&&i)for(let s of(await r._interface.grantServerTeamUserPermission(e.id,t.id,i),[!0,!1]))await r._serverTeamUserPermissionsCache.refresh([e.id,t.id,s]);else for(let i of(await r._interface.grantServerProjectPermission(t.id,e),[!0,!1]))await r._serverUserProjectPermissionsCache.refresh([t.id,i])},async revokePermission(e,i){if(e&&"string"!=typeof e&&i)for(let s of(await r._interface.revokeServerTeamUserPermission(e.id,t.id,i),[!0,!1]))await r._serverTeamUserPermissionsCache.refresh([e.id,t.id,s]);else for(let i of(await r._interface.revokeServerProjectPermission(t.id,e),[!0,!1]))await r._serverUserProjectPermissionsCache.refresh([t.id,i])},async delete(){let e=await r._interface.deleteServerUser(t.id);return await r._refreshUsers(),e},async createSession(e){let i=await r._interface.createServerUserSession(t.id,e.expiresInMillis??31536e6,e.isImpersonation??!1);return{getTokens:async()=>i}},getActiveSessions:async()=>(await r._interface.listServerSessions(t.id)).map(e=>r._clientSessionFromCrud(e)),async revokeSession(e){await r._interface.deleteServerSession(e)},async setDisplayName(e){return await this.update({displayName:e})},async setClientMetadata(e){return await this.update({clientMetadata:e})},async setClientReadOnlyMetadata(e){return await this.update({clientReadOnlyMetadata:e})},async setServerMetadata(e){return await this.update({serverMetadata:e})},async setSelectedTeam(e){return await this.update({selectedTeamId:e?.id??null})},getConnectedAccount:s,useConnectedAccount:function(e,i){let s=i?.scopes?.join(" ");return N(r._serverUserOAuthConnectionCache,[t.id,e,s||"",i?.or==="redirect"],"user.useConnectedAccount()")},selectedTeam:t.selected_team?r._serverTeamFromCrud(t.selected_team):null,async getTeam(e){return(await this.listTeams()).find(t=>t.id===e)??null},useTeam(e){let t=this.useTeams();return(0,i.useMemo)(()=>t.find(t=>t.id===e)??null,[t,e])},listTeams:async()=>d.Result.orThrow(await r._serverTeamsCache.getOrWait([t.id],"write-only")).map(e=>r._serverTeamFromCrud(e)),useTeams(){let e=N(r._serverTeamsCache,[t.id],"user.useTeams()");return(0,i.useMemo)(()=>e.map(e=>r._serverTeamFromCrud(e)),[e])},createTeam:async e=>{let i=await r._interface.createServerTeam(L({creatorUserId:t.id,...e}));return await r._serverTeamsCache.refresh([void 0]),await r._updateServerUser(t.id,{selectedTeamId:i.id}),r._serverTeamFromCrud(i)},leaveTeam:async e=>{await r._interface.leaveServerTeam({teamId:e.id,userId:t.id})},async listPermissions(e,i){if(e&&"id"in e){let s=i?.recursive??!0;return d.Result.orThrow(await r._serverTeamUserPermissionsCache.getOrWait([e.id,t.id,s],"write-only")).map(e=>r._serverPermissionFromCrud(e))}{let i=e?.recursive??!0;return d.Result.orThrow(await r._serverUserProjectPermissionsCache.getOrWait([t.id,i],"write-only")).map(e=>r._serverPermissionFromCrud(e))}},usePermissions(e,s){if(e&&"id"in e){let n=s?.recursive??!0,a=N(r._serverTeamUserPermissionsCache,[e.id,t.id,n],"user.usePermissions()");return(0,i.useMemo)(()=>a.map(e=>r._serverPermissionFromCrud(e)),[a])}{let s=e?.recursive??!0,n=N(r._serverUserProjectPermissionsCache,[t.id,s],"user.usePermissions()");return(0,i.useMemo)(()=>n.map(e=>r._serverPermissionFromCrud(e)),[n])}},async getPermission(e,t){return e&&"string"!=typeof e?(await this.listPermissions(e)).find(e=>e.id===t)??null:(await this.listPermissions()).find(t=>t.id===e)??null},usePermission(e,t){if(e&&"string"!=typeof e){let r=this.usePermissions(e);return(0,i.useMemo)(()=>r.find(e=>e.id===t)??null,[r,t])}{let t=this.usePermissions();return(0,i.useMemo)(()=>t.find(t=>t.id===e)??null,[t,e])}},async hasPermission(e,t){return e&&"string"!=typeof e?await this.getPermission(e,t)!==null:await this.getPermission(e)!==null},async update(e){await r._updateServerUser(t.id,e)},sendVerificationEmail:async()=>await r._checkFeatureSupport("sendVerificationEmail() on ServerUser",{}),async updatePassword(e){let i=await r._interface.updatePassword(e);return await r._serverUserCache.refresh([t.id]),i},async setPassword(e){let i=await this.update(e);return await r._serverUserCache.refresh([t.id]),i},async getTeamProfile(e){let i=d.Result.orThrow(await r._serverUserTeamProfileCache.getOrWait([e.id,t.id],"write-only"));return r._serverEditableTeamProfileFromCrud(i)},useTeamProfile(e){let s=N(r._serverUserTeamProfileCache,[e.id,t.id],"user.useTeamProfile()");return(0,i.useMemo)(()=>r._serverEditableTeamProfileFromCrud(s),[s])},listContactChannels:async()=>d.Result.orThrow(await r._serverContactChannelsCache.getOrWait([t.id],"write-only")).map(e=>r._serverContactChannelFromCrud(t.id,e)),useContactChannels(){let e=N(r._serverContactChannelsCache,[t.id],"user.useContactChannels()");return(0,i.useMemo)(()=>e.map(e=>r._serverContactChannelFromCrud(t.id,e)),[e])},createContactChannel:async e=>{var i;let s=await r._interface.createServerContactChannel((i=t.id,{type:e.type,value:e.value,is_verified:e.isVerified,user_id:i,used_for_auth:e.usedForAuth,is_primary:e.isPrimary}));return await Promise.all([r._serverContactChannelsCache.refresh([t.id]),r._serverUserCache.refresh([t.id])]),r._serverContactChannelFromCrud(t.id,s)},useNotificationCategories:()=>N(r._serverNotificationCategoriesCache,[t.id],"user.useNotificationCategories()").map(e=>r._serverNotificationCategoryFromCrud(t.id,e)),listNotificationCategories:async()=>d.Result.orThrow(await r._serverNotificationCategoriesCache.getOrWait([t.id],"write-only")).map(e=>r._serverNotificationCategoryFromCrud(t.id,e)),useApiKeys:()=>N(r._serverUserApiKeysCache,[t.id],"user.useApiKeys()").map(e=>r._serverApiKeyFromCrud(e)),listApiKeys:async()=>d.Result.orThrow(await r._serverUserApiKeysCache.getOrWait([t.id],"write-only")).map(e=>r._serverApiKeyFromCrud(e)),async createApiKey(e){let i=await r._interface.createProjectApiKey(await K("user",t.id,e),null,"server");return await r._serverUserApiKeysCache.refresh([t.id]),r._serverApiKeyFromCrud(i)},useOAuthProviders(){let e=N(r._serverOAuthProvidersCache,[t.id],"user.useOAuthProviders()");return(0,i.useMemo)(()=>e.map(e=>r._serverOAuthProviderFromCrud(e)),[e])},listOAuthProviders:async()=>d.Result.orThrow(await r._serverOAuthProvidersCache.getOrWait([t.id],"write-only")).map(e=>r._serverOAuthProviderFromCrud(e)),useOAuthProvider(e){let t=this.useOAuthProviders();return(0,i.useMemo)(()=>t.find(t=>t.id===e)??null,[t,e])},async getOAuthProvider(e){return(await this.listOAuthProviders()).find(t=>t.id===e)??null},async registerPasskey(i){let s,n=i?.hostname||(await r._getCurrentUrl())?.hostname;if(!n)throw new o.StackAssertionError("hostname must be provided if the Stack App does not have a redirect method");let a=await r._interface.initiateServerPasskeyRegistration(t.id);if("ok"!==a.status)return d.Result.error(new D.KnownErrors.PasskeyRegistrationFailed("Failed to get initiation options for passkey registration"));let{options_json:c,code:l}=a.data;if("THIS_VALUE_WILL_BE_REPLACED.example.com"!==c.rp.id)throw new o.StackAssertionError(`Expected returned RP ID from server to equal sentinel, but found ${c.rp.id}`);c.rp.id=n;try{let{startRegistration:t}=await e.A(6957);s=await t({optionsJSON:c})}catch(r){let{WebAuthnError:t}=await e.A(6957);if(r instanceof t)return d.Result.error(new D.KnownErrors.PasskeyWebAuthnError(r.message,r.name));{let{captureError:t}=await e.A(876766);return t("passkey-registration-failed",r),d.Result.error(new D.KnownErrors.PasskeyRegistrationFailed("Failed to start passkey registration due to unknown error"))}}let{accessToken:u,refreshToken:h}=await r._interface.createServerUserSession(t.id,6e4*2,!1),p=new $.InternalSession({accessToken:u,refreshToken:h,refreshAccessTokenCallback:async()=>null}),m=await r._interface.registerPasskey({credential:s,code:l},p);return await r._serverUserCache.refresh([t.id]),m},...r._createServerCustomer(t.id,"user")};return W(n),n}_serverTeamUserFromCrud(e){let t={...this._serverUserFromCrud(e.user),teamProfile:{displayName:e.display_name,profileImageUrl:e.profile_image_url}};return W(t),t}_serverTeamInvitationFromCrud(e){return{id:e.id,recipientEmail:e.recipient_email,expiresAt:new Date(e.expires_at_millis),revoke:async()=>{await this._interface.revokeServerTeamInvitation(e.id,e.team_id),await this._serverTeamInvitationsCache.refresh([e.team_id])}}}_currentUserFromCrud(e,t){let r={...this._serverUserFromCrud(e),...this._createAuth(t),...this._isInternalProject()?this._createInternalUserExtra(t):{}};return W(r),Object.freeze(r),r}_serverTeamFromCrud(e){let t=this;return{id:e.id,displayName:e.display_name,profileImageUrl:e.profile_image_url,createdAt:new Date(e.created_at_millis),clientMetadata:e.client_metadata,clientReadOnlyMetadata:e.client_read_only_metadata,serverMetadata:e.server_metadata,async update(r){await t._interface.updateServerTeam(e.id,{display_name:r.displayName,profile_image_url:r.profileImageUrl,client_metadata:r.clientMetadata,client_read_only_metadata:r.clientReadOnlyMetadata,server_metadata:r.serverMetadata}),await t._serverTeamsCache.refresh([void 0])},async delete(){await t._interface.deleteServerTeam(e.id),await t._serverTeamsCache.refresh([void 0])},listUsers:async()=>d.Result.orThrow(await t._serverTeamMemberProfilesCache.getOrWait([e.id],"write-only")).map(e=>t._serverTeamUserFromCrud(e)),useUsers(){let r=N(t._serverTeamMemberProfilesCache,[e.id],"team.useUsers()");return(0,i.useMemo)(()=>r.map(e=>t._serverTeamUserFromCrud(e)),[r])},async addUser(r){await t._interface.addServerUserToTeam({teamId:e.id,userId:r}),await t._serverTeamMemberProfilesCache.refresh([e.id])},async removeUser(r){await t._interface.removeServerUserFromTeam({teamId:e.id,userId:r}),await t._serverTeamMemberProfilesCache.refresh([e.id])},async inviteUser(r){await t._interface.sendServerTeamInvitation({teamId:e.id,email:r.email,callbackUrl:r.callbackUrl??M(t.urls.teamInvitation,"callbackUrl")}),await t._serverTeamInvitationsCache.refresh([e.id])},listInvitations:async()=>d.Result.orThrow(await t._serverTeamInvitationsCache.getOrWait([e.id],"write-only")).map(e=>t._serverTeamInvitationFromCrud(e)),useInvitations(){let r=N(t._serverTeamInvitationsCache,[e.id],"team.useInvitations()");return(0,i.useMemo)(()=>r.map(e=>t._serverTeamInvitationFromCrud(e)),[r])},useApiKeys:()=>N(t._serverTeamApiKeysCache,[e.id],"team.useApiKeys()").map(e=>t._serverApiKeyFromCrud(e)),listApiKeys:async()=>d.Result.orThrow(await t._serverTeamApiKeysCache.getOrWait([e.id],"write-only")).map(e=>t._serverApiKeyFromCrud(e)),async createApiKey(r){let i=await t._interface.createProjectApiKey(await K("team",e.id,r),null,"server");return await t._serverTeamApiKeysCache.refresh([e.id]),t._serverApiKeyFromCrud(i)},...t._createServerCustomer(e.id,"team")}}_serverItemFromCrud(e,t){let r=this;return{displayName:t.display_name,quantity:t.quantity,nonNegativeQuantity:Math.max(0,t.quantity),increaseQuantity:async i=>{let s="user"===e.type?{itemId:t.id,userId:e.id}:"team"===e.type?{itemId:t.id,teamId:e.id}:{itemId:t.id,customCustomerId:e.id};await r._interface.updateItemQuantity(s,{delta:i}),"user"===e.type?await r._serverUserItemsCache.refresh([e.id,t.id]):"team"===e.type?await r._serverTeamItemsCache.refresh([e.id,t.id]):await r._serverCustomItemsCache.refresh([e.id,t.id])},decreaseQuantity:async i=>{let s="user"===e.type?{itemId:t.id,userId:e.id}:"team"===e.type?{itemId:t.id,teamId:e.id}:{itemId:t.id,customCustomerId:e.id};await r._interface.updateItemQuantity(s,{delta:-i,allow_negative:!0}),"user"===e.type?await r._serverUserItemsCache.refresh([e.id,t.id]):"team"===e.type?await r._serverTeamItemsCache.refresh([e.id,t.id]):await r._serverCustomItemsCache.refresh([e.id,t.id])},tryDecreaseQuantity:async i=>{try{let s="user"===e.type?{itemId:t.id,userId:e.id}:"team"===e.type?{itemId:t.id,teamId:e.id}:{itemId:t.id,customCustomerId:e.id};return await r._interface.updateItemQuantity(s,{delta:-i}),"user"===e.type?await r._serverUserItemsCache.refresh([e.id,t.id]):"team"===e.type?await r._serverTeamItemsCache.refresh([e.id,t.id]):await r._serverCustomItemsCache.refresh([e.id,t.id]),!0}catch(e){if(e instanceof D.KnownErrors.ItemQuantityInsufficientAmount)return!1;throw e}}}}async _getUserApiKey(e){let t=d.Result.orThrow(await this._serverCheckApiKeyCache.getOrWait(["user",e.apiKey],"write-only"));return t?this._serverApiKeyFromCrud(t):null}async _getTeamApiKey(e){let t=d.Result.orThrow(await this._serverCheckApiKeyCache.getOrWait(["team",e.apiKey],"write-only"));return t?this._serverApiKeyFromCrud(t):null}_useUserApiKey(e){let t=N(this._serverCheckApiKeyCache,["user",e.apiKey],"serverApp.useUserApiKey()");return(0,i.useMemo)(()=>t?this._serverApiKeyFromCrud(t):null,[t])}_useTeamApiKey(e){let t=N(this._serverCheckApiKeyCache,["team",e.apiKey],"serverApp.useTeamApiKey()");return(0,i.useMemo)(()=>t?this._serverApiKeyFromCrud(t):null,[t])}async _getUserByApiKey(e){let t=await this._getUserApiKey({apiKey:e});return null===t?null:await this.getServerUserById(t.userId)}async _getUserByConvex(e,t){let r=await e.auth.getUserIdentity();if(null===r)return null;let i=await this.getServerUserById(r.subject);return i?.isAnonymous&&!t?null:i}_useUserByConvex(e,t){let r=N(this._convexIdentitySubjectCache,[e],"serverApp.useUserByConvex()");if(null===r)return null;let i=this.useUserById(r);return i?.isAnonymous&&!t?null:i}_useUserByApiKey(e){let t=this._useUserApiKey({apiKey:e});return null===t?null:this.useUserById(t.userId)}async _getTeamByApiKey(e){let t=await this._getTeamApiKey({apiKey:e});return null===t?null:await this.getTeam(t.teamId)}_useTeamByApiKey(e){let t=this._useTeamApiKey({apiKey:e});return null===t?null:this.useTeam(t.teamId)}async createUser(e){let t=await this._interface.createServerUser({primary_email:e.primaryEmail,password:e.password,otp_auth_enabled:e.otpAuthEnabled,primary_email_auth_enabled:e.primaryEmailAuthEnabled,display_name:e.displayName,primary_email_verified:e.primaryEmailVerified,client_metadata:e.clientMetadata,client_read_only_metadata:e.clientReadOnlyMetadata,server_metadata:e.serverMetadata});return await this._refreshUsers(),this._serverUserFromCrud(t)}async getUser(e){if("string"==typeof e)return await this.getServerUserById(e);{if("object"==typeof e&&"apiKey"in e)return await this._getUserByApiKey(e.apiKey);if("object"==typeof e&&"from"in e&&"convex"===e.from)return await this._getUserByConvex(e.ctx,"or"in e&&"anonymous"===e.or);this._ensurePersistentTokenStore(e?.tokenStore);let t=await this._getSession(e?.tokenStore),r=d.Result.orThrow(await this._currentServerUserCache.getOrWait([t],"write-only"));if(r?.is_anonymous&&e?.or!=="anonymous"&&e?.or!=="anonymous-if-exists[deprecated]"&&(r=null),null===r)switch(e?.or){case"redirect":await this.redirectToSignIn({replace:!0});break;case"throw":throw Error("User is not signed in but getUser was called with { or: 'throw' }");case"anonymous":{let e=await this._signUpAnonymously();return await this.getUser({tokenStore:e,or:"anonymous-if-exists[deprecated]"})??(0,o.throwErr)("Something went wrong while signing up anonymously")}case void 0:case"anonymous-if-exists[deprecated]":case"return-null":return null}return r&&this._currentUserFromCrud(r,t)}}async getServerUser(){return console.warn("stackServerApp.getServerUser is deprecated; use stackServerApp.getUser instead"),await this.getUser()}async getServerUserById(e){let t=d.Result.orThrow(await this._serverUserCache.getOrWait([e],"write-only"));return t&&this._serverUserFromCrud(t)}useUser(e){if("string"==typeof e)return this.useUserById(e);{if("object"==typeof e&&"apiKey"in e)return this._useUserByApiKey(e.apiKey);if("object"==typeof e&&"from"in e&&"convex"===e.from)return this._useUserByConvex(e.ctx,"or"in e&&"anonymous"===e.or);this._ensurePersistentTokenStore(e?.tokenStore);let t=this._useSession(e?.tokenStore),r=N(this._currentServerUserCache,[t],"serverApp.useUser()");if(r?.is_anonymous&&e?.or!=="anonymous"&&e?.or!=="anonymous-if-exists[deprecated]"&&(r=null),null===r)switch(e?.or){case"redirect":throw(0,_.runAsynchronously)(this.redirectToSignIn({replace:!0})),(0,k.suspend)(),new o.StackAssertionError("suspend should never return");case"throw":throw Error("User is not signed in but useUser was called with { or: 'throw' }");case"anonymous":throw(0,_.runAsynchronously)(async()=>{await this._signUpAnonymously(),"undefined"!=typeof window&&window.location.reload()}),(0,k.suspend)(),new o.StackAssertionError("suspend should never return")}return(0,i.useMemo)(()=>r&&this._currentUserFromCrud(r,t),[r,t,e?.or])}}useUserById(e){let t=N(this._serverUserCache,[e],"serverApp.useUserById()");return(0,i.useMemo)(()=>t&&this._serverUserFromCrud(t),[t])}async listUsers(e){let t=d.Result.orThrow(await this._serverUsersCache.getOrWait([e?.cursor,e?.limit,e?.orderBy,e?.desc,e?.query,e?.includeAnonymous],"write-only")),r=t.items.map(e=>this._serverUserFromCrud(e));return r.nextCursor=t.pagination?.next_cursor??null,r}useUsers(e){let t=N(this._serverUsersCache,[e?.cursor,e?.limit,e?.orderBy,e?.desc,e?.query,e?.includeAnonymous],"serverApp.useUsers()"),r=t.items.map(e=>this._serverUserFromCrud(e));return r.nextCursor=t.pagination?.next_cursor??null,r}_serverPermissionFromCrud(e){return{id:e.id}}_serverTeamPermissionDefinitionFromCrud(e){return{id:e.id,description:e.description,containedPermissionIds:e.contained_permission_ids}}_serverProjectPermissionDefinitionFromCrud(e){return{id:e.id,description:e.description,containedPermissionIds:e.contained_permission_ids}}async listTeams(){return d.Result.orThrow(await this._serverTeamsCache.getOrWait([void 0],"write-only")).map(e=>this._serverTeamFromCrud(e))}async getItem(e){if("userId"in e){let t=d.Result.orThrow(await this._serverUserItemsCache.getOrWait([e.userId,e.itemId],"write-only"));return this._serverItemFromCrud({type:"user",id:e.userId},t)}if("teamId"in e){let t=d.Result.orThrow(await this._serverTeamItemsCache.getOrWait([e.teamId,e.itemId],"write-only"));return this._serverItemFromCrud({type:"team",id:e.teamId},t)}{let t=d.Result.orThrow(await this._serverCustomItemsCache.getOrWait([e.customCustomerId,e.itemId],"write-only"));return this._serverItemFromCrud({type:"custom",id:e.customCustomerId},t)}}useItem(e){let t,r,s;"userId"in e?(t="user",r=e.userId,s=this._serverUserItemsCache):"teamId"in e?(t="team",r=e.teamId,s=this._serverTeamItemsCache):(t="custom",r=e.customCustomerId,s=this._serverCustomItemsCache);let n=N(s,[r,e.itemId],"serverApp.useItem()");return(0,i.useMemo)(()=>this._serverItemFromCrud({type:t,id:r},n),[n])}async grantProduct(e){let t,r;"userId"in e?(t="user",r=e.userId):"teamId"in e?(t="team",r=e.teamId):(t="custom",r=e.customCustomerId),await this._interface.grantProduct({customerType:t,customerId:r,productId:"productId"in e?e.productId:void 0,product:"product"in e?e.product:void 0,quantity:e.quantity});let i="user"===t?this._serverUserProductsCache:"team"===t?this._serverTeamProductsCache:this._serverCustomProductsCache;await i.refresh([r,null,null])}async createTeam(e){let t=await this._interface.createServerTeam(L(e));return await this._serverTeamsCache.refresh([void 0]),this._serverTeamFromCrud(t)}useTeams(){let e=N(this._serverTeamsCache,[void 0],"serverApp.useTeams()");return(0,i.useMemo)(()=>e.map(e=>this._serverTeamFromCrud(e)),[e])}async getTeam(e){return"object"==typeof e&&"apiKey"in e?await this._getTeamByApiKey(e.apiKey):(await this.listTeams()).find(t=>t.id===e)??null}useTeam(e){if("object"==typeof e&&"apiKey"in e)return this._useTeamByApiKey(e.apiKey);{let t=this.useTeams();return(0,i.useMemo)(()=>t.find(t=>t.id===e)??null,[t,e])}}_createServerDataVaultStore(e){let t=e=>{if("string"!=typeof e.secret)throw Error("secret must be a string, got "+typeof e.secret)};return{id:e,setValue:async(r,i,s)=>{t(s),await this._interface.setDataVaultStoreValue(s.secret,e,r,i)},getValue:async(r,i)=>(t(i),d.Result.orThrow(await this._serverDataVaultStoreValueCache.getOrWait([e,r,i.secret],"write-only"))),useValue:(r,i)=>(t(i),N(this._serverDataVaultStoreValueCache,[e,r,i.secret],"store.useValue()"))}}async getDataVaultStore(e){return this._createServerDataVaultStore(e)}useDataVaultStore(e){return(0,i.useMemo)(()=>this._createServerDataVaultStore(e),[e])}async sendEmail(e){await this._interface.sendEmail(e)}async _refreshSession(e){await Promise.all([super._refreshUser(e),this._currentServerUserCache.refresh([e])])}async _refreshUsers(){await Promise.all([super._refreshUsers(),this._serverUserCache.refreshWhere(()=>!0),this._serverUsersCache.refreshWhere(()=>!0),this._serverContactChannelsCache.refreshWhere(()=>!0),this._serverOAuthProvidersCache.refreshWhere(()=>!0)])}async createOAuthProvider(e){try{let t=await this._interface.createServerOAuthProvider({user_id:e.userId,provider_config_id:e.providerConfigId,account_id:e.accountId,email:e.email,allow_sign_in:e.allowSignIn,allow_connected_accounts:e.allowConnectedAccounts});return await this._serverOAuthProvidersCache.refresh([e.userId]),d.Result.ok(this._serverOAuthProviderFromCrud(t))}catch(e){if(D.KnownErrors.OAuthProviderAccountIdAlreadyUsedForSignIn.isInstance(e))return d.Result.error(e);throw e}}},eP=class extends eO{constructor(e,t){const r=E(e);super(r,{...t,interface:t?.interface??new a.StackAdminInterface({getBaseUrl:()=>P(r.baseUrl),projectId:r.projectId??A(),extraRequestHeaders:r.extraRequestHeaders??O(),clientVersion:C,...r.projectOwnerSession?{projectOwnerSession:r.projectOwnerSession}:{publishableClientKey:r.publishableClientKey??I(),secretServerKey:r.secretServerKey??R(),superSecretAdminKey:r.superSecretAdminKey??(m.default.env.STACK_SUPER_SECRET_ADMIN_KEY||(0,o.throwErr)(Error("No super secret admin key provided. Please copy your key from the Stack dashboard and put it in the STACK_SUPER_SECRET_ADMIN_KEY environment variable.")))}})}),this._adminProjectCache=S(async()=>await this._interface.getProject()),this._internalApiKeysCache=S(async()=>await this._interface.listInternalApiKeys()),this._adminEmailThemeCache=S(async([e])=>await this._interface.getEmailTheme(e)),this._adminEmailThemesCache=S(async()=>await this._interface.listEmailThemes()),this._adminEmailTemplatesCache=S(async()=>await this._interface.listInternalEmailTemplates()),this._adminEmailDraftsCache=S(async()=>await this._interface.listInternalEmailDrafts()),this._adminTeamPermissionDefinitionsCache=S(async()=>await this._interface.listTeamPermissionDefinitions()),this._adminProjectPermissionDefinitionsCache=S(async()=>await this._interface.listProjectPermissionDefinitions()),this._svixTokenCache=S(async()=>await this._interface.getSvixToken()),this._metricsCache=S(async([e])=>await this._interface.getMetrics(e)),this._emailPreviewCache=S(async([e,t,r,i])=>await this._interface.renderEmailPreview({themeId:e,themeTsxSource:t,templateId:r,templateTsxSource:i})),this._configOverridesCache=S(async()=>await this._interface.getConfig()),this._stripeAccountInfoCache=S(async()=>{try{return await this._interface.getStripeAccountInfo()}catch(e){if(e?.status===404)return null;throw e}}),this._transactionsCache=S(async([e,t,r,i])=>await this._interface.listTransactions({cursor:e,limit:t,type:r,customerType:i}))}_adminConfigFromCrud(e){return JSON.parse(e.config_string)}_adminOwnedProjectFromCrud(e,t){if(null!==this._tokenStoreInit)throw new o.StackAssertionError("Owned apps must always have tokenStore === null  did you not create this project with app._createOwnedApp()?");return{...this._adminProjectFromCrud(e,t),app:this}}_adminProjectFromCrud(e,t){if(e.id!==this.projectId)throw new o.StackAssertionError(`The project ID of the provided project JSON (${e.id}) does not match the project ID of the app (${this.projectId})!`);let r=this;return{id:e.id,displayName:e.display_name,description:e.description,createdAt:new Date(e.created_at_millis),isProductionMode:e.is_production_mode,ownerTeamId:e.owner_team_id,logoUrl:e.logo_url,fullLogoUrl:e.full_logo_url,config:{signUpEnabled:e.config.sign_up_enabled,credentialEnabled:e.config.credential_enabled,magicLinkEnabled:e.config.magic_link_enabled,passkeyEnabled:e.config.passkey_enabled,clientTeamCreationEnabled:e.config.client_team_creation_enabled,clientUserDeletionEnabled:e.config.client_user_deletion_enabled,allowLocalhost:e.config.allow_localhost,oauthAccountMergeStrategy:e.config.oauth_account_merge_strategy,allowUserApiKeys:e.config.allow_user_api_keys,allowTeamApiKeys:e.config.allow_team_api_keys,oauthProviders:e.config.oauth_providers.map(e=>"shared"===e.type?{id:e.id,type:"shared"}:{id:e.id,type:"standard",clientId:e.client_id??(0,o.throwErr)("Client ID is missing"),clientSecret:e.client_secret??(0,o.throwErr)("Client secret is missing"),facebookConfigId:e.facebook_config_id,microsoftTenantId:e.microsoft_tenant_id}),emailConfig:"shared"===e.config.email_config.type?{type:"shared"}:{type:"standard",host:e.config.email_config.host??(0,o.throwErr)("Email host is missing"),port:e.config.email_config.port??(0,o.throwErr)("Email port is missing"),username:e.config.email_config.username??(0,o.throwErr)("Email username is missing"),password:e.config.email_config.password??(0,o.throwErr)("Email password is missing"),senderName:e.config.email_config.sender_name??(0,o.throwErr)("Email sender name is missing"),senderEmail:e.config.email_config.sender_email??(0,o.throwErr)("Email sender email is missing")},emailTheme:e.config.email_theme,domains:e.config.domains.map(e=>({domain:e.domain,handlerPath:e.handler_path})),createTeamOnSignUp:e.config.create_team_on_sign_up,teamCreatorDefaultPermissions:e.config.team_creator_default_permissions,teamMemberDefaultPermissions:e.config.team_member_default_permissions,userDefaultPermissions:e.config.user_default_permissions},getConfig:async()=>r._adminConfigFromCrud(await r._interface.getConfig()),useConfig(){let e=N(r._configOverridesCache,[],"project.useConfig()");return(0,i.useMemo)(()=>r._adminConfigFromCrud(e),[e])},async updateConfig(e){await r._interface.updateConfig({configOverride:e}),await r._configOverridesCache.refresh([])},async update(e){let i=p(e);await r._interface.updateProject(i),await t()},async delete(){await r._interface.deleteProject()},getProductionModeErrors:async()=>l(e),useProductionModeErrors:()=>l(e)}}_adminEmailTemplateFromCrud(e){return{type:e.type,subject:e.subject,content:e.content,isDefault:e.is_default}}async getProject(){return this._adminProjectFromCrud(d.Result.orThrow(await this._adminProjectCache.getOrWait([],"write-only")),()=>this._refreshProject())}useProject(){let e=N(this._adminProjectCache,[],"adminApp.useProject()");return(0,i.useMemo)(()=>this._adminProjectFromCrud(e,()=>this._refreshProject()),[e])}_createInternalApiKeyBaseFromCrud(e){let t=this;return{id:e.id,description:e.description,expiresAt:new Date(e.expires_at_millis),manuallyRevokedAt:e.manually_revoked_at_millis?new Date(e.manually_revoked_at_millis):null,createdAt:new Date(e.created_at_millis),isValid(){return null===this.whyInvalid()},whyInvalid(){return this.expiresAt.getTime()<Date.now()?"expired":this.manuallyRevokedAt?"manually-revoked":null},async revoke(){let r=await t._interface.revokeInternalApiKeyById(e.id);return await t._refreshInternalApiKeys(),r}}}_createInternalApiKeyFromCrud(e){return{...this._createInternalApiKeyBaseFromCrud(e),publishableClientKey:e.publishable_client_key?{lastFour:e.publishable_client_key.last_four}:null,secretServerKey:e.secret_server_key?{lastFour:e.secret_server_key.last_four}:null,superSecretAdminKey:e.super_secret_admin_key?{lastFour:e.super_secret_admin_key.last_four}:null}}_createInternalApiKeyFirstViewFromCrud(e){return{...this._createInternalApiKeyBaseFromCrud(e),publishableClientKey:e.publishable_client_key,secretServerKey:e.secret_server_key,superSecretAdminKey:e.super_secret_admin_key}}async listInternalApiKeys(){return d.Result.orThrow(await this._internalApiKeysCache.getOrWait([],"write-only")).map(e=>this._createInternalApiKeyFromCrud(e))}useInternalApiKeys(){let e=N(this._internalApiKeysCache,[],"adminApp.useInternalApiKeys()");return(0,i.useMemo)(()=>e.map(e=>this._createInternalApiKeyFromCrud(e)),[e])}async createInternalApiKey(e){let t=await this._interface.createInternalApiKey({description:e.description,expires_at_millis:e.expiresAt.getTime(),has_publishable_client_key:e.hasPublishableClientKey,has_secret_server_key:e.hasSecretServerKey,has_super_secret_admin_key:e.hasSuperSecretAdminKey});return await this._refreshInternalApiKeys(),this._createInternalApiKeyFirstViewFromCrud(t)}useEmailThemes(){let e=N(this._adminEmailThemesCache,[],"adminApp.useEmailThemes()");return(0,i.useMemo)(()=>e.map(e=>({id:e.id,displayName:e.display_name})),[e])}useEmailTemplates(){let e=N(this._adminEmailTemplatesCache,[],"adminApp.useEmailTemplates()");return(0,i.useMemo)(()=>e.map(e=>({id:e.id,displayName:e.display_name,themeId:e.theme_id,tsxSource:e.tsx_source})),[e])}useEmailDrafts(){let e=N(this._adminEmailDraftsCache,[],"adminApp.useEmailDrafts()");return(0,i.useMemo)(()=>e.map(e=>({id:e.id,displayName:e.display_name,themeId:e.theme_id,tsxSource:e.tsx_source,sentAt:e.sent_at_millis?new Date(e.sent_at_millis):null})),[e])}async listEmailThemes(){return d.Result.orThrow(await this._adminEmailThemesCache.getOrWait([],"write-only")).map(e=>({id:e.id,displayName:e.display_name}))}async listEmailTemplates(){return d.Result.orThrow(await this._adminEmailTemplatesCache.getOrWait([],"write-only")).map(e=>({id:e.id,displayName:e.display_name,themeId:e.theme_id,tsxSource:e.tsx_source}))}async listEmailDrafts(){return d.Result.orThrow(await this._adminEmailDraftsCache.getOrWait([],"write-only")).map(e=>({id:e.id,displayName:e.display_name,themeId:e.theme_id,tsxSource:e.tsx_source,sentAt:e.sent_at_millis?new Date(e.sent_at_millis):null}))}async createTeamPermissionDefinition(e){let t=await this._interface.createTeamPermissionDefinition({id:e.id,description:e.description,contained_permission_ids:e.containedPermissionIds});return await this._adminTeamPermissionDefinitionsCache.refresh([]),this._serverTeamPermissionDefinitionFromCrud(t)}async updateTeamPermissionDefinition(e,t){await this._interface.updateTeamPermissionDefinition(e,{description:t.description,contained_permission_ids:t.containedPermissionIds}),await this._adminTeamPermissionDefinitionsCache.refresh([])}async deleteTeamPermissionDefinition(e){await this._interface.deleteTeamPermissionDefinition(e),await this._adminTeamPermissionDefinitionsCache.refresh([])}async listTeamPermissionDefinitions(){return d.Result.orThrow(await this._adminTeamPermissionDefinitionsCache.getOrWait([],"write-only")).map(e=>this._serverTeamPermissionDefinitionFromCrud(e))}useTeamPermissionDefinitions(){let e=N(this._adminTeamPermissionDefinitionsCache,[],"adminApp.useTeamPermissionDefinitions()");return(0,i.useMemo)(()=>e.map(e=>this._serverTeamPermissionDefinitionFromCrud(e)),[e])}async createProjectPermissionDefinition(e){let t=await this._interface.createProjectPermissionDefinition({id:e.id,description:e.description,contained_permission_ids:e.containedPermissionIds});return await this._adminProjectPermissionDefinitionsCache.refresh([]),this._serverProjectPermissionDefinitionFromCrud(t)}async updateProjectPermissionDefinition(e,t){await this._interface.updateProjectPermissionDefinition(e,{description:t.description,contained_permission_ids:t.containedPermissionIds}),await this._adminProjectPermissionDefinitionsCache.refresh([])}async deleteProjectPermissionDefinition(e){await this._interface.deleteProjectPermissionDefinition(e),await this._adminProjectPermissionDefinitionsCache.refresh([])}async listProjectPermissionDefinitions(){return d.Result.orThrow(await this._adminProjectPermissionDefinitionsCache.getOrWait([],"write-only")).map(e=>this._serverProjectPermissionDefinitionFromCrud(e))}useProjectPermissionDefinitions(){let e=N(this._adminProjectPermissionDefinitionsCache,[],"adminApp.useProjectPermissionDefinitions()");return(0,i.useMemo)(()=>e.map(e=>this._serverProjectPermissionDefinitionFromCrud(e)),[e])}useSvixToken(){return N(this._svixTokenCache,[],"adminApp.useSvixToken()").token}async _refreshProject(){await Promise.all([super._refreshProject(),this._adminProjectCache.refresh([])])}async _refreshInternalApiKeys(){await this._internalApiKeysCache.refresh([])}async _refreshUsers(){await Promise.all([super._refreshUsers(),this._metricsCache.refresh([!1]),this._metricsCache.refresh([!0])])}get[h](){return{...super[h],useMetrics:(e=!1)=>N(this._metricsCache,[e],"adminApp.useMetrics()")}}async sendTestEmail(e){let t=await this._interface.sendTestEmail({recipient_email:e.recipientEmail,email_config:{...(0,u.pick)(e.emailConfig,["host","port","username","password"]),sender_email:e.emailConfig.senderEmail,sender_name:e.emailConfig.senderName}});return t.success?d.Result.ok(void 0):d.Result.error({errorMessage:t.error_message??(0,o.throwErr)("Email test error not specified")})}async sendTestWebhook(e){let t=await this._interface.sendTestWebhook({endpoint_id:e.endpointId});return t.success?d.Result.ok(void 0):d.Result.error({errorMessage:t.error_message??(0,o.throwErr)("Webhook test error not specified")})}async listSentEmails(){return(await this._interface.listSentEmails()).items.map(e=>({id:e.id,to:e.to??[],subject:e.subject,recipient:e.to?.[0]??"",sentAt:new Date(e.sent_at_millis),error:e.error}))}async sendSignInInvitationEmail(e,t){await this._interface.sendSignInInvitationEmail(e,t)}async createEmailTemplate(e){let t=await this._interface.createEmailTemplate(e);return await this._adminEmailTemplatesCache.refresh([]),t}async createEmailDraft(e){let t=await this._interface.createEmailDraft({display_name:e.displayName,theme_id:e.themeId,tsx_source:e.tsxSource});return await this._adminEmailDraftsCache.refresh([]),t}async updateEmailDraft(e,t){await this._interface.updateEmailDraft(e,{display_name:t.displayName,theme_id:t.themeId,tsx_source:t.tsxSource}),await this._adminEmailDraftsCache.refresh([])}async sendChatMessage(e,t,r,i){return await this._interface.sendChatMessage(e,t,r,i)}async saveChatMessage(e,t){await this._interface.saveChatMessage(e,t)}async listChatMessages(e){return await this._interface.listChatMessages(e)}async createEmailTheme(e){let t=await this._interface.createEmailTheme(e);return await this._adminEmailThemesCache.refresh([]),t}async getEmailPreview(e){return(await this._interface.renderEmailPreview(e)).html}useEmailPreview(e){return N(this._emailPreviewCache,[e.themeId,e.themeTsxSource,e.templateId,e.templateTsxSource],"adminApp.useEmailPreview()").html}useEmailTheme(e){let t=N(this._adminEmailThemeCache,[e],"adminApp.useEmailTheme()");return{displayName:t.display_name,tsxSource:t.tsx_source}}async updateEmailTheme(e,t){await this._interface.updateEmailTheme(e,t)}async updateEmailTemplate(e,t,r){let i=await this._interface.updateEmailTemplate(e,t,r);return await this._adminEmailTemplatesCache.refresh([]),{renderedHtml:i.rendered_html}}async setupPayments(){return await this._interface.setupPayments()}async createStripeWidgetAccountSession(){return await this._interface.createStripeWidgetAccountSession()}async createItemQuantityChange(e){await this._interface.updateItemQuantity({itemId:e.itemId,..."userId"in e?{userId:e.userId}:"teamId"in e?{teamId:e.teamId}:{customCustomerId:e.customCustomerId}},{delta:e.quantity,expires_at:e.expiresAt,description:e.description,allow_negative:!0})}async listTransactions(e){return d.Result.orThrow(await this._transactionsCache.getOrWait([e.cursor,e.limit,e.type,e.customerType],"write-only"))}useTransactions(e){return N(this._transactionsCache,[e.cursor,e.limit,e.type,e.customerType],"adminApp.useTransactions()")}async getStripeAccountInfo(){return await this._interface.getStripeAccountInfo()}useStripeAccountInfo(){return N(this._stripeAccountInfoCache,[],"adminApp.useStripeAccountInfo()")}},{_StackAdminAppImpl:ex,_StackClientAppImpl:ej,_StackServerAppImpl:eU}=(eR.LazyStackAdminAppImpl.value=eP,{_StackAdminAppImpl:n(eP),_StackClientAppImpl:n(eR),_StackServerAppImpl:n(eO)}),eN=e.i(662790),eD=i.default.createContext(null);function eF(e){let t=e.serialized?ej[h].fromClientJson(e.app):e.app;return s.globalVar.__STACK_AUTH__={app:t},(0,eN.jsx)(eD.Provider,{value:{app:t},children:e.children})}function e$(e){let t=eK();return(0,i.useEffect)(()=>{let r=(async()=>await e.userJsonPromise)();t[h].setCurrentUser(r)},[]),null}function eM(e={}){let t=eK(e);if(e.projectIdMustMatch&&t.projectId!==e.projectIdMustMatch)throw Error("Unexpected project ID in useStackApp: "+t.projectId);return e.projectIdMustMatch,t.useUser(e)}function eK(e={}){if("function"!=typeof i.useContext)throw Error("useStackApp() can only be used in a React Client Component. Make sure you're not calling it from a Server Component, or any other environment.");let t=(0,i.useContext)(eD);if(null===t)throw Error("useStackApp must be used within a StackProvider");let r=t.app;if(e.projectIdMustMatch&&r.projectId!==e.projectIdMustMatch)throw Error("Unexpected project ID in useStackApp: "+r.projectId);return r}},205263,e=>{"use strict";var t=e.i(91e3),r=e.i(91134),i=e.i(717817),s=class extends t.StatusError{constructor(e,t,r){super(e,t),this.statusCode=e,this.humanReadableMessage=t,this.details=r,this.__stackKnownErrorBrand="stack-known-error-brand-sentinel",this.name="KnownError"}static isKnownError(e){return"object"==typeof e&&null!==e&&"__stackKnownErrorBrand"in e&&"stack-known-error-brand-sentinel"===e.__stackKnownErrorBrand}getBody(){return new TextEncoder().encode(JSON.stringify(this.toDescriptiveJson(),void 0,2))}getHeaders(){return{"Content-Type":["application/json; charset=utf-8"],"X-Stack-Known-Error":[this.errorCode]}}toDescriptiveJson(){return{code:this.errorCode,...this.details?{details:this.details}:{},error:this.humanReadableMessage}}get errorCode(){return this.constructor.errorCode??(0,t.throwErr)(`Can't find error code for this KnownError. Is its constructor a KnownErrorConstructor? ${this}`)}static constructorArgsFromJson(e){return[400,e.message,e]}static fromJson(e){for(let[t,r]of Object.entries(ta))if(e.code===r.prototype.errorCode){let t=r.constructorArgsFromJson(e);return new r(...t)}throw Error(`Unknown KnownError code. You may need to update your version of Stack to see more detailed information. ${e.code}: ${e.message}`)}};function n(e,t,i,n){let a="inherit"===i?r.identityArgs:i,o="inherit"===n?e.constructorArgsFromJson:n;class c extends e{constructor(...e){super(...a(...e)),this.name=`KnownError<${t}>`,this.constructorArgs=e}static constructorArgsFromJson(e){return o(e.details)}static isInstance(e){if(!s.isKnownError(e))return!1;let r=e;for(;r=Object.getPrototypeOf(r);)if("errorCode"in r.constructor&&r.constructor.errorCode===t)return!0;return!1}}return c.errorCode=t,c}Symbol("knownErrorConstructorErrorCodeSentinel");var a=n(s,"UNSUPPORTED_ERROR",e=>[500,`An error occurred that is not currently supported (possibly because it was added in a version of Stack that is newer than this client). The original unsupported error code was: ${e}`,{originalErrorCode:e}],e=>[e?.originalErrorCode??(0,t.throwErr)("originalErrorCode not found in UnsupportedError details")]),o=n(s,"BODY_PARSING_ERROR",e=>[400,e],e=>[e.message]),c=n(s,"SCHEMA_ERROR",e=>[400,e||(0,t.throwErr)("SchemaError requires a message"),{message:e}],e=>[e.message]),l=n(s,"ALL_OVERLOADS_FAILED",e=>[400,i.deindent`
      This endpoint has multiple overloads, but they all failed to process the request.

        ${e.map((e,t)=>i.deindent`
          Overload ${t+1}: ${JSON.stringify(e,void 0,2)}
        `).join("\n\n")}
    `,{overload_errors:e}],e=>[e?.overload_errors??(0,t.throwErr)("overload_errors not found in AllOverloadsFailed details")]),u=n(s,"PROJECT_AUTHENTICATION_ERROR","inherit","inherit"),d=n(u,"INVALID_PROJECT_AUTHENTICATION","inherit","inherit"),h=n(d,"PROJECT_KEY_WITHOUT_ACCESS_TYPE",()=>[400,"Either an API key or an admin access token was provided, but the x-stack-access-type header is missing. Set it to 'client', 'server', or 'admin' as appropriate."],()=>[]),p=n(d,"INVALID_ACCESS_TYPE",e=>[400,`The x-stack-access-type header must be 'client', 'server', or 'admin', but was '${e}'.`],e=>[e?.accessType??(0,t.throwErr)("accessType not found in InvalidAccessType details")]),m=n(d,"ACCESS_TYPE_WITHOUT_PROJECT_ID",e=>[400,i.deindent`
      The x-stack-access-type header was '${e}', but the x-stack-project-id header was not provided.
      
      For more information, see the docs on REST API authentication: https://docs.stack-auth.com/rest-api/overview#authentication
    `,{request_type:e}],e=>[e.request_type]),f=n(d,"ACCESS_TYPE_REQUIRED",()=>[400,i.deindent`
      You must specify an access level for this Stack project. Make sure project API keys are provided (eg. x-stack-publishable-client-key) and you set the x-stack-access-type header to 'client', 'server', or 'admin'.
      
      For more information, see the docs on REST API authentication: https://docs.stack-auth.com/rest-api/overview#authentication
    `],()=>[]),y=n(d,"INSUFFICIENT_ACCESS_TYPE",(e,t)=>[401,`The x-stack-access-type header must be ${t.map(e=>`'${e}'`).join(" or ")}, but was '${e}'.`,{actual_access_type:e,allowed_access_types:t}],e=>[e.actual_access_type,e.allowed_access_types]),_=n(d,"INVALID_PUBLISHABLE_CLIENT_KEY",e=>[401,`The publishable key is not valid for the project ${JSON.stringify(e)}. Does the project and/or the key exist?`,{project_id:e}],e=>[e.project_id]),w=n(d,"INVALID_SECRET_SERVER_KEY",e=>[401,`The secret server key is not valid for the project ${JSON.stringify(e)}. Does the project and/or the key exist?`,{project_id:e}],e=>[e.project_id]),g=n(d,"INVALID_SUPER_SECRET_ADMIN_KEY",e=>[401,`The super secret admin key is not valid for the project ${JSON.stringify(e)}. Does the project and/or the key exist?`,{project_id:e}],e=>[e.project_id]),v=n(d,"INVALID_ADMIN_ACCESS_TOKEN","inherit","inherit"),T=n(v,"UNPARSABLE_ADMIN_ACCESS_TOKEN",()=>[401,"Admin access token is not parsable."],()=>[]),k=n(v,"ADMIN_ACCESS_TOKEN_EXPIRED",e=>[401,`Admin access token has expired. Please refresh it and try again.${e?` (The access token expired at ${e.toISOString()}.)`:""}`,{expired_at_millis:e?.getTime()??null}],e=>[e.expired_at_millis?new Date(e.expired_at_millis):void 0]),C=n(v,"INVALID_PROJECT_FOR_ADMIN_ACCESS_TOKEN",()=>[401,"Admin access tokens must be created on the internal project."],()=>[]),S=n(v,"ADMIN_ACCESS_TOKEN_IS_NOT_ADMIN",()=>[401,"Admin access token does not have the required permissions to access this project."],()=>[]),b=n(u,"PROJECT_AUTHENTICATION_REQUIRED","inherit","inherit"),E=n(b,"CLIENT_AUTHENTICATION_REQUIRED",()=>[401,"The publishable client key must be provided."],()=>[]),A=n(b,"SERVER_AUTHENTICATION_REQUIRED",()=>[401,"The secret server key must be provided."],()=>[]),I=n(b,"CLIENT_OR_SERVER_AUTHENTICATION_REQUIRED",()=>[401,"Either the publishable client key or the secret server key must be provided."],()=>[]),R=n(b,"CLIENT_OR_ADMIN_AUTHENTICATION_REQUIRED",()=>[401,"Either the publishable client key or the super secret admin key must be provided."],()=>[]),O=n(b,"CLIENT_OR_SERVER_OR_ADMIN_AUTHENTICATION_REQUIRED",()=>[401,"Either the publishable client key, the secret server key, or the super secret admin key must be provided."],()=>[]),P=n(b,"ADMIN_AUTHENTICATION_REQUIRED",()=>[401,"The super secret admin key must be provided."],()=>[]),x=n(u,"EXPECTED_INTERNAL_PROJECT",()=>[401,"The project ID is expected to be internal."],()=>[]),j=n(s,"SESSION_AUTHENTICATION_ERROR","inherit","inherit"),U=n(j,"INVALID_SESSION_AUTHENTICATION","inherit","inherit"),N=n(U,"INVALID_ACCESS_TOKEN","inherit","inherit"),D=n(N,"UNPARSABLE_ACCESS_TOKEN",()=>[401,"Access token is not parsable."],()=>[]),F=n(N,"ACCESS_TOKEN_EXPIRED",e=>[401,`Access token has expired. Please refresh it and try again.${e?` (The access token expired at ${e.toISOString()}.)`:""}`,{expired_at_millis:e?.getTime()??null}],e=>[e.expired_at_millis?new Date(e.expired_at_millis):void 0]),$=n(N,"INVALID_PROJECT_FOR_ACCESS_TOKEN",(e,t)=>[401,`Access token not valid for this project. Expected project ID ${JSON.stringify(e)}, but the token is for project ID ${JSON.stringify(t)}.`,{expected_project_id:e,actual_project_id:t}],e=>[e.expected_project_id,e.actual_project_id]),M=n(s,"REFRESH_TOKEN_ERROR","inherit","inherit"),K=n(M,"REFRESH_TOKEN_NOT_FOUND_OR_EXPIRED",()=>[401,"Refresh token not found for this project, or the session has expired/been revoked."],()=>[]),q=n(M,"CANNOT_DELETE_CURRENT_SESSION",()=>[400,"Cannot delete the current session."],()=>[]),L=n(M,"PROVIDER_REJECTED",()=>[401,"The provider refused to refresh their token. This usually means that the provider used to authenticate the user no longer regards this session as valid, and the user must re-authenticate."],()=>[]),V=n(s,"USER_EMAIL_ALREADY_EXISTS",(e,t=!1)=>[409,`A user with email ${JSON.stringify(e)} already exists${t?" but the email is not verified. Please login to your existing account with the method you used to sign up, and then verify your email to sign in with this login method.":"."}`,{email:e,would_work_if_email_was_verified:t}],e=>[e.email,e.would_work_if_email_was_verified??!1]),W=n(s,"EMAIL_NOT_VERIFIED",()=>[400,"The email is not verified."],()=>[]),J=n(s,"CANNOT_GET_OWN_USER_WITHOUT_USER",()=>[400,"You have specified 'me' as a userId, but did not provide authentication for a user."],()=>[]),H=n(s,"USER_ID_DOES_NOT_EXIST",e=>[400,`The given user with the ID ${e} does not exist.`,{user_id:e}],e=>[e.user_id]),B=n(s,"USER_NOT_FOUND",()=>[404,"User not found."],()=>[]),z=n(s,"PROJECT_NOT_FOUND",e=>{if("string"!=typeof e)throw new t.StackAssertionError("projectId of KnownErrors.ProjectNotFound must be a string");return[404,`Project ${e} not found or is not accessible with the current user.`,{project_id:e}]},e=>[e.project_id]),Y=n(s,"CURRENT_PROJECT_NOT_FOUND",e=>[400,`The current project with ID ${e} was not found. Please check the value of the x-stack-project-id header.`,{project_id:e}],e=>[e.project_id]),G=n(s,"BRANCH_DOES_NOT_EXIST",e=>[400,`The branch with ID ${e} does not exist.`,{branch_id:e}],e=>[e.branch_id]),X=n(s,"SIGN_UP_NOT_ENABLED",()=>[400,"Creation of new accounts is not enabled for this project. Please ask the project owner to enable it."],()=>[]),Q=n(s,"PASSWORD_AUTHENTICATION_NOT_ENABLED",()=>[400,"Password authentication is not enabled for this project."],()=>[]),Z=n(s,"DATA_VAULT_STORE_DOES_NOT_EXIST",e=>[400,`Data vault store with ID ${e} does not exist.`,{store_id:e}],e=>[e.store_id]),ee=n(s,"DATA_VAULT_STORE_HASHED_KEY_DOES_NOT_EXIST",(e,t)=>[400,`Data vault store with ID ${e} does not contain a key with hash ${t}.`,{store_id:e,hashed_key:t}],e=>[e.store_id,e.hashed_key]),et=n(s,"PASSKEY_AUTHENTICATION_NOT_ENABLED",()=>[400,"Passkey authentication is not enabled for this project."],()=>[]),er=n(s,"ANONYMOUS_ACCOUNTS_NOT_ENABLED",()=>[400,"Anonymous accounts are not enabled for this project."],()=>[]),ei=n(s,"ANONYMOUS_AUTHENTICATION_NOT_ALLOWED",()=>[401,"X-Stack-Access-Token is for an anonymous user, but anonymous users are not enabled. Set the X-Stack-Allow-Anonymous-User header of this request to 'true' to allow anonymous users."],()=>[]),es=n(s,"EMAIL_PASSWORD_MISMATCH",()=>[400,"Wrong e-mail or password."],()=>[]),en=n(s,"REDIRECT_URL_NOT_WHITELISTED",()=>[400,"Redirect URL not whitelisted. Did you forget to add this domain to the trusted domains list on the Stack Auth dashboard?"],()=>[]),ea=n(s,"PASSWORD_REQUIREMENTS_NOT_MET","inherit","inherit"),eo=n(ea,"PASSWORD_TOO_SHORT",e=>[400,`Password too short. Minimum length is ${e}.`,{min_length:e}],e=>[e?.min_length??(0,t.throwErr)("min_length not found in PasswordTooShort details")]),ec=n(ea,"PASSWORD_TOO_LONG",e=>[400,`Password too long. Maximum length is ${e}.`,{maxLength:e}],e=>[e?.maxLength??(0,t.throwErr)("maxLength not found in PasswordTooLong details")]),el=n(s,"USER_DOES_NOT_HAVE_PASSWORD",()=>[400,"This user does not have password authentication enabled."],()=>[]),eu=n(s,"VERIFICATION_ERROR","inherit","inherit"),ed=n(eu,"VERIFICATION_CODE_NOT_FOUND",()=>[404,"The verification code does not exist for this project."],()=>[]),eh=n(eu,"VERIFICATION_CODE_EXPIRED",()=>[400,"The verification code has expired."],()=>[]),ep=n(eu,"VERIFICATION_CODE_ALREADY_USED",()=>[409,"The verification link has already been used."],()=>[]),em=n(eu,"VERIFICATION_CODE_MAX_ATTEMPTS_REACHED",()=>[400,"The verification code nonce has reached the maximum number of attempts. This code is not valid anymore."],()=>[]),ef=n(s,"PASSWORD_CONFIRMATION_MISMATCH",()=>[400,"Passwords do not match."],()=>[]),ey=n(s,"EMAIL_ALREADY_VERIFIED",()=>[409,"The e-mail is already verified."],()=>[]),e_=n(s,"EMAIL_NOT_ASSOCIATED_WITH_USER",()=>[400,"The e-mail is not associated with a user that could log in with that e-mail."],()=>[]),ew=n(s,"EMAIL_IS_NOT_PRIMARY_EMAIL",(e,t)=>[400,`The given e-mail (${e}) must equal the user's primary e-mail (${t}).`,{email:e,primary_email:t}],e=>[e.email,e.primary_email]),eg=n(s,"PASSKEY_REGISTRATION_FAILED",e=>[400,e],e=>[e.message]),ev=n(s,"PASSKEY_WEBAUTHN_ERROR",(e,t)=>[400,e,{message:e,code:t}],e=>[e.message,e.code]),eT=n(s,"PASSKEY_AUTHENTICATION_FAILED",e=>[400,e],e=>[e.message]),ek=n(s,"PERMISSION_NOT_FOUND",e=>[404,`Permission "${e}" not found. Make sure you created it on the dashboard.`,{permission_id:e}],e=>[e.permission_id]),eC=n(s,"WRONG_PERMISSION_SCOPE",(e,t,r)=>[404,`Permission ${JSON.stringify(e)} not found. (It was found for a different scope ${JSON.stringify(r)}, but scope ${JSON.stringify(t)} was expected.)`,{permission_id:e,expected_scope:t,actual_scope:r}],e=>[e.permission_id,e.expected_scope,e.actual_scope]),eS=n(s,"CONTAINED_PERMISSION_NOT_FOUND",e=>[400,`Contained permission with ID "${e}" not found. Make sure you created it on the dashboard.`,{permission_id:e}],e=>[e.permission_id]),eb=n(s,"TEAM_NOT_FOUND",e=>[404,`Team ${e} not found.`,{team_id:e}],e=>[e.team_id]);n(s,"TEAM_ALREADY_EXISTS",e=>[409,`Team ${e} already exists.`,{team_id:e}],e=>[e.team_id]);var eE=n(s,"TEAM_MEMBERSHIP_NOT_FOUND",(e,t)=>[404,`User ${t} is not found in team ${e}.`,{team_id:e,user_id:t}],e=>[e.team_id,e.user_id]),eA=n(s,"EMAIL_TEMPLATE_ALREADY_EXISTS",()=>[409,"Email template already exists."],()=>[]),eI=n(s,"OAUTH_CONNECTION_NOT_CONNECTED_TO_USER",()=>[400,"The OAuth connection is not connected to any user."],()=>[]),eR=n(s,"OAUTH_CONNECTION_ALREADY_CONNECTED_TO_ANOTHER_USER",()=>[409,"The OAuth connection is already connected to another user."],()=>[]),eO=n(s,"OAUTH_CONNECTION_DOES_NOT_HAVE_REQUIRED_SCOPE",()=>[400,"The OAuth connection does not have the required scope."],()=>[]),eP=n(s,"OAUTH_EXTRA_SCOPE_NOT_AVAILABLE_WITH_SHARED_OAUTH_KEYS",()=>[400,"Extra scopes are not available with shared OAuth keys. Please add your own OAuth keys on the Stack dashboard to use extra scopes."],()=>[]),ex=n(s,"OAUTH_ACCESS_TOKEN_NOT_AVAILABLE_WITH_SHARED_OAUTH_KEYS",()=>[400,"Access tokens are not available with shared OAuth keys. Please add your own OAuth keys on the Stack dashboard to use access tokens."],()=>[]),ej=n(s,"INVALID_OAUTH_CLIENT_ID_OR_SECRET",e=>[400,"The OAuth client ID or secret is invalid. The client ID must be equal to the project ID (potentially with a hash and a branch ID), and the client secret must be a publishable client key.",{client_id:e??null}],e=>[e.client_id??void 0]),eU=n(s,"INVALID_SCOPE",e=>[400,`The scope "${e}" is not a valid OAuth scope for Stack.`],e=>[e.scope]),eN=n(s,"USER_ALREADY_CONNECTED_TO_ANOTHER_OAUTH_CONNECTION",()=>[409,"The user is already connected to another OAuth account. Did you maybe selected the wrong account?"],()=>[]),eD=n(s,"OUTER_OAUTH_TIMEOUT",()=>[408,"The OAuth flow has timed out. Please sign in again."],()=>[]),eF=n(s,"OAUTH_PROVIDER_NOT_FOUND_OR_NOT_ENABLED",()=>[400,"The OAuth provider is not found or not enabled."],()=>[]),e$=n(s,"OAUTH_PROVIDER_ACCOUNT_ID_ALREADY_USED_FOR_SIGN_IN",()=>[400,"A provider with the same account ID is already used for signing in."],()=>[]),eM=n(s,"MULTI_FACTOR_AUTHENTICATION_REQUIRED",e=>[400,"Multi-factor authentication is required for this user.",{attempt_code:e}],e=>[e.attempt_code]),eK=n(s,"INVALID_TOTP_CODE",()=>[400,"The TOTP code is invalid. Please try again."],()=>[]),eq=n(s,"USER_AUTHENTICATION_REQUIRED",()=>[401,"User authentication required for this endpoint."],()=>[]),eL=n(s,"TEAM_MEMBERSHIP_ALREADY_EXISTS",()=>[409,"Team membership already exists."],()=>[]),eV=n(s,"PROJECT_PERMISSION_REQUIRED",(e,t)=>[401,`User ${e} does not have permission ${t}.`,{user_id:e,permission_id:t}],e=>[e.user_id,e.permission_id]),eW=n(s,"TEAM_PERMISSION_REQUIRED",(e,t,r)=>[401,`User ${t} does not have permission ${r} in team ${e}.`,{team_id:e,user_id:t,permission_id:r}],e=>[e.team_id,e.user_id,e.permission_id]),eJ=n(s,"TEAM_PERMISSION_NOT_FOUND",(e,t,r)=>[401,`User ${t} does not have permission ${r} in team ${e}.`,{team_id:e,user_id:t,permission_id:r}],e=>[e.team_id,e.user_id,e.permission_id]),eH=n(s,"INVALID_SHARED_OAUTH_PROVIDER_ID",e=>[400,`The shared OAuth provider with ID ${e} is not valid.`,{provider_id:e}],e=>[e.provider_id]),eB=n(s,"INVALID_STANDARD_OAUTH_PROVIDER_ID",e=>[400,`The standard OAuth provider with ID ${e} is not valid.`,{provider_id:e}],e=>[e.provider_id]),ez=n(s,"INVALID_AUTHORIZATION_CODE",()=>[400,"The given authorization code is invalid."],()=>[]),eY=n(s,"OAUTH_PROVIDER_ACCESS_DENIED",()=>[400,"The OAuth provider denied access to the user."],()=>[]),eG=n(s,"CONTACT_CHANNEL_ALREADY_USED_FOR_AUTH_BY_SOMEONE_ELSE",(e,t,r=!1)=>[409,`This ${e} ${t?`"(${t})"`:""} is already used for authentication by another account${r?" but the email is not verified. Please login to your existing account with the method you used to sign up, and then verify your email to sign in with this login method.":"."}`,{type:e,contact_channel_value:t??null,would_work_if_email_was_verified:r}],e=>[e.type,e.contact_channel_value,e.would_work_if_email_was_verified??!1]),eX=n(s,"INVALID_POLLING_CODE",e=>[400,"The polling code is invalid or does not exist.",e],e=>[e]),eQ=n(s,"CLI_AUTH_ERROR",e=>[400,e],e=>[e.message]),eZ=n(s,"CLI_AUTH_EXPIRED_ERROR",(e="CLI authentication request expired. Please try again.")=>[400,e],e=>[e.message]),e0=n(s,"CLI_AUTH_USED_ERROR",(e="This authentication token has already been used.")=>[400,e],e=>[e.message]),e1=n(s,"API_KEY_NOT_VALID","inherit","inherit"),e2=n(e1,"API_KEY_EXPIRED",()=>[401,"API key has expired."],()=>[]),e4=n(e1,"API_KEY_REVOKED",()=>[401,"API key has been revoked."],()=>[]),e6=n(e1,"WRONG_API_KEY_TYPE",(e,t)=>[400,`This endpoint is for ${e} API keys, but a ${t} API key was provided.`,{expected_type:e,actual_type:t}],e=>[e.expected_type,e.actual_type]),e8=n(e1,"API_KEY_NOT_FOUND",()=>[404,"API key not found."],()=>[]),e5=n(e1,"PUBLIC_API_KEY_CANNOT_BE_REVOKED",()=>[400,"Public API keys cannot be revoked by the secretscanner endpoint."],()=>[]),e3=n(s,"PERMISSION_ID_ALREADY_EXISTS",e=>[400,`Permission with ID "${e}" already exists. Choose a different ID.`,{permission_id:e}],e=>[e.permission_id]),e7=n(s,"EMAIL_RENDERING_ERROR",e=>[400,`Failed to render email with theme: ${e}`,{error:e}],e=>[e.error]),e9=n(s,"REQUIRES_CUSTOM_EMAIL_SERVER",()=>[400,"This action requires a custom SMTP server. Please edit your email server configuration and try again."],()=>[]),te=n(s,"ITEM_NOT_FOUND",e=>[404,`Item with ID "${e}" not found.`,{item_id:e}],e=>[e.item_id]),tt=n(s,"ITEM_CUSTOMER_TYPE_DOES_NOT_MATCH",(e,t,r,i)=>[400,`The ${i} with ID ${JSON.stringify(t)} is not a valid customer for the item with ID ${JSON.stringify(e)}. ${r?`The item is configured to only be available for ${r} customers, but the customer is a ${i}.`:"The item is missing a customer type field. Please make sure it is set up correctly in your project configuration."}`,{item_id:e,customer_id:t,item_customer_type:r??null,actual_customer_type:i}],e=>[e.item_id,e.customer_id,e.item_customer_type??void 0,e.actual_customer_type]),tr=n(s,"CUSTOMER_DOES_NOT_EXIST",e=>[400,`Customer with ID ${JSON.stringify(e)} does not exist.`,{customer_id:e}],e=>[e.customer_id]),ti=n(s,"PRODUCT_DOES_NOT_EXIST",(e,t)=>[400,`Product with ID ${JSON.stringify(e)} ${"server_only"===t?"is marked as server-only and cannot be accessed client side.":"item_exists"===t?"does not exist, but an item with this ID exists.":"does not exist."}`,{product_id:e,context:t}],e=>[e.product_id,e.context]),ts=n(s,"PRODUCT_CUSTOMER_TYPE_DOES_NOT_MATCH",(e,t,r,i)=>[400,`The ${i} with ID ${JSON.stringify(t)} is not a valid customer for the inline product that has been passed in. ${r?`The product is configured to only be available for ${r} customers, but the customer is a ${i}.`:"The product is missing a customer type field. Please make sure it is set up correctly in your project configuration."}`,{product_id:e??null,customer_id:t,product_customer_type:r??null,actual_customer_type:i}],e=>[e.product_id??void 0,e.customer_id,e.product_customer_type??void 0,e.actual_customer_type]),tn=n(s,"PRODUCT_ALREADY_GRANTED",(e,t)=>[400,`Customer with ID ${JSON.stringify(t)} already owns product ${JSON.stringify(e)}.`,{product_id:e,customer_id:t}],e=>[e.product_id,e.customer_id]),ta={CannotDeleteCurrentSession:q,UnsupportedError:a,BodyParsingError:o,SchemaError:c,AllOverloadsFailed:l,ProjectAuthenticationError:u,PermissionIdAlreadyExists:e3,CliAuthError:eQ,CliAuthExpiredError:eZ,CliAuthUsedError:e0,InvalidProjectAuthentication:d,ProjectKeyWithoutAccessType:h,InvalidAccessType:p,AccessTypeWithoutProjectId:m,AccessTypeRequired:f,CannotGetOwnUserWithoutUser:J,InsufficientAccessType:y,InvalidPublishableClientKey:_,InvalidSecretServerKey:w,InvalidSuperSecretAdminKey:g,InvalidAdminAccessToken:v,UnparsableAdminAccessToken:T,AdminAccessTokenExpired:k,InvalidProjectForAdminAccessToken:C,AdminAccessTokenIsNotAdmin:S,ProjectAuthenticationRequired:b,ClientAuthenticationRequired:E,ServerAuthenticationRequired:A,ClientOrServerAuthenticationRequired:I,ClientOrAdminAuthenticationRequired:R,ClientOrServerOrAdminAuthenticationRequired:O,AdminAuthenticationRequired:P,ExpectedInternalProject:x,SessionAuthenticationError:j,InvalidSessionAuthentication:U,InvalidAccessToken:N,UnparsableAccessToken:D,AccessTokenExpired:F,InvalidProjectForAccessToken:$,RefreshTokenError:M,ProviderRejected:L,RefreshTokenNotFoundOrExpired:K,UserWithEmailAlreadyExists:V,EmailNotVerified:W,UserIdDoesNotExist:H,UserNotFound:B,ApiKeyNotFound:e8,PublicApiKeyCannotBeRevoked:e5,ProjectNotFound:z,CurrentProjectNotFound:Y,BranchDoesNotExist:G,SignUpNotEnabled:X,PasswordAuthenticationNotEnabled:Q,PasskeyAuthenticationNotEnabled:et,AnonymousAccountsNotEnabled:er,AnonymousAuthenticationNotAllowed:ei,EmailPasswordMismatch:es,RedirectUrlNotWhitelisted:en,PasswordRequirementsNotMet:ea,PasswordTooShort:eo,PasswordTooLong:ec,UserDoesNotHavePassword:el,VerificationCodeError:eu,VerificationCodeNotFound:ed,VerificationCodeExpired:eh,VerificationCodeAlreadyUsed:ep,VerificationCodeMaxAttemptsReached:em,PasswordConfirmationMismatch:ef,EmailAlreadyVerified:ey,EmailNotAssociatedWithUser:e_,EmailIsNotPrimaryEmail:ew,PasskeyRegistrationFailed:eg,PasskeyWebAuthnError:ev,PasskeyAuthenticationFailed:eT,PermissionNotFound:ek,PermissionScopeMismatch:eC,ContainedPermissionNotFound:eS,TeamNotFound:eb,TeamMembershipNotFound:eE,EmailTemplateAlreadyExists:eA,OAuthConnectionNotConnectedToUser:eI,OAuthConnectionAlreadyConnectedToAnotherUser:eR,OAuthConnectionDoesNotHaveRequiredScope:eO,OAuthExtraScopeNotAvailableWithSharedOAuthKeys:eP,OAuthAccessTokenNotAvailableWithSharedOAuthKeys:ex,InvalidOAuthClientIdOrSecret:ej,InvalidScope:eU,UserAlreadyConnectedToAnotherOAuthConnection:eN,OuterOAuthTimeout:eD,OAuthProviderNotFoundOrNotEnabled:eF,OAuthProviderAccountIdAlreadyUsedForSignIn:e$,MultiFactorAuthenticationRequired:eM,InvalidTotpCode:eK,UserAuthenticationRequired:eq,TeamMembershipAlreadyExists:eL,ProjectPermissionRequired:eV,TeamPermissionRequired:eW,InvalidSharedOAuthProviderId:eH,InvalidStandardOAuthProviderId:eB,InvalidAuthorizationCode:ez,TeamPermissionNotFound:eJ,OAuthProviderAccessDenied:eY,ContactChannelAlreadyUsedForAuthBySomeoneElse:eG,InvalidPollingCodeError:eX,ApiKeyNotValid:e1,ApiKeyExpired:e2,ApiKeyRevoked:e4,WrongApiKeyType:e6,EmailRenderingError:e7,RequiresCustomEmailServer:e9,ItemNotFound:te,ItemCustomerTypeDoesNotMatch:tt,CustomerDoesNotExist:tr,ProductDoesNotExist:ti,ProductCustomerTypeDoesNotMatch:ts,ProductAlreadyGranted:tn,ItemQuantityInsufficientAmount:n(s,"ITEM_QUANTITY_INSUFFICIENT_AMOUNT",(e,t,r)=>[400,`The item with ID ${JSON.stringify(e)} has an insufficient quantity for the customer with ID ${JSON.stringify(t)}. An attempt was made to charge ${r} credits.`,{item_id:e,customer_id:t,quantity:r}],e=>[e.item_id,e.customer_id,e.quantity]),StripeAccountInfoNotFound:n(s,"STRIPE_ACCOUNT_INFO_NOT_FOUND",()=>[404,"Stripe account information not found. Please make sure the user has onboarded with Stripe."],()=>[]),DataVaultStoreDoesNotExist:Z,DataVaultStoreHashedKeyDoesNotExist:ee},to=new Set;for(let[e,t]of Object.entries(ta)){if(to.has(t.errorCode))throw Error(`Duplicate known error code: ${t.errorCode}`);to.add(t.errorCode)}e.s(["KnownError",()=>s,"KnownErrors",()=>ta])},218111,e=>{"use strict";e.s(["DependenciesMap",()=>d]);var t,r,i,s,n,a,o=e.i(85298),c=class{constructor(e){"undefined"==typeof WeakRef?this._ref={deref:()=>e}:this._ref=new WeakRef(e)}deref(){return this._ref.deref()}},l=class{constructor(e){this[t]="IterableWeakMap";const r=e?.map(e=>[e[0],{value:e[1],keyRef:new c(e[0])}]);this._weakMap=new WeakMap(r??[]),this._keyRefs=new Set(r?.map(e=>e[1].keyRef)??[])}get(e){return this._weakMap.get(e)?.value}set(e,t){let r=this._weakMap.get(e),i={value:t,keyRef:r?.keyRef??new c(e)};return this._weakMap.set(e,i),this._keyRefs.add(i.keyRef),this}delete(e){let t=this._weakMap.get(e);return!!t&&(this._weakMap.delete(e),this._keyRefs.delete(t.keyRef),!0)}has(e){return this._weakMap.has(e)&&this._keyRefs.has(this._weakMap.get(e).keyRef)}*[(r=Symbol.iterator,t=Symbol.toStringTag,r)](){for(let e of this._keyRefs){let t=e.deref(),r=t?this._weakMap.get(t):void 0;t?r&&(yield[t,r.value]):this._keyRefs.delete(e)}}},u=class{constructor(e){this[i]="MaybeWeakMap";const t=[...e??[]];this._primitiveMap=new Map(t.filter(e=>!this._isAllowedInWeakMap(e[0]))),this._weakMap=new l(t.filter(e=>this._isAllowedInWeakMap(e[0])))}_isAllowedInWeakMap(e){return"object"==typeof e&&null!==e||"symbol"==typeof e&&void 0===Symbol.keyFor(e)}get(e){return this._isAllowedInWeakMap(e)?this._weakMap.get(e):this._primitiveMap.get(e)}set(e,t){return this._isAllowedInWeakMap(e)?this._weakMap.set(e,t):this._primitiveMap.set(e,t),this}delete(e){return this._isAllowedInWeakMap(e)?this._weakMap.delete(e):this._primitiveMap.delete(e)}has(e){return this._isAllowedInWeakMap(e)?this._weakMap.has(e):this._primitiveMap.has(e)}*[(s=Symbol.iterator,i=Symbol.toStringTag,s)](){yield*this._primitiveMap,yield*this._weakMap}},d=class{constructor(){this._inner={map:new u,hasValue:!1,value:void 0},this[n]="DependenciesMap"}_valueToResult(e){return e.hasValue?o.Result.ok(e.value):o.Result.error(void 0)}_unwrapFromInner(e,t){if(0===e.length)return this._valueToResult(t);{let[r,...i]=e,s=t.map.get(r);return s?this._unwrapFromInner(i,s):o.Result.error(void 0)}}_setInInner(e,t,r){if(0===e.length){let e=this._valueToResult(r);return"ok"===t.status?(r.hasValue=!0,r.value=t.data):(r.hasValue=!1,r.value=void 0),e}{let[i,...s]=e,n=r.map.get(i);return n||r.map.set(i,n={map:new u,hasValue:!1,value:void 0}),this._setInInner(s,t,n)}}*_iterateInner(e,t){for(let[r,i]of(t.hasValue&&(yield[e,t.value]),t.map))yield*this._iterateInner([...e,r],i)}get(e){return o.Result.or(this._unwrapFromInner(e,this._inner),void 0)}set(e,t){return this._setInInner(e,o.Result.ok(t),this._inner),this}delete(e){return"ok"===this._setInInner(e,o.Result.error(void 0),this._inner).status}has(e){return"ok"===this._unwrapFromInner(e,this._inner).status}clear(){this._inner={map:new u,hasValue:!1,value:void 0}}*[(a=Symbol.iterator,n=Symbol.toStringTag,a)](){yield*this._iterateInner([],this._inner)}}},835676,145010,e=>{"use strict";e.s(["decrypt",()=>m,"encrypt",()=>p,"generateRandomValues",()=>u,"generateSecureRandomString",()=>d,"hash",()=>f,"iteratedHash",()=>y],835676);var t=e.i(91e3),r="0123456789ABCDEFGHJKMNPQRSTVWXYZ";function i(e){if(e<0||e>=r.length)throw new t.StackAssertionError(`Invalid base32 index: ${e}`);return r[e]}function s(e){let s=0,n=0,a="";for(let t=0;t<e.length;t++)for(n=n<<8|e[t],s+=8;s>=5;)a+=i(n>>>s-5&31),s-=5;if(s>0&&(a+=i(n<<5-s&31)),!function(e){for(let t of e){if(" "===t)continue;let e=t.toUpperCase();if(!r.includes(e))return!1}return!0}(a))throw new t.StackAssertionError("Invalid base32 output; this should never happen");return a}function n(e){return btoa([...e].map(e=>String.fromCharCode(e)).join(""))}function a(e){return new Uint8Array(atob(e).split("").map(e=>e.charCodeAt(0)))}function o(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}e.s(["decodeBase64",()=>a,"encodeBase32",()=>s,"encodeBase64",()=>n,"isBase64",()=>o],145010);var c=e.i(906360),l=e.i(85298);function u(e){if(!c.globalVar.crypto)throw new t.StackAssertionError("Crypto API is not available in this environment. Are you using an old browser?");if(!c.globalVar.crypto.getRandomValues)throw new t.StackAssertionError("crypto.getRandomValues is not available in this environment. Are you using an old browser?");return c.globalVar.crypto.getRandomValues(e)}function d(e=224){let t=Math.ceil(e/5),r=s(u(new Uint8Array(Math.ceil(5*t/8))));return r.slice(r.length-t).toLowerCase()}async function h(e,t,r){let i=await crypto.subtle.importKey("raw","string"==typeof t?new TextEncoder().encode(t):t,"HKDF",!1,["deriveKey"]);return await crypto.subtle.deriveKey({name:"HKDF",salt:r,hash:"SHA-256",info:new TextEncoder().encode(JSON.stringify(["stack-crypto-helper-derived-symmetric-key",e,"string"==typeof t?"string-key":"binary-key",n(r)]))},i,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function p({purpose:e,secret:t,value:r}){let i=crypto.getRandomValues(new Uint8Array(12)),s=crypto.getRandomValues(new Uint8Array(16)),n=await h(e,t,s),a=await crypto.subtle.encrypt({name:"AES-GCM",iv:i},n,r);return new Uint8Array([1,0,...s,...i,...new Uint8Array(a)])}async function m({purpose:e,secret:r,cipher:i}){let s=i.slice(0,2);if(1!==s[0]||0!==s[1])throw new t.StackAssertionError("Invalid ciphertext version in decrypt(...); expected 0x0100",{purpose:e});let n=i.slice(2,18),a=i.slice(18,30),o=i.slice(30),c=await h(e,r,n);try{let e=await crypto.subtle.decrypt({name:"AES-GCM",iv:a},c,o);return l.Result.ok(new Uint8Array(e))}catch(e){if(e instanceof DOMException&&"OperationError"===e.name)return l.Result.error(Error("Invalid ciphertext or secret when decrypting encrypted value",{cause:e}));throw e}}async function f(e){return await y({...e,iterations:1})}async function y(e){let t=e=>"string"==typeof e?new TextEncoder().encode(e):e,r=await crypto.subtle.importKey("raw",t(e.value),"PBKDF2",!1,["deriveBits"]);return new Uint8Array(await crypto.subtle.deriveBits({name:"PBKDF2",salt:new TextEncoder().encode(JSON.stringify(["stack-crypto-helper-iterated-hash",e.purpose,n(t(e.salt??"")),n(t(e.extra??""))])),iterations:e.iterations,hash:"SHA-256"},r,256))}},675174,e=>{"use strict";e.s(["generateUuid",()=>r,"isUuid",()=>i]);var t=e.i(835676);function r(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^(0,t.generateRandomValues)(new Uint8Array(1))[0]&15>>e/4).toString(16))}function i(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/.test(e)}},510835,e=>{"use strict";e.s(["neverResolve",()=>h,"pending",()=>p,"rateLimited",()=>_,"rejected",()=>u,"resolved",()=>c,"runAsynchronously",()=>y,"runAsynchronouslyWithAlert",()=>f,"wait",()=>m]);var t=e.i(963087);e.i(850821);var r=e.i(205263),i=e.i(91e3),s=e.i(218111),n=e.i(85298),a=e.i(675174),o=null;function c(e){if((o??=new s.DependenciesMap).has([e]))return o.get([e]);let t=Object.assign(Promise.resolve(e),{status:"fulfilled",value:e});return o.set([e],t),t}var l=null;function u(e){if((l??=new s.DependenciesMap).has([e]))return l.get([e]);let t=Promise.reject(e);t.catch(()=>{});let r=Object.assign(t,{status:"rejected",reason:e});return l.set([e],r),r}var d=p(new Promise(()=>{}));function h(){return d}function p(e,t={}){let r=e.then(e=>(r.status="fulfilled",r.value=e,e),e=>{throw r.status="rejected",r.reason=e,e});return r.status="pending",r}async function m(e){if(!Number.isFinite(e)||e<0)throw new i.StackAssertionError(`wait() requires a non-negative integer number of milliseconds to wait. (found: ${e}ms)`);if(e>=0x80000000)throw new i.StackAssertionError("The maximum timeout for wait() is 2147483647ms (2**31 - 1). (found: ${ms}ms)");return await new Promise(t=>setTimeout(t,e))}function f(...e){return y(e[0],{...e[1],onError:i=>{r.KnownError.isKnownError(i)&&void 0!==t.default&&"production".includes("production")?alert(i.message):alert(`An unhandled error occurred. Please report this to the developer.

${i}`),e[1]?.onError?.(i)}},...e.slice(2))}function y(e,t={}){if("function"==typeof e&&(e=e()),e){var r;let s;r=e,s=Error(),r.catch(e=>{e instanceof Error&&(0,i.concatStacktraces)(e,s)}),e.catch(e=>{t.onError?.(e);let r=new i.StackAssertionError("Uncaught error in asynchronous function: "+(0,i.errorToNiceString)(e),{cause:e});t.noErrorLogging||(0,i.captureError)("runAsynchronously",r)})}}function _(e,t){let r=performance.now(),i=[],s=new Map,o=async()=>{for(;;)if(r>performance.now())await m(Math.max(1,r-performance.now()+1));else if(0===i.length){let e=(0,a.generateUuid)();await new Promise(t=>{s.set(e,t)}),s.delete(e)}else break;let o=t.batchCalls?i.splice(0,i.length):[i.shift()],c=performance.now(),l=await n.Result.fromPromise(e()),u=performance.now();for(let e of(r=Math.max(r,c+(t.throttleMs??0),u+(t.gapMs??0)),o))"ok"===l.status?e[0](l.data):e[1](l.error)};return y(async()=>{for(;;)await o()}),()=>new Promise((e,n)=>{r=Math.max(r,performance.now()+(t.debounceMs??0)),i.push([e,n]),s.forEach(e=>e())})}},85298,e=>{"use strict";e.s(["AsyncResult",()=>s,"Result",()=>i]);var t=e.i(510835),r=e.i(717817),i={fromThrowing:a,fromThrowingAsync:o,fromPromise:n,ok:e=>({status:"ok",data:e}),error:e=>({status:"error",error:e}),map:c,or:(e,t)=>"ok"===e.status?e.data:t,orThrow:e=>{if("error"===e.status)throw e.error;return e.data},orThrowAsync:async e=>i.orThrow(await e),retry:u},s={fromThrowing:a,fromPromise:n,ok:i.ok,error:i.error,pending:function(e){return{status:"pending",progress:e}},map:c,or:(e,t)=>"pending"===e.status?t:i.or(e,t),orThrow:e=>{if("pending"===e.status)throw Error("Result still pending");return i.orThrow(e)},retry:u};async function n(e){try{let t=await e;return i.ok(t)}catch(e){return i.error(e)}}function a(e){try{return i.ok(e())}catch(e){return i.error(e)}}async function o(e){try{return i.ok(await e())}catch(e){return i.error(e)}}function c(e,t){return"error"===e.status?{status:"error",error:e.error}:"pending"===e.status?{status:"pending",..."progress"in e?{progress:e.progress}:{}}:i.ok(t(e.data))}var l=class extends AggregateError{constructor(e){const t=e.map(e=>(0,r.nicify)(e));super(e,r.deindent`
      Error after ${e.length} attempts.
      
      ${t.length>1&&t.every(e=>e===t[0])?r.deindent`
        Attempts 1-${e.length}:
          ${t[0]}
      `:t.map((e,t)=>r.deindent`
          Attempt ${t+1}:
            ${e}
        `).join("\n\n")}
      `,{cause:e[e.length-1]}),this.errors=e,this.name="RetryError"}get attempts(){return this.errors.length}};async function u(e,r,{exponentialDelayBase:s=1e3}={}){let n=[];for(let a=0;a<r;a++){let o=await e(a);if("ok"===o.status)return Object.assign(i.ok(o.data),{attempts:a+1});n.push(o.error),a<r-1&&await (0,t.wait)((Math.random()+.5)*s*2**a)}return Object.assign(i.error(new l(n)),{attempts:r})}l.prototype.name="RetryError"},979546,(e,t,r)=>{"use strict";function i(e){this._maxSize=e,this.clear()}i.prototype.clear=function(){this._size=0,this._values=Object.create(null)},i.prototype.get=function(e){return this._values[e]},i.prototype.set=function(e,t){return this._size>=this._maxSize&&this.clear(),!(e in this._values)&&this._size++,this._values[e]=t};var s=/[^.^\]^[]+|(?=\[\]|\.\.)/g,n=/^\d+$/,a=/^\d/,o=/[~`!#$%\^&*+=\-\[\]\\';,/{}|\\":<>\?]/g,c=/^\s*(['"]?)(.*?)(\1)\s*$/,l=new i(512),u=new i(512),d=new i(512);function h(e){return l.get(e)||l.set(e,p(e).map(function(e){return e.replace(c,"$2")}))}function p(e){return e.match(s)||[""]}function m(e){return"string"==typeof e&&e&&-1!==["'",'"'].indexOf(e.charAt(0))}t.exports={Cache:i,split:p,normalizePath:h,setter:function(e){var t=h(e);return u.get(e)||u.set(e,function(e,r){for(var i=0,s=t.length,n=e;i<s-1;){var a=t[i];if("__proto__"===a||"constructor"===a||"prototype"===a)return e;n=n[t[i++]]}n[t[i]]=r})},getter:function(e,t){var r=h(e);return d.get(e)||d.set(e,function(e){for(var i=0,s=r.length;i<s;)if(null==e&&t)return;else e=e[r[i++]];return e})},join:function(e){return e.reduce(function(e,t){return e+(m(t)||n.test(t)?"["+t+"]":(e?".":"")+t)},"")},forEach:function(e,t,r){!function(e,t,r){var i,s,c,l,u=e.length;for(s=0;s<u;s++)(i=e[s])&&(function(e){return!m(e)&&(e.match(a)&&!e.match(n)||o.test(e))}(i)&&(i='"'+i+'"'),c=!(l=m(i))&&/^\d+$/.test(i),t.call(r,i,l,c,s,e))}(Array.isArray(e)?e:p(e),t,r)}}},950434,(e,t,r)=>{let i=/[A-Z\xc0-\xd6\xd8-\xde]?[a-z\xdf-\xf6\xf8-\xff]+(?:['](?:d|ll|m|re|s|t|ve))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde]|$)|(?:[A-Z\xc0-\xd6\xd8-\xde]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['](?:D|LL|M|RE|S|T|VE))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde](?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])|$)|[A-Z\xc0-\xd6\xd8-\xde]?(?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['](?:d|ll|m|re|s|t|ve))?|[A-Z\xc0-\xd6\xd8-\xde]+(?:['](?:D|LL|M|RE|S|T|VE))?|\d*(?:1ST|2ND|3RD|(?![123])\dTH)(?=\b|[a-z_])|\d*(?:1st|2nd|3rd|(?![123])\dth)(?=\b|[A-Z_])|\d+|(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?(?:\u200d(?:[^\ud800-\udfff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?)*/g,s=e=>e.match(i)||[],n=e=>e[0].toUpperCase()+e.slice(1),a=(e,t)=>s(e).join(t).toLowerCase(),o=e=>s(e).reduce((e,t)=>`${e}${!e?t.toLowerCase():t[0].toUpperCase()+t.slice(1).toLowerCase()}`,"");t.exports={words:s,upperFirst:n,camelCase:o,pascalCase:e=>n(o(e)),snakeCase:e=>a(e,"_"),kebabCase:e=>a(e,"-"),sentenceCase:e=>n(a(e," ")),titleCase:e=>s(e).map(n).join(" ")}},427001,(e,t,r)=>{function i(e,t){var r=e.length,i=Array(r),s={},n=r,a=function(e){for(var t=new Map,r=0,i=e.length;r<i;r++){var s=e[r];t.has(s[0])||t.set(s[0],new Set),t.has(s[1])||t.set(s[1],new Set),t.get(s[0]).add(s[1])}return t}(t),o=function(e){for(var t=new Map,r=0,i=e.length;r<i;r++)t.set(e[r],r);return t}(e);for(t.forEach(function(e){if(!o.has(e[0])||!o.has(e[1]))throw Error("Unknown node. There is an unknown node in the supplied edges.")});n--;)s[n]||function e(t,n,c){if(c.has(t)){var l;try{l=", node was:"+JSON.stringify(t)}catch(e){l=""}throw Error("Cyclic dependency"+l)}if(!o.has(t))throw Error("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(t));if(!s[n]){s[n]=!0;var u=a.get(t)||new Set;if(n=(u=Array.from(u)).length){c.add(t);do{var d=u[--n];e(d,o.get(d),c)}while(n)c.delete(t)}i[--r]=t}}(e[n],n,new Set);return i}t.exports=function(e){return i(function(e){for(var t=new Set,r=0,i=e.length;r<i;r++){var s=e[r];t.add(s[0]),t.add(s[1])}return Array.from(t)}(e),e)},t.exports.array=i},104372,666128,213596,609574,63956,951668,160118,e=>{"use strict";let t,r,i;e.s(["decryptValue",()=>u,"encryptValue",()=>l,"hashKey",()=>c],104372);var s=e.i(145010),n=e.i(835676),a="stack-data-vault-client-side-encryption-value-encryption-value-encryption";async function o(e,t){return await (0,n.iteratedHash)({purpose:"stack-data-vault-client-side-encryption-value-encryption-key-hash",extra:e,value:t,iterations:1e5})}async function c(e,t){return(0,s.encodeBase64)(await (0,n.hash)({purpose:"stack-data-vault-client-side-encryption-key-hash",extra:e,value:await o(e,t)}))}async function l(e,t,r){let i=await o(e,t),c=await (0,n.encrypt)({purpose:a,secret:i,value:new TextEncoder().encode(r)});return(0,s.encodeBase64)(c)}async function u(e,t,r){let i=await o(e,t),c=await (0,n.decrypt)({purpose:a,secret:i,cipher:(0,s.decodeBase64)(r)});if("error"===c.status)throw Error("Data vault client-side decryption failed. Are you sure you're using the correct secret?",{cause:c.error});return new TextDecoder().decode(c.data)}crypto,new TextEncoder;let d=new TextDecoder;class h extends Error{constructor(e,t){super(e,t),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}h.code="ERR_JOSE_GENERIC";class p extends h{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}}function m(e){let t,r;if("string"!=typeof e)throw new p("JWTs must use Compact JWS serialization, JWT must be a string");let{1:i,length:s}=e.split(".");if(5===s)throw new p("Only JWTs using Compact JWS serialization can be decoded");if(3!==s)throw new p("Invalid JWT");if(!i)throw new p("JWTs must contain a payload");try{t=(e=>{let t=e;t instanceof Uint8Array&&(t=d.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{var r=t;let e=atob(r),i=new Uint8Array(e.length);for(let t=0;t<e.length;t++)i[t]=e.charCodeAt(t);return i}catch{throw TypeError("The input to be decoded is not correctly encoded.")}})(i)}catch{throw new p("Failed to base64url decode the payload")}try{r=JSON.parse(d.decode(t))}catch{throw new p("Failed to parse the decoded payload as JSON")}if(!function(e){if("object"!=typeof e||null===e||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(r))throw new p("Invalid JWT Claims Set");return r}p.code="ERR_JWT_INVALID",e.s(["decodeJwt",()=>m],666128);var f=e.i(979546),y=e.i(950434),_=e.i(427001);let w=Object.prototype.toString,g=Error.prototype.toString,v=RegExp.prototype.toString,T="undefined"!=typeof Symbol?Symbol.prototype.toString:()=>"",k=/^Symbol\((.*)\)(.*)$/;function C(e,t=!1){if(null==e||!0===e||!1===e)return""+e;let r=typeof e;if("number"===r)return e!=+e?"NaN":0===e&&1/e<0?"-0":""+e;if("string"===r)return t?`"${e}"`:e;if("function"===r)return"[Function "+(e.name||"anonymous")+"]";if("symbol"===r)return T.call(e).replace(k,"Symbol($1)");let i=w.call(e).slice(8,-1);return"Date"===i?isNaN(e.getTime())?""+e:e.toISOString(e):"Error"===i||e instanceof Error?"["+g.call(e)+"]":"RegExp"===i?v.call(e):null}function S(e,t){let r=C(e,t);return null!==r?r:JSON.stringify(e,function(e,r){let i=C(this[e],t);return null!==i?i:r},2)}function b(e){return null==e?[]:[].concat(e)}let E=/\$\{\s*(\w+)\s*\}/g;t=Symbol.toStringTag;class A{constructor(e,r,i,s){this.name=void 0,this.message=void 0,this.value=void 0,this.path=void 0,this.type=void 0,this.params=void 0,this.errors=void 0,this.inner=void 0,this[t]="Error",this.name="ValidationError",this.value=r,this.path=i,this.type=s,this.errors=[],this.inner=[],b(e).forEach(e=>{if(I.isError(e)){this.errors.push(...e.errors);let t=e.inner.length?e.inner:[e];this.inner.push(...t)}else this.errors.push(e)}),this.message=this.errors.length>1?`${this.errors.length} errors occurred`:this.errors[0]}}r=Symbol.hasInstance,i=Symbol.toStringTag;class I extends Error{static formatError(e,t){let r=t.label||t.path||"this";return(t=Object.assign({},t,{path:r,originalPath:t.path}),"string"==typeof e)?e.replace(E,(e,r)=>S(t[r])):"function"==typeof e?e(t):e}static isError(e){return e&&"ValidationError"===e.name}constructor(e,t,r,s,n){const a=new A(e,t,r,s);if(n)return a;super(),this.value=void 0,this.path=void 0,this.type=void 0,this.params=void 0,this.errors=[],this.inner=[],this[i]="Error",this.name=a.name,this.message=a.message,this.type=a.type,this.value=a.value,this.path=a.path,this.errors=a.errors,this.inner=a.inner,Error.captureStackTrace&&Error.captureStackTrace(this,I)}static[r](e){return A[Symbol.hasInstance](e)||super[Symbol.hasInstance](e)}}let R={default:"${path} is invalid",required:"${path} is a required field",defined:"${path} must be defined",notNull:"${path} cannot be null",oneOf:"${path} must be one of the following values: ${values}",notOneOf:"${path} must not be one of the following values: ${values}",notType:({path:e,type:t,value:r,originalValue:i})=>{let s=null!=i&&i!==r?` (cast from the value \`${S(i,!0)}\`).`:".";return"mixed"!==t?`${e} must be a \`${t}\` type, but the final value was: \`${S(r,!0)}\``+s:`${e} must match the configured type. The validated value was: \`${S(r,!0)}\``+s}},O={length:"${path} must be exactly ${length} characters",min:"${path} must be at least ${min} characters",max:"${path} must be at most ${max} characters",matches:'${path} must match the following: "${regex}"',email:"${path} must be a valid email",url:"${path} must be a valid URL",uuid:"${path} must be a valid UUID",datetime:"${path} must be a valid ISO date-time",datetime_precision:"${path} must be a valid ISO date-time with a sub-second precision of exactly ${precision} digits",datetime_offset:'${path} must be a valid ISO date-time with UTC "Z" timezone',trim:"${path} must be a trimmed string",lowercase:"${path} must be a lowercase string",uppercase:"${path} must be a upper case string"},P={min:"${path} must be greater than or equal to ${min}",max:"${path} must be less than or equal to ${max}",lessThan:"${path} must be less than ${less}",moreThan:"${path} must be greater than ${more}",positive:"${path} must be a positive number",negative:"${path} must be a negative number",integer:"${path} must be an integer"},x={min:"${path} field must be later than ${min}",max:"${path} field must be at earlier than ${max}"},j={isValue:"${path} field must be ${value}"},U={noUnknown:"${path} field has unspecified keys: ${unknown}",exact:"${path} object contains unknown properties: ${properties}"},N={min:"${path} field must have at least ${min} items",max:"${path} field must have less than or equal to ${max} items",length:"${path} must have ${length} items"},D={notType:e=>{let{path:t,value:r,spec:i}=e,s=i.types.length;if(Array.isArray(r)){if(r.length<s)return`${t} tuple value has too few items, expected a length of ${s} but got ${r.length} for value: \`${S(r,!0)}\``;if(r.length>s)return`${t} tuple value has too many items, expected a length of ${s} but got ${r.length} for value: \`${S(r,!0)}\``}return I.formatError(R.notType,e)}};Object.assign(Object.create(null),{mixed:R,string:O,number:P,date:x,object:U,array:N,boolean:j,tuple:D});let F=e=>e&&e.__isYupSchema__;class ${static fromOptions(e,t){if(!t.then&&!t.otherwise)throw TypeError("either `then:` or `otherwise:` is required for `when()` conditions");let{is:r,then:i,otherwise:s}=t,n="function"==typeof r?r:(...e)=>e.every(e=>e===r);return new $(e,(e,t)=>{var r;let a=n(...e)?i:s;return null!=(r=null==a?void 0:a(t))?r:t})}constructor(e,t){this.fn=void 0,this.refs=e,this.refs=e,this.fn=t}resolve(e,t){let r=this.refs.map(e=>e.getValue(null==t?void 0:t.value,null==t?void 0:t.parent,null==t?void 0:t.context)),i=this.fn(r,e,t);if(void 0===i||i===e)return e;if(!F(i))throw TypeError("conditions must return a schema object");return i.resolve(t)}}function M(e,t){return new K(e,t)}class K{constructor(e,t={}){if(this.key=void 0,this.isContext=void 0,this.isValue=void 0,this.isSibling=void 0,this.path=void 0,this.getter=void 0,this.map=void 0,"string"!=typeof e)throw TypeError("ref must be a string, got: "+e);if(this.key=e.trim(),""===e)throw TypeError("ref must be a non-empty string");this.isContext="$"===this.key[0],this.isValue="."===this.key[0],this.isSibling=!this.isContext&&!this.isValue;let r=this.isContext?"$":this.isValue?".":"";this.path=this.key.slice(r.length),this.getter=this.path&&(0,f.getter)(this.path,!0),this.map=t.map}getValue(e,t,r){let i=this.isContext?r:this.isValue?e:t;return this.getter&&(i=this.getter(i||{})),this.map&&(i=this.map(i)),i}cast(e,t){return this.getValue(e,null==t?void 0:t.parent,null==t?void 0:t.context)}resolve(){return this}describe(){return{type:"ref",key:this.key}}toString(){return`Ref(${this.key})`}static isRef(e){return e&&e.__isYupRef}}function q(e){function t({value:t,path:r="",options:i,originalValue:s,schema:n},a,o){let c,{name:l,test:u,params:d,message:h,skipAbsent:p}=e,{parent:m,context:f,abortEarly:y=n.spec.abortEarly,disableStackTrace:_=n.spec.disableStackTrace}=i,w={value:t,parent:m,context:f};function g(e={}){let i=L(Object.assign({value:t,originalValue:s,label:n.spec.label,path:e.path||r,spec:n.spec,disableStackTrace:e.disableStackTrace||_},d,e.params),w),a=new I(I.formatError(e.message||h,i),t,i.path,e.type||l,i.disableStackTrace);return a.params=i,a}let v=y?a:o,T={path:r,parent:m,type:l,from:i.from,createError:g,resolve:e=>V(e,w),options:i,originalValue:s,schema:n},k=e=>{I.isError(e)?v(e):e?o(null):v(g())},C=e=>{I.isError(e)?v(e):a(e)};if(p&&null==t)return k(!0);try{var S;if(c=u.call(T,t,T),"function"==typeof(null==(S=c)?void 0:S.then)){if(i.sync)throw Error(`Validation test of type: "${T.type}" returned a Promise during a synchronous validate. This test will finish after the validate call has returned`);return Promise.resolve(c).then(k,C)}}catch(e){C(e);return}k(c)}return t.OPTIONS=e,t}function L(e,t){if(!e)return e;for(let r of Object.keys(e))e[r]=V(e[r],t);return e}function V(e,t){return K.isRef(e)?e.getValue(t.value,t.parent,t.context):e}function W(e,t,r,i=r){let s,n,a;return t?((0,f.forEach)(t,(o,c,l)=>{let u=c?o.slice(1,o.length-1):o,d="tuple"===(e=e.resolve({context:i,parent:s,value:r})).type,h=l?parseInt(u,10):0;if(e.innerType||d){if(d&&!l)throw Error(`Yup.reach cannot implicitly index into a tuple type. the path part "${a}" must contain an index to the tuple element, e.g. "${a}[0]"`);if(r&&h>=r.length)throw Error(`Yup.reach cannot resolve an array item at index: ${o}, in the path: ${t}. because there is no value at that index. `);s=r,r=r&&r[h],e=d?e.spec.types[h]:e.innerType}if(!l){if(!e.fields||!e.fields[u])throw Error(`The schema does not contain the path: ${t}. (failed at: ${a} which is a type: "${e.type}")`);s=r,r=r&&r[u],e=e.fields[u]}n=u,a=c?"["+o+"]":"."+o}),{schema:e,parent:s,parentPath:n}):{parent:s,parentPath:t,schema:e}}function J(e,t,r,i){return W(e,t,r,i).schema}K.prototype.__isYupRef=!0;class H extends Set{describe(){let e=[];for(let t of this.values())e.push(K.isRef(t)?t.describe():t);return e}resolveAll(e){let t=[];for(let r of this.values())t.push(e(r));return t}clone(){return new H(this.values())}merge(e,t){let r=this.clone();return e.forEach(e=>r.add(e)),t.forEach(e=>r.delete(e)),r}}function B(e,t=new Map){let r;if(F(e)||!e||"object"!=typeof e)return e;if(t.has(e))return t.get(e);if(e instanceof Date)r=new Date(e.getTime()),t.set(e,r);else if(e instanceof RegExp)r=new RegExp(e),t.set(e,r);else if(Array.isArray(e)){r=Array(e.length),t.set(e,r);for(let i=0;i<e.length;i++)r[i]=B(e[i],t)}else if(e instanceof Map)for(let[i,s]of(r=new Map,t.set(e,r),e.entries()))r.set(i,B(s,t));else if(e instanceof Set)for(let i of(r=new Set,t.set(e,r),e))r.add(B(i,t));else if(e instanceof Object)for(let[i,s]of(r={},t.set(e,r),Object.entries(e)))r[i]=B(s,t);else throw Error(`Unable to clone ${e}`);return r}function z(e,t){var r;if(!(null!=(r=e.inner)&&r.length)&&e.errors.length){let r;return r=t?`${t}.${e.path}`:e.path,e.errors.map(e=>({message:e,path:function(e){if(!(null!=e&&e.length))return;let t=[],r="",i=!1,s=!1;for(let n=0;n<e.length;n++){let a=e[n];if("["===a&&!s){r&&(t.push(...r.split(".").filter(Boolean)),r=""),i=!0;continue}if("]"===a&&!s){r&&(/^\d+$/.test(r)?t.push(r):t.push(r.replace(/^"|"$/g,"")),r=""),i=!1;continue}if('"'===a){s=!s;continue}if("."===a&&!i&&!s){r&&(t.push(r),r="");continue}r+=a}return r&&t.push(...r.split(".").filter(Boolean)),t}(r)}))}let i=t?`${t}.${e.path}`:e.path;return e.inner.flatMap(e=>z(e,i))}class Y{constructor(e){this.type=void 0,this.deps=[],this.tests=void 0,this.transforms=void 0,this.conditions=[],this._mutate=void 0,this.internalTests={},this._whitelist=new H,this._blacklist=new H,this.exclusiveTests=Object.create(null),this._typeCheck=void 0,this.spec=void 0,this.tests=[],this.transforms=[],this.withMutation(()=>{this.typeError(R.notType)}),this.type=e.type,this._typeCheck=e.check,this.spec=Object.assign({strip:!1,strict:!1,abortEarly:!0,recursive:!0,disableStackTrace:!1,nullable:!1,optional:!0,coerce:!0},null==e?void 0:e.spec),this.withMutation(e=>{e.nonNullable()})}get _type(){return this.type}clone(e){if(this._mutate)return e&&Object.assign(this.spec,e),this;let t=Object.create(Object.getPrototypeOf(this));return t.type=this.type,t._typeCheck=this._typeCheck,t._whitelist=this._whitelist.clone(),t._blacklist=this._blacklist.clone(),t.internalTests=Object.assign({},this.internalTests),t.exclusiveTests=Object.assign({},this.exclusiveTests),t.deps=[...this.deps],t.conditions=[...this.conditions],t.tests=[...this.tests],t.transforms=[...this.transforms],t.spec=B(Object.assign({},this.spec,e)),t}label(e){let t=this.clone();return t.spec.label=e,t}meta(...e){if(0===e.length)return this.spec.meta;let t=this.clone();return t.spec.meta=Object.assign(t.spec.meta||{},e[0]),t}withMutation(e){let t=this._mutate;this._mutate=!0;let r=e(this);return this._mutate=t,r}concat(e){if(!e||e===this)return this;if(e.type!==this.type&&"mixed"!==this.type)throw TypeError(`You cannot \`concat()\` schema's of different types: ${this.type} and ${e.type}`);let t=e.clone(),r=Object.assign({},this.spec,t.spec);return t.spec=r,t.internalTests=Object.assign({},this.internalTests,t.internalTests),t._whitelist=this._whitelist.merge(e._whitelist,e._blacklist),t._blacklist=this._blacklist.merge(e._blacklist,e._whitelist),t.tests=this.tests,t.exclusiveTests=this.exclusiveTests,t.withMutation(t=>{e.tests.forEach(e=>{t.test(e.OPTIONS)})}),t.transforms=[...this.transforms,...t.transforms],t}isType(e){return null==e?!!this.spec.nullable&&null===e||!!this.spec.optional&&void 0===e:this._typeCheck(e)}resolve(e){let t=this;if(t.conditions.length){let r=t.conditions;(t=t.clone()).conditions=[],t=(t=r.reduce((t,r)=>r.resolve(t,e),t)).resolve(e)}return t}resolveOptions(e){var t,r,i,s;return Object.assign({},e,{from:e.from||[],strict:null!=(t=e.strict)?t:this.spec.strict,abortEarly:null!=(r=e.abortEarly)?r:this.spec.abortEarly,recursive:null!=(i=e.recursive)?i:this.spec.recursive,disableStackTrace:null!=(s=e.disableStackTrace)?s:this.spec.disableStackTrace})}cast(e,t={}){let r=this.resolve(Object.assign({},t,{value:e})),i="ignore-optionality"===t.assert,s=r._cast(e,t);if(!1!==t.assert&&!r.isType(s)){if(i&&null==s)return s;let n=S(e),a=S(s);throw TypeError(`The value of ${t.path||"field"} could not be cast to a value that satisfies the schema type: "${r.type}". 

attempted value: ${n} 
`+(a!==n?`result of cast: ${a}`:""))}return s}_cast(e,t){let r=void 0===e?e:this.transforms.reduce((r,i)=>i.call(this,r,e,this,t),e);return void 0===r&&(r=this.getDefault(t)),r}_validate(e,t={},r,i){let{path:s,originalValue:n=e,strict:a=this.spec.strict}=t,o=e;a||(o=this._cast(o,Object.assign({assert:!1},t)));let c=[];for(let e of Object.values(this.internalTests))e&&c.push(e);this.runTests({path:s,value:o,originalValue:n,options:t,tests:c},r,e=>{if(e.length)return i(e,o);this.runTests({path:s,value:o,originalValue:n,options:t,tests:this.tests},r,i)})}runTests(e,t,r){let i=!1,{tests:s,value:n,originalValue:a,path:o,options:c}=e,l=e=>{i||(i=!0,t(e,n))},u=e=>{i||(i=!0,r(e,n))},d=s.length,h=[];if(!d)return u([]);let p={value:n,originalValue:a,path:o,options:c,schema:this};for(let e=0;e<s.length;e++)(0,s[e])(p,l,function(e){e&&(Array.isArray(e)?h.push(...e):h.push(e)),--d<=0&&u(h)})}asNestedTest({key:e,index:t,parent:r,parentPath:i,originalParent:s,options:n}){let a=null!=e?e:t;if(null==a)throw TypeError("Must include `key` or `index` for nested validations");let o="number"==typeof a,c=r[a],l=Object.assign({},n,{strict:!0,parent:r,value:c,originalValue:s[a],key:void 0,[o?"index":"key"]:a,path:o||a.includes(".")?`${i||""}[${o?a:`"${a}"`}]`:(i?`${i}.`:"")+e});return(e,t,r)=>this.resolve(l)._validate(c,l,t,r)}validate(e,t){var r;let i=this.resolve(Object.assign({},t,{value:e})),s=null!=(r=null==t?void 0:t.disableStackTrace)?r:i.spec.disableStackTrace;return new Promise((r,n)=>i._validate(e,t,(e,t)=>{I.isError(e)&&(e.value=t),n(e)},(e,t)=>{e.length?n(new I(e,t,void 0,void 0,s)):r(t)}))}validateSync(e,t){var r;let i,s=this.resolve(Object.assign({},t,{value:e})),n=null!=(r=null==t?void 0:t.disableStackTrace)?r:s.spec.disableStackTrace;return s._validate(e,Object.assign({},t,{sync:!0}),(e,t)=>{throw I.isError(e)&&(e.value=t),e},(t,r)=>{if(t.length)throw new I(t,e,void 0,void 0,n);i=r}),i}isValid(e,t){return this.validate(e,t).then(()=>!0,e=>{if(I.isError(e))return!1;throw e})}isValidSync(e,t){try{return this.validateSync(e,t),!0}catch(e){if(I.isError(e))return!1;throw e}}_getDefault(e){let t=this.spec.default;return null==t?t:"function"==typeof t?t.call(this,e):B(t)}getDefault(e){return this.resolve(e||{})._getDefault(e)}default(e){return 0==arguments.length?this._getDefault():this.clone({default:e})}strict(e=!0){return this.clone({strict:e})}nullability(e,t){let r=this.clone({nullable:e});return r.internalTests.nullable=q({message:t,name:"nullable",test(e){return null!==e||this.schema.spec.nullable}}),r}optionality(e,t){let r=this.clone({optional:e});return r.internalTests.optionality=q({message:t,name:"optionality",test(e){return void 0!==e||this.schema.spec.optional}}),r}optional(){return this.optionality(!0)}defined(e=R.defined){return this.optionality(!1,e)}nullable(){return this.nullability(!0)}nonNullable(e=R.notNull){return this.nullability(!1,e)}required(e=R.required){return this.clone().withMutation(t=>t.nonNullable(e).defined(e))}notRequired(){return this.clone().withMutation(e=>e.nullable().optional())}transform(e){let t=this.clone();return t.transforms.push(e),t}test(...e){let t;if(void 0===(t=1===e.length?"function"==typeof e[0]?{test:e[0]}:e[0]:2===e.length?{name:e[0],test:e[1]}:{name:e[0],message:e[1],test:e[2]}).message&&(t.message=R.default),"function"!=typeof t.test)throw TypeError("`test` is a required parameters");let r=this.clone(),i=q(t),s=t.exclusive||t.name&&!0===r.exclusiveTests[t.name];if(t.exclusive&&!t.name)throw TypeError("Exclusive tests must provide a unique `name` identifying the test");return t.name&&(r.exclusiveTests[t.name]=!!t.exclusive),r.tests=r.tests.filter(e=>(e.OPTIONS.name!==t.name||!s&&e.OPTIONS.test!==i.OPTIONS.test)&&!0),r.tests.push(i),r}when(e,t){Array.isArray(e)||"string"==typeof e||(t=e,e=".");let r=this.clone(),i=b(e).map(e=>new K(e));return i.forEach(e=>{e.isSibling&&r.deps.push(e.key)}),r.conditions.push("function"==typeof t?new $(i,t):$.fromOptions(i,t)),r}typeError(e){let t=this.clone();return t.internalTests.typeError=q({message:e,name:"typeError",skipAbsent:!0,test(e){return!!this.schema._typeCheck(e)||this.createError({params:{type:this.schema.type}})}}),t}oneOf(e,t=R.oneOf){let r=this.clone();return e.forEach(e=>{r._whitelist.add(e),r._blacklist.delete(e)}),r.internalTests.whiteList=q({message:t,name:"oneOf",skipAbsent:!0,test(e){let t=this.schema._whitelist,r=t.resolveAll(this.resolve);return!!r.includes(e)||this.createError({params:{values:Array.from(t).join(", "),resolved:r}})}}),r}notOneOf(e,t=R.notOneOf){let r=this.clone();return e.forEach(e=>{r._blacklist.add(e),r._whitelist.delete(e)}),r.internalTests.blacklist=q({message:t,name:"notOneOf",test(e){let t=this.schema._blacklist,r=t.resolveAll(this.resolve);return!r.includes(e)||this.createError({params:{values:Array.from(t).join(", "),resolved:r}})}}),r}strip(e=!0){let t=this.clone();return t.spec.strip=e,t}describe(e){let t=(e?this.resolve(e):this).clone(),{label:r,meta:i,optional:s,nullable:n}=t.spec;return{meta:i,label:r,optional:s,nullable:n,default:t.getDefault(e),type:t.type,oneOf:t._whitelist.describe(),notOneOf:t._blacklist.describe(),tests:t.tests.filter((e,t,r)=>r.findIndex(t=>t.OPTIONS.name===e.OPTIONS.name)===t).map(t=>{let r=t.OPTIONS.params&&e?L(Object.assign({},t.OPTIONS.params),e):t.OPTIONS.params;return{name:t.OPTIONS.name,params:r}})}}get"~standard"(){let e=this;return{version:1,vendor:"yup",async validate(t){try{return{value:await e.validate(t,{abortEarly:!1})}}catch(e){if(e instanceof I)return{issues:z(e)};throw e}}}}}for(let e of(Y.prototype.__isYupSchema__=!0,["validate","validateSync"]))Y.prototype[`${e}At`]=function(t,r,i={}){let{parent:s,parentPath:n,schema:a}=W(this,t,r,i.context);return a[e](s&&s[n],Object.assign({},i,{parent:s,path:t}))};for(let e of["equals","is"])Y.prototype[e]=Y.prototype.oneOf;for(let e of["not","nope"])Y.prototype[e]=Y.prototype.notOneOf;let G=()=>!0;function X(e){return new Q(e)}class Q extends Y{constructor(e){super("function"==typeof e?{type:"mixed",check:e}:Object.assign({type:"mixed",check:G},e))}}function Z(){return new ee}X.prototype=Q.prototype;class ee extends Y{constructor(){super({type:"boolean",check:e=>(e instanceof Boolean&&(e=e.valueOf()),"boolean"==typeof e)}),this.withMutation(()=>{this.transform((e,t)=>{if(this.spec.coerce&&!this.isType(e)){if(/^(true|1)$/i.test(String(e)))return!0;if(/^(false|0)$/i.test(String(e)))return!1}return e})})}isTrue(e=j.isValue){return this.test({message:e,name:"is-value",exclusive:!0,params:{value:"true"},test:e=>null==e||!0===e})}isFalse(e=j.isValue){return this.test({message:e,name:"is-value",exclusive:!0,params:{value:"false"},test:e=>null==e||!1===e})}default(e){return super.default(e)}defined(e){return super.defined(e)}optional(){return super.optional()}required(e){return super.required(e)}notRequired(){return super.notRequired()}nullable(){return super.nullable()}nonNullable(e){return super.nonNullable(e)}strip(e){return super.strip(e)}}Z.prototype=ee.prototype;let et=/^(\d{4}|[+-]\d{6})(?:-?(\d{2})(?:-?(\d{2}))?)?(?:[ T]?(\d{2}):?(\d{2})(?::?(\d{2})(?:[,.](\d{1,}))?)?(?:(Z)|([+-])(\d{2})(?::?(\d{2}))?)?)?$/;function er(e){var t,r;let i=et.exec(e);return i?{year:ei(i[1]),month:ei(i[2],1)-1,day:ei(i[3],1),hour:ei(i[4]),minute:ei(i[5]),second:ei(i[6]),millisecond:i[7]?ei(i[7].substring(0,3)):0,precision:null!=(t=null==(r=i[7])?void 0:r.length)?t:void 0,z:i[8]||void 0,plusMinus:i[9]||void 0,hourOffset:ei(i[10]),minuteOffset:ei(i[11])}:null}function ei(e,t=0){return Number(e)||t}let es=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,en=/^((https?|ftp):)?\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i,ea=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,eo=RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"),ec=e=>null==e||e===e.trim(),el=({}).toString();function eu(){return new ed}class ed extends Y{constructor(){super({type:"string",check:e=>(e instanceof String&&(e=e.valueOf()),"string"==typeof e)}),this.withMutation(()=>{this.transform((e,t)=>{if(!this.spec.coerce||this.isType(e)||Array.isArray(e))return e;let r=null!=e&&e.toString?e.toString():e;return r===el?e:r})})}required(e){return super.required(e).withMutation(t=>t.test({message:e||R.required,name:"required",skipAbsent:!0,test:e=>!!e.length}))}notRequired(){return super.notRequired().withMutation(e=>(e.tests=e.tests.filter(e=>"required"!==e.OPTIONS.name),e))}length(e,t=O.length){return this.test({message:t,name:"length",exclusive:!0,params:{length:e},skipAbsent:!0,test(t){return t.length===this.resolve(e)}})}min(e,t=O.min){return this.test({message:t,name:"min",exclusive:!0,params:{min:e},skipAbsent:!0,test(t){return t.length>=this.resolve(e)}})}max(e,t=O.max){return this.test({name:"max",exclusive:!0,message:t,params:{max:e},skipAbsent:!0,test(t){return t.length<=this.resolve(e)}})}matches(e,t){let r,i,s=!1;return t&&("object"==typeof t?{excludeEmptyString:s=!1,message:r,name:i}=t:r=t),this.test({name:i||"matches",message:r||O.matches,params:{regex:e},skipAbsent:!0,test:t=>""===t&&s||-1!==t.search(e)})}email(e=O.email){return this.matches(es,{name:"email",message:e,excludeEmptyString:!0})}url(e=O.url){return this.matches(en,{name:"url",message:e,excludeEmptyString:!0})}uuid(e=O.uuid){return this.matches(ea,{name:"uuid",message:e,excludeEmptyString:!1})}datetime(e){let t,r,i="";return e&&("object"==typeof e?{message:i="",allowOffset:t=!1,precision:r}=e:i=e),this.matches(eo,{name:"datetime",message:i||O.datetime,excludeEmptyString:!0}).test({name:"datetime_offset",message:i||O.datetime_offset,params:{allowOffset:t},skipAbsent:!0,test:e=>{if(!e||t)return!0;let r=er(e);return!!r&&!!r.z}}).test({name:"datetime_precision",message:i||O.datetime_precision,params:{precision:r},skipAbsent:!0,test:e=>{if(!e||void 0==r)return!0;let t=er(e);return!!t&&t.precision===r}})}ensure(){return this.default("").transform(e=>null===e?"":e)}trim(e=O.trim){return this.transform(e=>null!=e?e.trim():e).test({message:e,name:"trim",test:ec})}lowercase(e=O.lowercase){return this.transform(e=>null==e?e:e.toLowerCase()).test({message:e,name:"string_case",exclusive:!0,skipAbsent:!0,test:e=>null==e||e===e.toLowerCase()})}uppercase(e=O.uppercase){return this.transform(e=>null==e?e:e.toUpperCase()).test({message:e,name:"string_case",exclusive:!0,skipAbsent:!0,test:e=>null==e||e===e.toUpperCase()})}}function eh(){return new ep}eu.prototype=ed.prototype;class ep extends Y{constructor(){super({type:"number",check(e){let t;return e instanceof Number&&(e=e.valueOf()),"number"==typeof e&&(t=e)==+t}}),this.withMutation(()=>{this.transform((e,t)=>{if(!this.spec.coerce)return e;let r=e;if("string"==typeof r){if(""===(r=r.replace(/\s/g,"")))return NaN;r*=1}return this.isType(r)||null===r?r:parseFloat(r)})})}min(e,t=P.min){return this.test({message:t,name:"min",exclusive:!0,params:{min:e},skipAbsent:!0,test(t){return t>=this.resolve(e)}})}max(e,t=P.max){return this.test({message:t,name:"max",exclusive:!0,params:{max:e},skipAbsent:!0,test(t){return t<=this.resolve(e)}})}lessThan(e,t=P.lessThan){return this.test({message:t,name:"max",exclusive:!0,params:{less:e},skipAbsent:!0,test(t){return t<this.resolve(e)}})}moreThan(e,t=P.moreThan){return this.test({message:t,name:"min",exclusive:!0,params:{more:e},skipAbsent:!0,test(t){return t>this.resolve(e)}})}positive(e=P.positive){return this.moreThan(0,e)}negative(e=P.negative){return this.lessThan(0,e)}integer(e=P.integer){return this.test({name:"integer",message:e,skipAbsent:!0,test:e=>Number.isInteger(e)})}truncate(){return this.transform(e=>null==e?e:0|e)}round(e){var t;let r=["ceil","floor","round","trunc"];if("trunc"===(e=(null==(t=e)?void 0:t.toLowerCase())||"round"))return this.truncate();if(-1===r.indexOf(e.toLowerCase()))throw TypeError("Only valid options for round() are: "+r.join(", "));return this.transform(t=>null==t?t:Math[e](t))}}eh.prototype=ep.prototype;let em=new Date("");function ef(){return new ey}class ey extends Y{constructor(){super({type:"date",check:e=>"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())}),this.withMutation(()=>{this.transform((e,t)=>!this.spec.coerce||this.isType(e)||null===e?e:isNaN(e=function(e){let t=er(e);if(!t)return Date.parse?Date.parse(e):NaN;if(void 0===t.z&&void 0===t.plusMinus)return new Date(t.year,t.month,t.day,t.hour,t.minute,t.second,t.millisecond).valueOf();let r=0;return"Z"!==t.z&&void 0!==t.plusMinus&&(r=60*t.hourOffset+t.minuteOffset,"+"===t.plusMinus&&(r=0-r)),Date.UTC(t.year,t.month,t.day,t.hour,t.minute+r,t.second,t.millisecond)}(e))?ey.INVALID_DATE:new Date(e))})}prepareParam(e,t){let r;if(K.isRef(e))r=e;else{let i=this.cast(e);if(!this._typeCheck(i))throw TypeError(`\`${t}\` must be a Date or a value that can be \`cast()\` to a Date`);r=i}return r}min(e,t=x.min){let r=this.prepareParam(e,"min");return this.test({message:t,name:"min",exclusive:!0,params:{min:e},skipAbsent:!0,test(e){return e>=this.resolve(r)}})}max(e,t=x.max){let r=this.prepareParam(e,"max");return this.test({message:t,name:"max",exclusive:!0,params:{max:e},skipAbsent:!0,test(e){return e<=this.resolve(r)}})}}function e_(e,t){let r=1/0;return e.some((e,i)=>{var s;if(null!=(s=t.path)&&s.includes(e))return r=i,!0}),r}function ew(e){return(t,r)=>e_(e,t)-e_(e,r)}ey.INVALID_DATE=em,ef.prototype=ey.prototype,ef.INVALID_DATE=em;let eg=(e,t,r)=>{if("string"!=typeof e)return e;let i=e;try{i=JSON.parse(e)}catch(e){}return r.isType(i)?i:e},ev=e=>"[object Object]"===Object.prototype.toString.call(e);function eT(e,t){let r=Object.keys(e.fields);return Object.keys(t).filter(e=>-1===r.indexOf(e))}let ek=ew([]);function eC(e){return new eS(e)}class eS extends Y{constructor(e){super({type:"object",check:e=>ev(e)||"function"==typeof e}),this.fields=Object.create(null),this._sortErrors=ek,this._nodes=[],this._excludedEdges=[],this.withMutation(()=>{e&&this.shape(e)})}_cast(e,t={}){var r;let i=super._cast(e,t);if(void 0===i)return this.getDefault(t);if(!this._typeCheck(i))return i;let s=this.fields,n=null!=(r=t.stripUnknown)?r:this.spec.noUnknown,a=[].concat(this._nodes,Object.keys(i).filter(e=>!this._nodes.includes(e))),o={},c=Object.assign({},t,{parent:o,__validating:t.__validating||!1}),l=!1;for(let e of a){let r=s[e],a=e in i,u=i[e];if(r){let s;c.path=(t.path?`${t.path}.`:"")+e;let n=(r=r.resolve({value:u,context:t.context,parent:o}))instanceof Y?r.spec:void 0,a=null==n?void 0:n.strict;if(null!=n&&n.strip){l=l||e in i;continue}void 0!==(s=t.__validating&&a?u:r.cast(u,c))&&(o[e]=s)}else a&&!n&&(o[e]=u);(a!==e in o||o[e]!==u)&&(l=!0)}return l?o:i}_validate(e,t={},r,i){let{from:s=[],originalValue:n=e,recursive:a=this.spec.recursive}=t;t.from=[{schema:this,value:n},...s],t.__validating=!0,t.originalValue=n,super._validate(e,t,r,(e,s)=>{if(!a||!ev(s))return void i(e,s);n=n||s;let o=[];for(let e of this._nodes){let r=this.fields[e];!r||K.isRef(r)||o.push(r.asNestedTest({options:t,key:e,parent:s,parentPath:t.path,originalParent:n}))}this.runTests({tests:o,value:s,originalValue:n,options:t},r,t=>{i(t.sort(this._sortErrors).concat(e),s)})})}clone(e){let t=super.clone(e);return t.fields=Object.assign({},this.fields),t._nodes=this._nodes,t._excludedEdges=this._excludedEdges,t._sortErrors=this._sortErrors,t}concat(e){let t=super.concat(e),r=t.fields;for(let[e,t]of Object.entries(this.fields)){let i=r[e];r[e]=void 0===i?t:i}return t.withMutation(t=>t.setFields(r,[...this._excludedEdges,...e._excludedEdges]))}_getDefault(e){if("default"in this.spec)return super._getDefault(e);if(!this._nodes.length)return;let t={};return this._nodes.forEach(r=>{var i;let s=this.fields[r],n=e;null!=(i=n)&&i.value&&(n=Object.assign({},n,{parent:n.value,value:n.value[r]})),t[r]=s&&"getDefault"in s?s.getDefault(n):void 0}),t}setFields(e,t){let r=this.clone();return r.fields=e,r._nodes=function(e,t=[]){let r=[],i=new Set,s=new Set(t.map(([e,t])=>`${e}-${t}`));function n(e,t){let n=(0,f.split)(e)[0];i.add(n),s.has(`${t}-${n}`)||r.push([t,n])}for(let t of Object.keys(e)){let r=e[t];i.add(t),K.isRef(r)&&r.isSibling?n(r.path,t):F(r)&&"deps"in r&&r.deps.forEach(e=>n(e,t))}return _.default.array(Array.from(i),r).reverse()}(e,t),r._sortErrors=ew(Object.keys(e)),t&&(r._excludedEdges=t),r}shape(e,t=[]){return this.clone().withMutation(r=>{let i=r._excludedEdges;return t.length&&(Array.isArray(t[0])||(t=[t]),i=[...r._excludedEdges,...t]),r.setFields(Object.assign(r.fields,e),i)})}partial(){let e={};for(let[t,r]of Object.entries(this.fields))e[t]="optional"in r&&r.optional instanceof Function?r.optional():r;return this.setFields(e)}deepPartial(){return function e(t){if("fields"in t){let r={};for(let[i,s]of Object.entries(t.fields))r[i]=e(s);return t.setFields(r)}if("array"===t.type){let r=t.optional();return r.innerType&&(r.innerType=e(r.innerType)),r}return"tuple"===t.type?t.optional().clone({types:t.spec.types.map(e)}):"optional"in t?t.optional():t}(this)}pick(e){let t={};for(let r of e)this.fields[r]&&(t[r]=this.fields[r]);return this.setFields(t,this._excludedEdges.filter(([t,r])=>e.includes(t)&&e.includes(r)))}omit(e){let t=[];for(let r of Object.keys(this.fields))e.includes(r)||t.push(r);return this.pick(t)}from(e,t,r){let i=(0,f.getter)(e,!0);return this.transform(s=>{if(!s)return s;let n=s;return((e,t)=>{let r=[...(0,f.normalizePath)(t)];if(1===r.length)return r[0]in e;let i=r.pop(),s=(0,f.getter)((0,f.join)(r),!0)(e);return!!(s&&i in s)})(s,e)&&(n=Object.assign({},s),r||delete n[e],n[t]=i(s)),n})}json(){return this.transform(eg)}exact(e){return this.test({name:"exact",exclusive:!0,message:e||U.exact,test(e){if(null==e)return!0;let t=eT(this.schema,e);return 0===t.length||this.createError({params:{properties:t.join(", ")}})}})}stripUnknown(){return this.clone({noUnknown:!0})}noUnknown(e=!0,t=U.noUnknown){"boolean"!=typeof e&&(t=e,e=!0);let r=this.test({name:"noUnknown",exclusive:!0,message:t,test(t){if(null==t)return!0;let r=eT(this.schema,t);return!e||0===r.length||this.createError({params:{unknown:r.join(", ")}})}});return r.spec.noUnknown=e,r}unknown(e=!0,t=U.noUnknown){return this.noUnknown(!e,t)}transformKeys(e){return this.transform(t=>{if(!t)return t;let r={};for(let i of Object.keys(t))r[e(i)]=t[i];return r})}camelCase(){return this.transformKeys(y.camelCase)}snakeCase(){return this.transformKeys(y.snakeCase)}constantCase(){return this.transformKeys(e=>(0,y.snakeCase)(e).toUpperCase())}describe(e){let t=(e?this.resolve(e):this).clone(),r=super.describe(e);for(let[s,n]of(r.fields={},Object.entries(t.fields))){var i;let t=e;null!=(i=t)&&i.value&&(t=Object.assign({},t,{parent:t.value,value:t.value[s]})),r.fields[s]=n.describe(t)}return r}}function eb(e){return new eE(e)}eC.prototype=eS.prototype;class eE extends Y{constructor(e){super({type:"array",spec:{types:e},check:e=>Array.isArray(e)}),this.innerType=void 0,this.innerType=e}_cast(e,t){let r=super._cast(e,t);if(!this._typeCheck(r)||!this.innerType)return r;let i=!1,s=r.map((e,s)=>{let n=this.innerType.cast(e,Object.assign({},t,{path:`${t.path||""}[${s}]`,parent:r,originalValue:e,value:e,index:s}));return n!==e&&(i=!0),n});return i?s:r}_validate(e,t={},r,i){var s;let n=this.innerType,a=null!=(s=t.recursive)?s:this.spec.recursive;null!=t.originalValue&&t.originalValue,super._validate(e,t,r,(s,o)=>{var c,l;if(!a||!n||!this._typeCheck(o))return void i(s,o);let u=Array(o.length);for(let r=0;r<o.length;r++)u[r]=n.asNestedTest({options:t,index:r,parent:o,parentPath:t.path,originalParent:null!=(l=t.originalValue)?l:e});this.runTests({value:o,tests:u,originalValue:null!=(c=t.originalValue)?c:e,options:t},r,e=>i(e.concat(s),o))})}clone(e){let t=super.clone(e);return t.innerType=this.innerType,t}json(){return this.transform(eg)}concat(e){let t=super.concat(e);return t.innerType=this.innerType,e.innerType&&(t.innerType=t.innerType?t.innerType.concat(e.innerType):e.innerType),t}of(e){let t=this.clone();if(!F(e))throw TypeError("`array.of()` sub-schema must be a valid yup schema not: "+S(e));return t.innerType=e,t.spec=Object.assign({},t.spec,{types:e}),t}length(e,t=N.length){return this.test({message:t,name:"length",exclusive:!0,params:{length:e},skipAbsent:!0,test(t){return t.length===this.resolve(e)}})}min(e,t){return t=t||N.min,this.test({message:t,name:"min",exclusive:!0,params:{min:e},skipAbsent:!0,test(t){return t.length>=this.resolve(e)}})}max(e,t){return t=t||N.max,this.test({message:t,name:"max",exclusive:!0,params:{max:e},skipAbsent:!0,test(t){return t.length<=this.resolve(e)}})}ensure(){return this.default(()=>[]).transform((e,t)=>this._typeCheck(e)?e:null==t?[]:[].concat(t))}compact(e){let t=e?(t,r,i)=>!e(t,r,i):e=>!!e;return this.transform(e=>null!=e?e.filter(t):e)}describe(e){let t=(e?this.resolve(e):this).clone(),r=super.describe(e);if(t.innerType){var i;let s=e;null!=(i=s)&&i.value&&(s=Object.assign({},s,{parent:s.value,value:s.value[0]})),r.innerType=t.innerType.describe(s)}return r}}function eA(e){return new eI(e)}eb.prototype=eE.prototype;class eI extends Y{constructor(e){super({type:"tuple",spec:{types:e},check(e){let t=this.spec.types;return Array.isArray(e)&&e.length===t.length}}),this.withMutation(()=>{this.typeError(D.notType)})}_cast(e,t){let{types:r}=this.spec,i=super._cast(e,t);if(!this._typeCheck(i))return i;let s=!1,n=r.map((e,r)=>{let n=e.cast(i[r],Object.assign({},t,{path:`${t.path||""}[${r}]`,parent:i,originalValue:i[r],value:i[r],index:r}));return n!==i[r]&&(s=!0),n});return s?n:i}_validate(e,t={},r,i){let s=this.spec.types;super._validate(e,t,r,(n,a)=>{var o,c;if(!this._typeCheck(a))return void i(n,a);let l=[];for(let[r,i]of s.entries())l[r]=i.asNestedTest({options:t,index:r,parent:a,parentPath:t.path,originalParent:null!=(c=t.originalValue)?c:e});this.runTests({value:a,tests:l,originalValue:null!=(o=t.originalValue)?o:e,options:t},r,e=>i(e.concat(n),a))})}describe(e){let t=(e?this.resolve(e):this).clone(),r=super.describe(e);return r.innerType=t.spec.types.map((t,r)=>{var i;let s=e;return null!=(i=s)&&i.value&&(s=Object.assign({},s,{parent:s.value,value:s.value[r]})),t.describe(s)}),r}}eA.prototype=eI.prototype;function eR(e,t,r){if(!e||!F(e.prototype))throw TypeError("You must provide a yup schema constructor function");if("string"!=typeof t)throw TypeError("A Method name must be provided");if("function"!=typeof r)throw TypeError("Method function must be provided");e.prototype[t]=r}e.s(["ObjectSchema",()=>eS,"Schema",()=>Y,"addMethod",()=>eR,"array",()=>eb,"boolean",()=>Z,"date",()=>ef,"mixed",()=>X,"number",()=>eh,"object",()=>eC,"reach",()=>J,"ref",()=>M,"string",()=>eu,"tuple",()=>eA],213596);var eO=[{code:"USD",decimals:2,stripeDecimals:2},{code:"EUR",decimals:2,stripeDecimals:2},{code:"GBP",decimals:2,stripeDecimals:2},{code:"JPY",decimals:0,stripeDecimals:0},{code:"INR",decimals:2,stripeDecimals:2},{code:"AUD",decimals:2,stripeDecimals:2},{code:"CAD",decimals:2,stripeDecimals:2}];e.s(["SUPPORTED_CURRENCIES",()=>eO],609574);var eP={GET:{safe:!0,idempotent:!0},POST:{safe:!1,idempotent:!1},PUT:{safe:!1,idempotent:!0},DELETE:{safe:!1,idempotent:!0},PATCH:{safe:!1,idempotent:!1},OPTIONS:{safe:!0,idempotent:!0},HEAD:{safe:!0,idempotent:!0},TRACE:{safe:!0,idempotent:!0},CONNECT:{safe:!1,idempotent:!1}};function ex(e){let[t,r,...i]=e.split(" ");if(i.length>0||!r||"Basic"!==t||!(0,s.isBase64)(r))return null;let n=new TextDecoder().decode((0,s.decodeBase64)(r)).split(":");return[n[0],n.slice(1).join(":")]}e.s(["HTTP_METHODS",()=>eP,"decodeBasicAuthorizationHeader",()=>ex],63956);var ej=["google","github","microsoft","spotify","facebook","discord","gitlab","bitbucket","linkedin","apple","x","twitch"];e.s(["allProviders",()=>ej],951668),e.s(["getRelativePart",()=>eK,"isLocalhost",()=>e$,"isRelative",()=>eM,"isValidHostnameWithWildcards",()=>eF,"isValidUrl",()=>eD,"urlString",()=>eq],160118);var eU=e.i(717817);function eN(...e){try{return new URL(...e)}catch(e){return null}}function eD(e){return!!eN(e)}function eF(e){if(!e)return!1;if(!e.includes("*")){if(!e||e.startsWith(".")||e.endsWith(".")||e.includes(".."))return!1;let t=eN(`https://${e}`);return!!t&&t.hostname===e}if(e.startsWith(".")||e.endsWith(".")||e.includes(".."))return!1;let t=e.replace(/\*+/g,"wildcard");if(!/^[a-zA-Z0-9.-]+$/.test(t))return!1;let r=e.split(/\*+/);for(let e=0;e<r.length;e++){let t=r[e];if(""!==t&&(0===e&&t.startsWith(".")||e===r.length-1&&t.endsWith(".")||t.includes("..")))return!1}return!0}function e$(e){let t=eN(e);return!!t&&!!("localhost"===t.hostname||t.hostname.endsWith(".localhost")||t.hostname.match(/^127\.\d+\.\d+\.\d+$/))}function eM(e){let t=`${(0,n.generateSecureRandomString)()}.stack-auth.example.com`,r=eN(e,`https://${t}`);return!!r&&r.host===t&&"https:"===r.protocol}function eK(e){return e.pathname+e.search+e.hash}function eq(e,...t){return(0,eU.templateIdentity)(e,...t.map(encodeURIComponent))}},850821,698945,550726,926942,485736,684291,401750,431737,e=>{"use strict";let t,r;e.s([],850821),e.s(["StackAdminInterface",()=>tA],431737);var i=e.i(205263),s=e.i(85298);e.s(["StackServerInterface",()=>tE],401750);var n=e.i(104372);e.s(["AccessToken",()=>eg,"InternalSession",()=>eT],926942);var a=e.i(666128);e.s(["accessTokenPayloadSchema",()=>eo,"intervalSchema",()=>K,"passwordSchema",()=>M,"strictEmailSchema",()=>J,"yupObject",()=>j,"yupString",()=>A],698945);var o=e.i(963087),c=e.i(213596),l=e.i(145010),u=e.i(609574),d=e.i(91e3),h=e.i(63956),p=e.i(951668),m=e.i(683767),f=e.i(717817),y=e.i(160118),_=e.i(675174);async function w(e,t,r){try{return await e.validate(t,{...(0,m.omit)(r??{},["currentUserId"]),context:{...r?.context,stackAllowUserIdMe:r?.currentUserId!==void 0}})}catch(s){if(s instanceof ei){let n=r?.currentUserId;if(!n)throw new i.KnownErrors.CannotGetOwnUserWithoutUser;let a=s.path,o=[];for(;a.length>0;)if(a.startsWith("[")){let e=a.indexOf("]");if(e<0)throw new d.StackAssertionError("Invalid path");o.push(JSON.parse(a.slice(1,e))),a=a.slice(e+1)}else{let e=a.indexOf(".");-1===e&&(e=a.length),o.push(a.slice(0,e)),a=a.slice(e+1)}let c=(0,m.deepPlainClone)(t),l=c;for(let e of o.slice(0,-1)){if(!Object.prototype.hasOwnProperty.call(l,e))throw new d.StackAssertionError(`Segment ${e} of path ${s.path} not found in object`);l=l[e]}return l[o[o.length-1]]=n,await w(e,c,r)}throw s}}c.addMethod(c.string,"nonEmpty",function(e){return this.test("non-empty",e??(({path:e})=>`${e} must not be empty`),e=>""!==e)}),c.addMethod(c.Schema,"hasNested",function(e){if(!e.match(/^[a-zA-Z0-9_$:-]*$/))throw new d.StackAssertionError(`yupSchema.hasNested can currently only be used with alphanumeric keys, underscores, dollar signs, colons, and hyphens. Fix this in the future. Provided key: ${JSON.stringify(e)}`);let t=this.meta()?.stackSchemaInfo;if(t?.type==="record")return t.keySchema.isValidSync(e);if(t?.type==="union")return t.items.some(t=>t.hasNested(e));try{return c.reach(this,e),!0}catch(e){if(e instanceof Error&&e.message.includes("The schema does not contain the path"))return!1;throw e}}),c.addMethod(c.Schema,"getNested",function(e){if(!e.match(/^[a-zA-Z0-9_$:-]*$/))throw new d.StackAssertionError(`yupSchema.getNested can currently only be used with alphanumeric keys, underscores, dollar signs, colons, and hyphens. Fix this in the future. Provided key: ${JSON.stringify(e)}`);if(!this.hasNested(e))throw new d.StackAssertionError(`Tried to call yupSchema.getNested, but key is not present in the schema. Provided key: ${e}`,{path:e,schema:this});let t=this.meta()?.stackSchemaInfo;return t?.type==="record"?t.valueSchema:t?.type==="union"?U(...t.items.filter(t=>t.hasNested(e)).map(t=>t.getNested(e))):c.reach(this,e)});var g=e=>`The unique identifier of the ${e}`,v=e=>`Human-readable ${e} display name. This is not a unique identifier.`,T=e=>`URL of the profile image for ${e}. Can be a Base64 encoded image. Must be smaller than 100KB. Please compress and crop to a square before passing in.`,k=e=>`Server metadata. Used as a data store, only accessible from the server side. You can store secret information related to the ${e} here.`,C=e=>"(the number of milliseconds since epoch, January 1, 1970, UTC)",S=e=>`The time the ${e} was created ${C(e)}`,b=`The time the user signed up ${C}`,E=`The time the user was last active ${C}`;function A(...e){return c.string(...e).meta({stackSchemaInfo:{type:"string"}})}function I(...e){return c.number(...e).meta({stackSchemaInfo:{type:"number"}})}function R(...e){return c.boolean(...e).meta({stackSchemaInfo:{type:"boolean"}})}function O(...e){return c.mixed(...e)}function P(...e){return O(...e).meta({stackSchemaInfo:{type:"mixed"}})}function x(e){if(0===e.length)throw Error("yupTuple must have at least one schema");return c.tuple(e).meta({stackSchemaInfo:{type:"tuple",items:e}})}function j(...e){return(function(...e){return c.object(...e).test("no-unknown-object-properties",({path:e})=>`${e} contains unknown properties`,(e,t)=>{if(t.options.context?.noUnknownPathPrefixes?.some(e=>t.path.startsWith(e))&&!1!==t.schema.spec.noUnknown){let r=new Set(Object.keys(t.schema.fields)),i=Object.keys(e??{}).filter(e=>!r.has(e));if(i.length>0)return t.createError({message:`${t.path||"Object"} contains unknown properties: ${i.join(", ")}`,path:t.path,params:{unknownKeys:i,availableKeys:r}})}return!0}).meta({stackSchemaInfo:{type:"object"}})})(...e).default(void 0)}function U(...e){if(0===e.length)throw Error("yupUnion must have at least one schema");return O().meta({stackSchemaInfo:{type:"union",items:e}}).test("is-one-of","Invalid value",async(t,r)=>{if(null==t)return!0;let i=[];for(let s of e)try{return await w(s,t,r.options),!0}catch(e){i.push(e)}return r.createError({message:f.deindent`
        ${r.path} is not matched by any of the provided schemas:
          ${i.map((e,t)=>f.deindent`
            Schema ${t}:
              ${e.errors.join("\n")}
          `).join("\n")}`,path:r.path})})}function N(e,t){return j().meta({stackSchemaInfo:{type:"record",keySchema:e,valueSchema:t}}).unknown(!0).test("record","${path} must be a record of valid values",async function(r,i){if(null==r)return!0;let{path:s,createError:n}=this;if("object"!=typeof r)return n({message:`${s} must be an object`});for(let a of Object.keys(r)){await w(e,a,i.options);try{await w(t,r[a],{...i.options,context:{...i.options.context,path:s?`${s}.${a}`:a}})}catch(e){return n({path:s?`${s}.${a}`:a,message:e.message})}}return!0})}P();var D=A().test({name:"no-spaces",message:e=>`${e.path} contains spaces`,test:e=>null==e||!e.includes(" ")}).test({name:"url",message:e=>`${e.path} is not a valid URL`,test:e=>null==e||(0,y.isValidUrl)(e)});A().test({name:"no-spaces",message:e=>`${e.path} contains spaces`,test:e=>null==e||!e.includes(" ")}).test({name:"wildcard-url",message:e=>`${e.path} is not a valid URL or wildcard URL pattern`,test:e=>{if(null==e)return!0;if(!e.includes("*"))return(0,y.isValidUrl)(e);try{let t="wildcard-placeholder",r=e.replace(/\*/g,t),i=new URL(r);if(i.username.includes(t)||i.password.includes(t)||i.pathname.includes(t)||i.search.includes(t)||i.hash.includes(t)||"http:"!==i.protocol&&"https:"!==i.protocol)return!1;let s=i.hostname.split(t).join("*");return(0,y.isValidHostnameWithWildcards)(s)}catch(e){return!1}}});var F=P().nullable().defined().transform(e=>JSON.parse(JSON.stringify(e)));A().test("json",e=>`${e.path} is not valid JSON`,e=>{if(null==e)return!0;try{return JSON.parse(e),!0}catch(e){return!1}}),A().test("json",e=>`${e.path} is not valid JSON`,e=>{if(!e)return!0;try{return JSON.parse(e),!0}catch(e){return!1}});var $=A().test("is-base64",e=>`${e.path} is not valid base64`,e=>null==e||(0,l.isBase64)(e)),M=A().max(70),K=x([I().min(0).integer().defined(),A().oneOf(["millisecond","second","minute","hour","day","week","month","year"]).defined()]),q=x([I().min(0).integer().defined(),A().oneOf(["day","week","month","year"]).defined()]);U(K.defined(),A().oneOf(["never"]).defined());var L=U(q.defined(),A().oneOf(["never"]).defined()),V=e=>A().max(63).matches(/^[a-zA-Z0-9_][a-zA-Z0-9_-]*$/,`${e} must contain only letters, numbers, underscores, and hyphens, and not start with a hyphen`),W=e=>A().test("money-amount","Invalid money amount",(t,r)=>{if(null==t)return!0;let i=t.match(/^([0-9]+)(\.([0-9]+))?$/);if(!i)return r.createError({message:"Money amount must be in the format of <number> or <number>.<number>"});let s=i[1],n=i[3];return n&&n.length>e.decimals?r.createError({message:`Too many decimals; ${e.code} only has ${e.decimals} decimals`}):!("0"!==s&&s.startsWith("0"))||r.createError({message:"Money amount must not have leading zeros"})}),J=e=>A().email(e).max(256).matches(/^[^.]+(\.[^.]+)*@.*\.[^.][^.]+$/,e),H=A().email();A().oneOf(["client","server","admin"]).defined(),A().oneOf(["server","admin"]).defined(),A().oneOf(["admin"]).defined(),A().test(e=>void 0===e||"internal"===e||(0,_.isUuid)(e)).meta({openapiField:{description:g("project"),exampleValue:"e0b52f4d-dece-408c-af49-d23061bb0f8d"}}),A().nonEmpty().max(255).meta({openapiField:{description:g("project branch"),exampleValue:"main"}}),A().meta({openapiField:{description:v("project"),exampleValue:"MyMusic"}}),D.max(1e6).meta({openapiField:{description:"URL of the logo for the project. This is usually a close to 1:1 image of the company logo.",exampleValue:"https://example.com/logo.png"}}),D.max(1e6).meta({openapiField:{description:"URL of the full logo for the project. This is usually a vertical image with the logo and the company name.",exampleValue:"https://example.com/full-logo.png"}}),A().nullable().meta({openapiField:{description:"A human readable description of the project",exampleValue:"A music streaming service"}}),I().meta({openapiField:{description:S("project"),exampleValue:163e10}}),R().meta({openapiField:{description:"Whether the project is in production mode",exampleValue:!0}}),A().meta({openapiField:{description:g("project config"),exampleValue:"d09201f0-54f5-40bd-89ff-6d1815ddad24"}}),R().meta({openapiField:{description:"Whether localhost is allowed as a domain for this project. Should only be allowed in development mode",exampleValue:!0}}),R().meta({openapiField:{description:"Whether a team should be created for each user that signs up",exampleValue:!0}}),R().meta({openapiField:{description:"Whether magic link authentication is enabled for this project",exampleValue:!0}}),R().meta({openapiField:{description:"Whether passkey authentication is enabled for this project",exampleValue:!0}}),R().meta({openapiField:{description:"Whether client users can create teams",exampleValue:!0}}),R().meta({openapiField:{description:"Whether client users can delete their own account from the client",exampleValue:!0}}),R().meta({openapiField:{description:"Whether users can sign up new accounts, or whether they are only allowed to sign in to existing accounts. Regardless of this option, the server API can always create new users with the `POST /users` endpoint.",exampleValue:!0}}),R().meta({openapiField:{description:"Whether email password authentication is enabled for this project",exampleValue:!0}}),A().oneOf(p.allProviders).meta({openapiField:{description:`OAuth provider ID, one of ${p.allProviders.map(e=>`\`${e}\``).join(", ")}`,exampleValue:"google"}}),R().meta({openapiField:{description:"Whether the OAuth provider is enabled. If an provider is first enabled, then disabled, it will be shown in the list but with enabled=false",exampleValue:!0}}),A().oneOf(["shared","standard"]).meta({openapiField:{description:'OAuth provider type, one of shared, standard. "shared" uses Stack shared OAuth keys and it is only meant for development. "standard" uses your own OAuth keys and will show your logo and company name when signing in with the provider.',exampleValue:"standard"}}),A().meta({openapiField:{description:'OAuth client ID. Needs to be specified when using type="standard"',exampleValue:"google-oauth-client-id"}}),A().meta({openapiField:{description:'OAuth client secret. Needs to be specified when using type="standard"',exampleValue:"google-oauth-client-secret"}}),A().meta({openapiField:{description:"The configuration id for Facebook business login (for things like ads and marketing). This is only required if you are using the standard OAuth with Facebook and you are using Facebook business login."}}),A().meta({openapiField:{description:"The Microsoft tenant id for Microsoft directory. This is only required if you are using the standard OAuth with Microsoft and you have an Azure AD tenant."}}),A().oneOf(["link_method","raise_error","allow_duplicates"]).meta({openapiField:{description:"Determines how to handle OAuth logins that match an existing user by email. `link_method` adds the OAuth method to the existing user. `raise_error` rejects the login with an error. `allow_duplicates` creates a new user.",exampleValue:"link_method"}}),A().oneOf(["shared","standard"]).meta({openapiField:{description:'Email provider type, one of shared, standard. "shared" uses Stack shared email provider and it is only meant for development. "standard" uses your own email server and will have your email address as the sender.',exampleValue:"standard"}}),A().meta({openapiField:{description:'Email sender name. Needs to be specified when using type="standard"',exampleValue:"Stack"}}),A().meta({openapiField:{description:'Email host. Needs to be specified when using type="standard"',exampleValue:"smtp.your-domain.com"}}),I().min(0).max(65535).meta({openapiField:{description:'Email port. Needs to be specified when using type="standard"',exampleValue:587}}),A().meta({openapiField:{description:'Email username. Needs to be specified when using type="standard"',exampleValue:"smtp-email"}}),H.meta({openapiField:{description:'Email sender email. Needs to be specified when using type="standard"',exampleValue:"example@your-domain.com"}}),M.meta({openapiField:{description:'Email password. Needs to be specified when using type="standard"',exampleValue:"your-email-password"}}),A().test("is-handler-path","Handler path must start with /",e=>e?.startsWith("/")).meta({openapiField:{description:'Handler path. If you did not setup a custom handler path, it should be "/handler" by default. It needs to start with /',exampleValue:"/handler"}}),A().meta({openapiField:{description:"Email theme id for the project. Determines the visual style of emails sent by the project."}}),N(A().uuid(),j({displayName:A().meta({openapiField:{description:"Email theme name",exampleValue:"Default Light"}}).defined(),tsxSource:A().meta({openapiField:{description:"Email theme source code tsx component"}}).defined()})).meta({openapiField:{description:"Record of email theme IDs to their display name and source code"}});var B=P().test(e=>void 0===e||!1===e||null===e||"string"==typeof e&&(0,_.isUuid)(e)).meta({openapiField:{description:"Email theme id for the template"}}).optional();N(A().uuid(),j({displayName:A().meta({openapiField:{description:"Email template name",exampleValue:"Email Verification"}}).defined(),tsxSource:A().meta({openapiField:{description:"Email template source code tsx component"}}).defined(),themeId:B})).meta({openapiField:{description:"Record of email template IDs to their display name and source code"}});var z=A().oneOf(["user","team","custom"]),Y=(e,t)=>!e||0!==Object.keys(e).filter(e=>u.SUPPORTED_CURRENCIES.some(t=>t.code===e)).length||t.createError({message:"At least one currency is required"}),G=j({...(0,m.typedFromEntries)(u.SUPPORTED_CURRENCIES.map(e=>[e.code,W(e).optional()])),interval:q.optional(),serverOnly:R(),freeTrial:q.optional()}).test("at-least-one-currency",(e,t)=>Y(e,t)),X=U(A().oneOf(["include-by-default"]).meta({openapiField:{description:"Makes this item free and includes it by default for all customers.",exampleValue:"include-by-default"}}),N(V("priceId"),G)),Q=j({displayName:A(),catalogId:V("catalogId").optional().meta({openapiField:{description:"The ID of the catalog this product belongs to. Within a catalog, all products are mutually exclusive unless they are an add-on to another product in the catalog.",exampleValue:"catalog-id"}}),isAddOnTo:U(R().isFalse(),N(V("productId"),R().isTrue().defined())).optional().meta({openapiField:{description:"The products that this product is an add-on to. If this is set, the customer must already have one of the products in the record to be able to purchase this product.",exampleValue:{"product-id":!0}}}),customerType:z.defined(),freeTrial:q.optional(),serverOnly:R(),stackable:R(),prices:X.defined(),includedItems:N(V("itemId"),j({quantity:I().defined(),repeat:L.optional(),expires:A().oneOf(["never","when-purchase-expires","when-repeated"]).optional()}))}),Z={featureFlag:!0,source:"marketing-campaign"},ee=F.meta({openapiField:{description:"Client metadata. Used as a data store, accessible from the client side. Do not store information that should not be exposed to the client.",exampleValue:Z}}),et=F.meta({openapiField:{description:"Client read-only, server-writable metadata. Used as a data store, accessible from the client side. Do not store information that should not be exposed to the client. The client can read this data, but cannot modify it. This is useful for things like subscription status.",exampleValue:Z}}),er=F.meta({openapiField:{description:k("product"),exampleValue:Z}});Q.concat(j({clientMetadata:ee.optional(),clientReadOnlyMetadata:et.optional(),serverMetadata:er.optional()})),j({display_name:A().defined(),customer_type:z.defined(),free_trial:q.optional(),server_only:R().default(!0),stackable:R().default(!1),prices:N(V("priceId"),j({...(0,m.typedFromEntries)(u.SUPPORTED_CURRENCIES.map(e=>[e.code,W(e).optional()])),interval:q.optional(),free_trial:q.optional()}).test("at-least-one-currency",(e,t)=>Y(e,t))),included_items:N(V("itemId"),j({quantity:I(),repeat:L.optional(),expires:A().oneOf(["never","when-purchase-expires","when-repeated"]).optional()})),client_metadata:ee.optional(),client_read_only_metadata:et.optional(),server_metadata:er.optional()});var ei=class extends Error{constructor(e){super(`This error should be caught by whoever validated the schema, and the field in the path '${e}' should be replaced with the current user's id. This is a workaround to yup not providing access to the context inside the transform function.`),this.path=e}},es="cad564fd-f81b-43f4-b390-98abf3fcc17e",en=A().uuid().transform(e=>"me"===e?es:e).test((e,t)=>{if(!("stackAllowUserIdMe"in(t.options.context??{})))throw new d.StackAssertionError("userIdOrMeSchema is not allowed in this context. Make sure you're using yupValidate from schema-fields.ts to validate, instead of schema.validate(...).");if(!t.options.context?.stackAllowUserIdMe)throw new d.StackAssertionError("userIdOrMeSchema is not allowed in this context. Make sure you're passing in the currentUserId option in yupValidate.");if(e===es)throw new ei(t.path);return!0}).meta({openapiField:{description:"The ID of the user, or the special value `me` for the currently authenticated user",exampleValue:"3241a285-8329-4d69-8f3d-316e08cf140c"}}),ea=A().uuid().meta({openapiField:{description:g("user"),exampleValue:"3241a285-8329-4d69-8f3d-316e08cf140c"}});H.meta({openapiField:{description:"Primary email",exampleValue:"johndoe@example.com"}}),R().meta({openapiField:{description:"Whether the primary email is used for authentication. If this is set to `false`, the user will not be able to sign in with the primary email with password or OTP",exampleValue:!0}}),R().meta({openapiField:{description:"Whether the primary email has been verified to belong to this user",exampleValue:!0}}),A().nullable().max(256).meta({openapiField:{description:v("user"),exampleValue:"John Doe"}}),A().uuid().meta({openapiField:{description:"ID of the team currently selected by the user",exampleValue:"team-id"}}),D.max(1e6).meta({openapiField:{description:T("user"),exampleValue:"https://example.com/image.jpg"}}),I().meta({openapiField:{description:b,exampleValue:163e10}}),F.meta({openapiField:{description:"Client metadata. Used as a data store, accessible from the client side. Do not store information that should not be exposed to the client.",exampleValue:{key:"value"}}}),F.meta({openapiField:{description:"Client read-only, server-writable metadata. Used as a data store, accessible from the client side. Do not store information that should not be exposed to the client. The client can read this data, but cannot modify it. This is useful for things like subscription status.",exampleValue:{key:"value"}}}),F.meta({openapiField:{description:k("user"),exampleValue:{key:"value"}}}),j({id:A().defined(),type:A().oneOf(p.allProviders).defined(),provider_user_id:A().defined()}),I().nullable().meta({openapiField:{description:E,exampleValue:163e10}}),R().meta({openapiField:{hidden:!0,description:"Whether the user has passkeys enabled",exampleValue:!1}}),R().meta({openapiField:{hidden:!0,description:"Whether the user has OTP/magic link enabled. ",exampleValue:!0}}),R().meta({openapiField:{hidden:!0,description:"Whether the user has OTP/magic link enabled. Note that only accounts with verified emails can sign-in with OTP.",exampleValue:!0}}),R().meta({openapiField:{hidden:!0,description:"Whether the user has a password set. If the user does not have a password set, they will not be able to sign in with email/password.",exampleValue:!0}}),M.nullable().meta({openapiField:{description:"Sets the user's password. Doing so revokes all current sessions.",exampleValue:"my-new-password"}}).max(70),A().nonEmpty().meta({openapiField:{description:"If `password` is not given, sets the user's password hash to the given string in Modular Crypt Format (ex.: `$2a$10$VIhIOofSMqGdGlL4wzE//e.77dAQGqNtF/1dT7bqCrVtQuInWy2qi`). Doing so revokes all current sessions."}}),$.nullable().meta({openapiField:{description:"Enables 2FA and sets a TOTP secret for the user. Set to null to disable 2FA.",exampleValue:"dG90cC1zZWNyZXQ="}});var eo=j({sub:A().defined(),exp:I().optional(),iss:A().defined(),aud:A().defined(),project_id:A().defined(),branch_id:A().defined(),refresh_token_id:A().defined(),role:A().oneOf(["authenticated"]).defined(),name:A().defined().nullable(),email:A().defined().nullable(),email_verified:R().defined(),selected_team_id:A().defined().nullable(),is_anonymous:R().defined()});J(void 0).meta({openapiField:{description:"The email to sign in with.",exampleValue:"johndoe@example.com"}}),D.meta({openapiField:{description:"The base callback URL to construct the magic link from. A query parameter `code` with the verification code will be appended to it. The page should then make a request to the `/auth/otp/sign-in` endpoint.",exampleValue:"https://example.com/handler/magic-link-callback"}}),D.meta({openapiField:{description:"The base callback URL to construct a verification link for the verification e-mail. A query parameter `code` with the verification code will be appended to it. The page should then make a request to the `/contact-channels/verify` endpoint.",exampleValue:"https://example.com/handler/email-verification"}});var ec=A().meta({openapiField:{description:"Short-lived access token that can be used to authenticate the user",exampleValue:"eyJhmMiJB2TO...diI4QT"}});j({refresh_token:A().meta({openapiField:{description:"Long-lived refresh token that can be used to obtain a new access token",exampleValue:"i8ns3aq2...14y"}}).defined(),access_token:ec.defined(),is_new_user:R().meta({openapiField:{description:"Whether the user is a new user",exampleValue:!0}}).defined(),user_id:ea.defined()});var el=["$update_team","$delete_team","$read_members","$remove_members","$invite_members","$manage_api_keys"],eu=A().matches(/^\$?[a-z0-9_:]+$/,'Only lowercase letters, numbers, ":", "_" and optional "$" at the beginning are allowed').test("is-system-permission","System permissions must start with a dollar sign",(e,t)=>!e||!e.startsWith("$")||!!el.includes(e)||t.createError({message:"Invalid system permission"})).meta({openapiField:{description:`The permission ID used to uniquely identify a permission. Can either be a custom permission with lowercase letters, numbers, \`:\`, and \`_\` characters, or one of the system permissions: ${el.map(e=>`\`${e}\``).join(", ")}`,exampleValue:"read_secret_info"}});A().matches(/^[a-z0-9_:]+$/,'Only lowercase letters, numbers, ":", "_" are allowed').meta({openapiField:{description:'The permission ID used to uniquely identify a permission. Can only contain lowercase letters, numbers, ":", and "_" characters',exampleValue:"read_secret_info"}}),A().meta({openapiField:{description:"A human-readable description of the permission",exampleValue:"Read secret information"}}),(function(...e){return c.array(...e).meta({stackSchemaInfo:{type:"array"}})})(eu.defined()).meta({openapiField:{description:"The IDs of the permissions that are contained in this permission",exampleValue:["read_public_info"]}}),A().uuid().meta({openapiField:{description:g("team"),exampleValue:"ad962777-8244-496a-b6a2-e0c6a449c79e"}}),A().meta({openapiField:{description:v("team"),exampleValue:"My Team"}}),D.max(1e6).meta({openapiField:{description:T("team"),exampleValue:"https://example.com/image.jpg"}}),F.meta({openapiField:{description:"Client metadata. Used as a data store, accessible from the client side. Do not store information that should not be exposed to the client.",exampleValue:{key:"value"}}}),F.meta({openapiField:{description:"Client read-only, server-writable metadata. Used as a data store, accessible from the client side. Do not store information that should not be exposed to the client. The client can read this data, but cannot modify it. This is useful for things like subscription status.",exampleValue:{key:"value"}}}),F.meta({openapiField:{description:k("team"),exampleValue:{key:"value"}}}),I().meta({openapiField:{description:S("team"),exampleValue:163e10}}),H.meta({openapiField:{description:"The email of the user to invite.",exampleValue:"johndoe@example.com"}}),D.meta({openapiField:{description:"The base callback URL to construct an invite link with. A query parameter `code` with the verification code will be appended to it. The page should then make a request to the `/team-invitations/accept` endpoint.",exampleValue:"https://example.com/handler/team-invitation"}}),en.meta({openapiField:{description:'The ID of the creator of the team. If not specified, the user will not be added to the team. Can be either "me" or the ID of the user. Only used on the client side.',exampleValue:"me"}}),A().meta({openapiField:{description:v("team member")+" Note that this is separate from the display_name of the user.",exampleValue:"John Doe"}}),D.max(1e6).meta({openapiField:{description:T("team member"),exampleValue:"https://example.com/image.jpg"}}),A().uuid().meta({openapiField:{description:g("contact channel"),exampleValue:"b3d396b8-c574-4c80-97b3-50031675ceb2"}}),A().oneOf(["email"]).meta({openapiField:{description:'The type of the contact channel. Currently only "email" is supported.',exampleValue:"email"}}),A().when("type",{is:"email",then:e=>e.email()}).meta({openapiField:{description:"The value of the contact channel. For email, this should be a valid email address.",exampleValue:"johndoe@example.com"}}),R().meta({openapiField:{description:"Whether the contact channel is used for authentication. If this is set to `true`, the user will be able to sign in with the contact channel with password or OTP.",exampleValue:!0}}),R().meta({openapiField:{description:"Whether the contact channel has been verified. If this is set to `true`, the contact channel has been verified to belong to the user.",exampleValue:!0}}),R().meta({openapiField:{description:"Whether the contact channel is the primary contact channel. If this is set to `true`, it will be used for authentication and notifications by default.",exampleValue:!0}}),A().uuid().meta({openapiField:{description:g("OAuth provider"),exampleValue:"b3d396b8-c574-4c80-97b3-50031675ceb2"}}),H.meta({openapiField:{description:"Email of the OAuth provider. This is used to display and identify the OAuth provider in the UI.",exampleValue:"test@gmail.com"}}),A().oneOf(p.allProviders).meta({openapiField:{description:`OAuth provider type, one of ${p.allProviders.map(e=>`\`${e}\``).join(", ")}`,exampleValue:"google"}}),R().meta({openapiField:{description:"Whether the user can use this OAuth provider to sign in. Only one OAuth provider per type can have this set to `true`.",exampleValue:!0}}),R().meta({openapiField:{description:"Whether the user can use this OAuth provider as connected account. Multiple OAuth providers per type can have this set to `true`.",exampleValue:!0}}),A().meta({openapiField:{description:"Account ID of the OAuth provider. This uniquely identifies the account on the provider side.",exampleValue:"google-account-id-12345"}}),A().meta({openapiField:{description:"Provider config ID of the OAuth provider. This uniquely identifies the provider config on config.json file",exampleValue:"google"}}),A().test("is-basic-authorization-header",'Authorization header must be in the format "Basic <base64>"',e=>!e||null!==(0,h.decodeBasicAuthorizationHeader)(e)).test("is-authorization-header","Invalid client_id:client_secret values; did you use the correct values for the integration?",e=>{if(!e)return!0;let[t,r]=(0,h.decodeBasicAuthorizationHeader)(e)??(0,d.throwErr)(`Authz header invalid? This should've been validated by basicAuthorizationHeaderSchema: ${e}`);for(let e of JSON.parse(o.default.env.STACK_INTEGRATION_CLIENTS_CONFIG||"[]"))if(t===e.client_id&&r===e.client_secret)return!0;return!1}),e.s(["AsyncStore",()=>e_,"Store",()=>ef,"storeLock",()=>ey],550726),Error("timeout while waiting for mutex to become available"),Error("mutex already locked");let ed=Error("request for lock canceled");class eh{constructor(e,t=ed){this._value=e,this._cancelError=t,this._queue=[],this._weightedWaiters=[]}acquire(e=1,t=0){if(e<=0)throw Error(`invalid weight ${e}: must be positive`);return new Promise((r,i)=>{let s={resolve:r,reject:i,weight:e,priority:t},n=ep(this._queue,e=>t<=e.priority);-1===n&&e<=this._value?this._dispatchItem(s):this._queue.splice(n+1,0,s)})}runExclusive(e){var t,r,i,s;return t=this,r=arguments,i=void 0,s=function*(e,t=1,r=0){let[i,s]=yield this.acquire(t,r);try{return yield e(i)}finally{s()}},new(i||(i=Promise))(function(e,n){function a(e){try{c(s.next(e))}catch(e){n(e)}}function o(e){try{c(s.throw(e))}catch(e){n(e)}}function c(t){var r;t.done?e(t.value):((r=t.value)instanceof i?r:new i(function(e){e(r)})).then(a,o)}c((s=s.apply(t,r||[])).next())})}waitForUnlock(e=1,t=0){if(e<=0)throw Error(`invalid weight ${e}: must be positive`);return this._couldLockImmediately(e,t)?Promise.resolve():new Promise(r=>{var i,s;let n;this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),i=this._weightedWaiters[e-1],s={resolve:r,priority:t},n=ep(i,e=>s.priority<=e.priority),i.splice(n+1,0,s)})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatchQueue()}release(e=1){if(e<=0)throw Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatchQueue()}cancel(){this._queue.forEach(e=>e.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(e){let t=this._value;this._value-=e.weight,e.resolve([t,this._newReleaser(e.weight)])}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){if(0===this._queue.length)for(let e=this._value;e>0;e--){let t=this._weightedWaiters[e-1];t&&(t.forEach(e=>e.resolve()),this._weightedWaiters[e-1]=[])}else{let e=this._queue[0].priority;for(let t=this._value;t>0;t--){let r=this._weightedWaiters[t-1];if(!r)continue;let i=r.findIndex(t=>t.priority<=e);(-1===i?r:r.splice(0,i)).forEach(e=>e.resolve())}}}_couldLockImmediately(e,t){return(0===this._queue.length||this._queue[0].priority<t)&&e<=this._value}}function ep(e,t){for(let r=e.length-1;r>=0;r--)if(t(e[r]))return r;return -1}var em=e.i(510835),ef=class{constructor(e){this._value=e,this._callbacks=new Map}get(){return this._value}set(e){let t=this._value;this._value=e,this._callbacks.forEach(r=>r(e,t))}update(e){let t=e(this._value);return this.set(t),t}onChange(e){let t=(0,_.generateUuid)();return this._callbacks.set(t,e),{unsubscribe:()=>{this._callbacks.delete(t)}}}onceChange(e){let{unsubscribe:t}=this.onChange((...r)=>{t(),e(...r)});return{unsubscribe:t}}},ey=new class{constructor(){this.semaphore=new eh(1),this.readers=0,this.readersMutex=new eh(1)}async withReadLock(e){await this._acquireReadLock();try{return await e()}finally{await this._releaseReadLock()}}async withWriteLock(e){await this._acquireWriteLock();try{return await e()}finally{await this._releaseWriteLock()}}async _acquireReadLock(){await this.readersMutex.acquire();try{this.readers+=1,1===this.readers&&await this.semaphore.acquire()}finally{this.readersMutex.release()}}async _releaseReadLock(){await this.readersMutex.acquire();try{this.readers-=1,0===this.readers&&this.semaphore.release()}finally{this.readersMutex.release()}}async _acquireWriteLock(){await this.semaphore.acquire()}async _releaseWriteLock(){this.semaphore.release()}},e_=class e{constructor(...e){this._mostRecentOkValue=void 0,this._isRejected=!1,this._waitingRejectFunctions=new Map,this._callbacks=new Map,this._updateCounter=0,this._lastSuccessfulUpdate=-1,0===e.length?this._isAvailable=!1:(this._isAvailable=!0,this._mostRecentOkValue=e[0])}isAvailable(){return this._isAvailable}isRejected(){return this._isRejected}get(){return this.isRejected()?s.AsyncResult.error(this._rejectionError):this.isAvailable()?s.AsyncResult.ok(this._mostRecentOkValue):s.AsyncResult.pending()}getOrWait(){let e=(0,_.generateUuid)();if(this.isRejected())return(0,em.rejected)(this._rejectionError);if(this.isAvailable())return(0,em.resolved)(this._mostRecentOkValue);let t=new Promise((t,r)=>{this.onceChange(e=>{t(e)}),this._waitingRejectFunctions.set(e,r)}).finally(()=>{this._waitingRejectFunctions.delete(e)});return(0,em.pending)(t)}_setIfLatest(e,t){let r=this.get(),i=this._mostRecentOkValue;if(t>this._lastSuccessfulUpdate)switch(e.status){case"ok":if(!this._isAvailable||this._isRejected||this._mostRecentOkValue!==e.data)return this._lastSuccessfulUpdate=t,this._isAvailable=!0,this._isRejected=!1,this._mostRecentOkValue=e.data,this._rejectionError=void 0,this._callbacks.forEach(e=>e({state:this.get(),oldState:r,lastOkValue:i})),!0;break;case"error":return this._lastSuccessfulUpdate=t,this._isAvailable=!1,this._isRejected=!0,this._rejectionError=e.error,this._waitingRejectFunctions.forEach(t=>t(e.error)),this._callbacks.forEach(e=>e({state:this.get(),oldState:r,lastOkValue:i})),!0}return!1}set(e){this._setIfLatest(s.Result.ok(e),++this._updateCounter)}update(e){let t=e(this._mostRecentOkValue);return this.set(t),t}async setAsync(e){return await ey.withReadLock(async()=>{let t=++this._updateCounter,r=await s.Result.fromPromise(e);return this._setIfLatest(r,t)})}setUnavailable(){this._lastSuccessfulUpdate=++this._updateCounter,this._mostRecentOkValue=void 0,this._isAvailable=!1,this._isRejected=!1,this._rejectionError=void 0}setRejected(e){this._setIfLatest(s.Result.error(e),++this._updateCounter)}map(t){let r=new e;return this.onChange(e=>{r.set(t(e))}),r}onChange(e){return this.onStateChange(({state:t,lastOkValue:r})=>{"ok"===t.status&&e(t.data,r)})}onStateChange(e){let t=(0,_.generateUuid)();return this._callbacks.set(t,e),{unsubscribe:()=>{this._callbacks.delete(t)}}}onceChange(e){let{unsubscribe:t}=this.onChange((...r)=>{t(),e(...r)});return{unsubscribe:t}}onceStateChange(e){let{unsubscribe:t}=this.onStateChange((...r)=>{t(),e(...r)});return{unsubscribe:t}}};function ew(e){try{let t=a.decodeJwt(e);return eo.validateSync(t)}catch(e){return null}}var eg=class e{constructor(e){if(this.token=e,"undefined"===e)throw new d.StackAssertionError("Access token is the string 'undefined'; it's unlikely this is the correct value. They're supposed to be unguessable!")}static createIfValid(t){return ew(t)?new e(t):null}get payload(){return ew(this.token)??(0,d.throwErr)("Invalid access token in payload (should've been validated in createIfValid)",{token:this.token})}get expiresAt(){let{exp:e}=this.payload;return new Date(void 0===e?864e13:1e3*e)}get expiresInMillis(){return Math.max(0,this.expiresAt.getTime()-Date.now())}isExpired(){return this.expiresInMillis<=0}},ev=class{constructor(e){if(this.token=e,"undefined"===e)throw new d.StackAssertionError("Refresh token is the string 'undefined'; it's unlikely this is the correct value. They're supposed to be unguessable!")}},eT=class e{constructor(t){this._options=t,this._knownToBeInvalid=new ef(!1),this._refreshPromise=null,this._accessToken=new ef(t.accessToken?eg.createIfValid(t.accessToken):null),this._refreshToken=t.refreshToken?new ev(t.refreshToken):null,null===t.accessToken&&null===t.refreshToken&&this._knownToBeInvalid.set(!0),this.sessionKey=e.calculateSessionKey({accessToken:t.accessToken??null,refreshToken:t.refreshToken})}static calculateSessionKey(e){return e.refreshToken?`refresh-${e.refreshToken}`:e.accessToken?`access-${e.accessToken}`:"not-logged-in"}isKnownToBeInvalid(){return this._knownToBeInvalid.get()}markInvalid(){this._accessToken.set(null),this._knownToBeInvalid.set(!0)}onInvalidate(e){return this._knownToBeInvalid.onChange(()=>e())}getAccessTokenIfNotExpiredYet(e){if(e>6e4)throw Error(`Required access token expiry ${e}ms is too long; access tokens are too short to be used for more than 60s`);let t=this._getPotentiallyInvalidAccessTokenIfAvailable();return!t||t.expiresInMillis<e?null:t}async getOrFetchLikelyValidTokens(e){let t=this.getAccessTokenIfNotExpiredYet(e);if(!t){let t=await this.fetchNewTokens(),r=t?.accessToken.expiresInMillis;if(r&&r<e)throw new d.StackAssertionError(`Required access token expiry ${e}ms is too long; access tokens are too short when they're generated (${r}ms)`);return t}return{accessToken:t,refreshToken:this._refreshToken}}async fetchNewTokens(){let e=await this._getNewlyFetchedAccessToken();return e?{accessToken:e,refreshToken:this._refreshToken}:null}markAccessTokenExpired(e){this._accessToken.get()===e&&this._accessToken.set(null)}onAccessTokenChange(e){return this._accessToken.onChange(e)}_getPotentiallyInvalidAccessTokenIfAvailable(){if(!this._refreshToken||this.isKnownToBeInvalid())return null;let e=this._accessToken.get();return e&&!e.isExpired()?e:null}async _getNewlyFetchedAccessToken(){return!this._refreshToken||this._knownToBeInvalid.get()?null:(this._refreshPromise||this._refreshAndSetRefreshPromise(this._refreshToken),await this._refreshPromise)}_refreshAndSetRefreshPromise(e){let t=this._options.refreshAccessTokenCallback(e).then(e=>(t===this._refreshPromise&&(this._refreshPromise=null,this._accessToken.set(e),e||this.markInvalid()),e));this._refreshPromise=t}};function ek(e,t){if(null==e)return!1;try{return e instanceof t||Object.getPrototypeOf(e)[Symbol.toStringTag]===t.prototype[Symbol.toStringTag]}catch{return!1}}e.s(["StackClientInterface",()=>tb],684291),"undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(t="oauth4webapi/v2.17.0");let eC=Symbol(),eS=Symbol(),eb=Symbol(),eE=Symbol(),eA=Symbol();Symbol();let eI=Symbol(),eR=new TextEncoder,eO=new TextDecoder;function eP(e){return"string"==typeof e?eR.encode(e):eO.decode(e)}function ex(e){if("string"==typeof e)try{let t=atob(e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"")),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}catch(e){throw new eU("The input to be decoded is not correctly encoded.",{cause:e})}var t=e;t instanceof ArrayBuffer&&(t=new Uint8Array(t));let r=[];for(let e=0;e<t.byteLength;e+=32768)r.push(String.fromCharCode.apply(null,t.subarray(e,e+32768)));return btoa(r.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}class ej extends Error{constructor(e){super(e??"operation not supported"),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}let eU=class extends Error{constructor(e,t){super(e,t),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}},eN=new class{constructor(e){this.cache=new Map,this._cache=new Map,this.maxSize=e}get(e){let t=this.cache.get(e);return t||((t=this._cache.get(e))?(this.update(e,t),t):void 0)}has(e){return this.cache.has(e)||this._cache.has(e)}set(e,t){return this.cache.has(e)?this.cache.set(e,t):this.update(e,t),this}delete(e){return this.cache.has(e)?this.cache.delete(e):!!this._cache.has(e)&&this._cache.delete(e)}update(e,t){this.cache.set(e,t),this.cache.size>=this.maxSize&&(this._cache=this.cache,this.cache=new Map)}}(100);function eD(e){return e instanceof CryptoKey}function eF(e){return eD(e)&&"private"===e.type}function e$(e){try{let t=e.headers.get("dpop-nonce");t&&eN.set(new URL(e.url).origin,t)}catch{}return e}function eM(e){return!(null===e||"object"!=typeof e||Array.isArray(e))}function eK(e){return"string"==typeof e&&0!==e.length}function eq(){return ex(crypto.getRandomValues(new Uint8Array(32)))}function eL(){return eq()}function eV(){return eq()}async function eW(e){if(!eK(e))throw TypeError('"codeVerifier" must be a non-empty string');return ex(await crypto.subtle.digest("SHA-256",eP(e)))}function eJ(e){return encodeURIComponent(e).replace(/%20/g,"+")}function eH(e){switch(e.algorithm.name){case"RSA-PSS":switch(e.algorithm.hash.name){case"SHA-256":return"PS256";case"SHA-384":return"PS384";case"SHA-512":return"PS512";default:throw new ej("unsupported RsaHashedKeyAlgorithm hash name")}case"RSASSA-PKCS1-v1_5":switch(e.algorithm.hash.name){case"SHA-256":return"RS256";case"SHA-384":return"RS384";case"SHA-512":return"RS512";default:throw new ej("unsupported RsaHashedKeyAlgorithm hash name")}case"ECDSA":switch(e.algorithm.namedCurve){case"P-256":return"ES256";case"P-384":return"ES384";case"P-521":return"ES512";default:throw new ej("unsupported EcKeyAlgorithm namedCurve")}case"Ed25519":case"Ed448":return"EdDSA";default:throw new ej("unsupported CryptoKey algorithm name")}}function eB(e){let t=e?.[eC];return"number"==typeof t&&Number.isFinite(t)?t:0}function ez(){return Math.floor(Date.now()/1e3)}async function eY(e,t,r,i,s){let n,a={alg:eH(r),kid:i},o=(n=ez()+eB(t),{jti:eq(),aud:[e.issuer,e.token_endpoint],exp:n+60,iat:n,nbf:n,iss:t.client_id,sub:t.client_id});return s?.(a,o),e2(a,o,r)}function eG(e){if("object"!=typeof e||null===e)throw TypeError('"as" must be an object');if(!eK(e.issuer))throw TypeError('"as.issuer" property must be a non-empty string');return!0}function eX(e){if("object"!=typeof e||null===e)throw TypeError('"client" must be an object');if(!eK(e.client_id))throw TypeError('"client.client_id" property must be a non-empty string');return!0}function eQ(e){if(!eK(e))throw TypeError('"client.client_secret" property must be a non-empty string');return e}function eZ(e,t){if(void 0!==t)throw TypeError(`"options.clientPrivateKey" property must not be provided when ${e} client authentication method is used.`)}function e0(e,t){if(void 0!==t)throw TypeError(`"client.client_secret" property must not be provided when ${e} client authentication method is used.`)}async function e1(e,t,r,i,s){switch(r.delete("client_secret"),r.delete("client_assertion_type"),r.delete("client_assertion"),t.token_endpoint_auth_method){case void 0:case"client_secret_basic":var n,a;let o,c,l;eZ("client_secret_basic",s),i.set("authorization",(n=t.client_id,a=eQ(t.client_secret),o=eJ(n),c=eJ(a),l=btoa(`${o}:${c}`),`Basic ${l}`));break;case"client_secret_post":eZ("client_secret_post",s),r.set("client_id",t.client_id),r.set("client_secret",eQ(t.client_secret));break;case"private_key_jwt":{if(e0("private_key_jwt",t.client_secret),void 0===s)throw TypeError('"options.clientPrivateKey" must be provided when "client.token_endpoint_auth_method" is "private_key_jwt"');let{key:i,kid:n,modifyAssertion:a}=function(e){if(e instanceof CryptoKey)return{key:e};if(!(e?.key instanceof CryptoKey))return{};if(void 0!==e.kid&&!eK(e.kid))throw TypeError('"kid" must be a non-empty string');return{key:e.key,kid:e.kid,modifyAssertion:e[eE]}}(s);if(!eF(i))throw TypeError('"options.clientPrivateKey.key" must be a private CryptoKey');r.set("client_id",t.client_id),r.set("client_assertion_type","urn:ietf:params:oauth:client-assertion-type:jwt-bearer"),r.set("client_assertion",await eY(e,t,i,n,a));break}case"tls_client_auth":case"self_signed_tls_client_auth":case"none":e0(t.token_endpoint_auth_method,t.client_secret),eZ(t.token_endpoint_auth_method,s),r.set("client_id",t.client_id);break;default:throw new ej("unsupported client token_endpoint_auth_method")}}async function e2(e,t,r){if(!r.usages.includes("sign"))throw TypeError('CryptoKey instances used for signing assertions must include "sign" in their "usages"');let i=`${ex(eP(JSON.stringify(e)))}.${ex(eP(JSON.stringify(t)))}`,s=ex(await crypto.subtle.sign(tm(r),r,eP(i)));return`${i}.${s}`}async function e4(e,t,r,i,s,n){let{privateKey:a,publicKey:o,nonce:c=eN.get(r.origin)}=t;if(!eF(a))throw TypeError('"DPoP.privateKey" must be a private CryptoKey');if(!(eD(o)&&"public"===o.type))throw TypeError('"DPoP.publicKey" must be a public CryptoKey');if(void 0!==c&&!eK(c))throw TypeError('"DPoP.nonce" must be a non-empty string or undefined');if(!o.extractable)throw TypeError('"DPoP.publicKey.extractable" must be true');let l=ez()+s,u={alg:eH(a),typ:"dpop+jwt",jwk:await e8(o)},d={iat:l,jti:eq(),htm:i,nonce:c,htu:`${r.origin}${r.pathname}`,ath:n?ex(await crypto.subtle.digest("SHA-256",eP(n))):void 0};t[eE]?.(u,d),e.set("dpop",await e2(u,d,a))}async function e6(e){let{kty:t,e:i,n:s,x:n,y:a,crv:o}=await crypto.subtle.exportKey("jwk",e),c={kty:t,e:i,n:s,x:n,y:a,crv:o};return r.set(e,c),c}async function e8(e){return r||(r=new WeakMap),r.get(e)||e6(e)}function e5(e,t,r){if("string"!=typeof e){if(r)throw TypeError(`"as.mtls_endpoint_aliases.${t}" must be a string`);throw TypeError(`"as.${t}" must be a string`)}return new URL(e)}function e3(e){return!("object"!=typeof e||Array.isArray(e))&&null!==e&&void 0!==e.error}async function e7(e,t,r,i,s,n,a){return await e1(e,t,s,n,a?.clientPrivateKey),n.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),(a?.[eb]||fetch)(i.href,{body:s,headers:Object.fromEntries(n.entries()),method:r,redirect:"manual",signal:a?.signal?function(e){if("function"==typeof e&&(e=e()),!(e instanceof AbortSignal))throw TypeError('"options.signal" must return or be an instance of AbortSignal');return e}(a.signal):null}).then(e$)}async function e9(e,r,i,s,n){let a=function(e,t,r=!1){return r&&e.mtls_endpoint_aliases&&t in e.mtls_endpoint_aliases?e5(e.mtls_endpoint_aliases[t],t,r):e5(e[t],t,r)}(e,"token_endpoint",!!(r.use_mtls_endpoint_aliases||n?.[eI]));s.set("grant_type",i);let o=function(e){ek(e,Headers)&&(e=Object.fromEntries(e.entries()));let r=new Headers(e);if(t&&!r.has("user-agent")&&r.set("user-agent",t),r.has("authorization"))throw TypeError('"options.headers" must not include the "authorization" header name');if(r.has("dpop"))throw TypeError('"options.headers" must not include the "dpop" header name');return r}(n?.headers);return o.set("accept","application/json"),n?.DPoP!==void 0&&await e4(o,n.DPoP,a,"POST",eB(r)),e7(e,r,"POST",a,s,o,n)}async function te(e,t,r,i){if(eG(e),eX(t),!eK(r))throw TypeError('"refreshToken" must be a non-empty string');let s=new URLSearchParams(i?.additionalParameters);return s.set("refresh_token",r),e9(e,t,"refresh_token",s,i)}Symbol();let tt=new WeakMap;async function tr(e,t,r,i=!1,s=!1){let n;if(eG(e),eX(t),!ek(r,Response))throw TypeError('"response" must be an instance of Response');if(200!==r.status){let e;if(e=await th(r))return e;throw new eU('"response" is not a conform Token Endpoint response')}td(r);try{n=await r.json()}catch(e){throw new eU('failed to parse "response" body as JSON',{cause:e})}if(!eM(n))throw new eU('"response" body must be a top level object');if(!eK(n.access_token))throw new eU('"response" body "access_token" property must be a non-empty string');if(!eK(n.token_type))throw new eU('"response" body "token_type" property must be a non-empty string');if(n.token_type=n.token_type.toLowerCase(),"dpop"!==n.token_type&&"bearer"!==n.token_type)throw new ej("unsupported `token_type` value");if(void 0!==n.expires_in&&("number"!=typeof n.expires_in||n.expires_in<=0))throw new eU('"response" body "expires_in" property must be a positive number');if(!s&&void 0!==n.refresh_token&&!eK(n.refresh_token))throw new eU('"response" body "refresh_token" property must be a non-empty string');if(void 0!==n.scope&&"string"!=typeof n.scope)throw new eU('"response" body "scope" property must be a string');if(!i){if(void 0!==n.id_token&&!eK(n.id_token))throw new eU('"response" body "id_token" property must be a non-empty string');if(n.id_token){let r,{claims:i,jwt:s}=await t_(n.id_token,tw.bind(void 0,t.id_token_signed_response_alg,e.id_token_signing_alg_values_supported),tf,eB(t),"number"==typeof(r=t?.[eS])&&Number.isFinite(r)&&-1!==Math.sign(r)?r:30,t[eA]).then(tl.bind(void 0,["aud","exp","iat","iss","sub"])).then(tn.bind(void 0,e.issuer)).then(ts.bind(void 0,t.client_id));if(Array.isArray(i.aud)&&1!==i.aud.length){if(void 0===i.azp)throw new eU('ID Token "aud" (audience) claim includes additional untrusted audiences');if(i.azp!==t.client_id)throw new eU('unexpected ID Token "azp" (authorized party) claim value')}if(void 0!==i.auth_time&&(!Number.isFinite(i.auth_time)||1!==Math.sign(i.auth_time)))throw new eU('ID Token "auth_time" (authentication time) must be a positive number');tt.set(n,[i,s])}}return n}async function ti(e,t,r){return tr(e,t,r)}function ts(e,t){if(Array.isArray(t.claims.aud)){if(!t.claims.aud.includes(e))throw new eU('unexpected JWT "aud" (audience) claim value')}else if(t.claims.aud!==e)throw new eU('unexpected JWT "aud" (audience) claim value');return t}function tn(e,t){if(t.claims.iss!==e)throw new eU('unexpected JWT "iss" (issuer) claim value');return t}new WeakMap;let ta=new WeakSet;async function to(e,t,r,i,s,n){if(eG(e),eX(t),!ta.has(r))throw TypeError('"callbackParameters" must be an instance of URLSearchParams obtained from "validateAuthResponse()", or "validateJwtAuthResponse()');if(!eK(i))throw TypeError('"redirectUri" must be a non-empty string');if(!eK(s))throw TypeError('"codeVerifier" must be a non-empty string');let a=tg(r,"code");if(!a)throw new eU('no authorization code in "callbackParameters"');let o=new URLSearchParams(n?.additionalParameters);return o.set("redirect_uri",i),o.set("code_verifier",s),o.set("code",a),e9(e,t,"authorization_code",o,n)}let tc={aud:"audience",c_hash:"code hash",client_id:"client id",exp:"expiration time",iat:"issued at",iss:"issuer",jti:"jwt id",nonce:"nonce",s_hash:"state hash",sub:"subject",ath:"access token hash",htm:"http method",htu:"http uri",cnf:"confirmation"};function tl(e,t){for(let r of e)if(void 0===t.claims[r])throw new eU(`JWT "${r}" (${tc[r]}) claim missing`);return t}async function tu(e,t,r){let i=await tr(e,t,r,!0);if(e3(i))return i;if(void 0!==i.id_token){if("string"==typeof i.id_token&&i.id_token.length)throw new eU("Unexpected ID Token returned, use processAuthorizationCodeOpenIDResponse() for OpenID Connect callback processing");delete i.id_token}return i}function td(e){if(e.bodyUsed)throw TypeError('"response" body has been used already')}async function th(e){if(e.status>399&&e.status<500){td(e);try{let t=await e.json();if(eM(t)&&"string"==typeof t.error&&t.error.length)return void 0!==t.error_description&&"string"!=typeof t.error_description&&delete t.error_description,void 0!==t.error_uri&&"string"!=typeof t.error_uri&&delete t.error_uri,void 0!==t.algs&&"string"!=typeof t.algs&&delete t.algs,void 0!==t.scope&&"string"!=typeof t.scope&&delete t.scope,t}catch{}}}function tp(e){if("number"!=typeof e.modulusLength||e.modulusLength<2048)throw new eU(`${e.name} modulusLength must be at least 2048 bits`)}function tm(e){switch(e.algorithm.name){case"ECDSA":return{name:e.algorithm.name,hash:function(e){switch(e){case"P-256":return"SHA-256";case"P-384":return"SHA-384";case"P-521":return"SHA-512";default:throw new ej}}(e.algorithm.namedCurve)};case"RSA-PSS":switch(tp(e.algorithm),e.algorithm.hash.name){case"SHA-256":case"SHA-384":case"SHA-512":return{name:e.algorithm.name,saltLength:parseInt(e.algorithm.hash.name.slice(-3),10)>>3};default:throw new ej}case"RSASSA-PKCS1-v1_5":return tp(e.algorithm),e.algorithm.name;case"Ed448":case"Ed25519":return e.algorithm.name}throw new ej}Symbol(),Symbol();let tf=Symbol();async function ty(e,t,r,i){let s=`${e}.${t}`;if(!await crypto.subtle.verify(tm(r),r,i,eP(s)))throw new eU("JWT signature verification failed")}async function t_(e,t,r,i,s,n){let a,o,c,{0:l,1:u,2:d,length:h}=e.split(".");if(5===h)if(void 0!==n)e=await n(e),{0:l,1:u,2:d,length:h}=e.split(".");else throw new ej("JWE structure JWTs are not supported");if(3!==h)throw new eU("Invalid JWT");try{a=JSON.parse(eP(ex(l)))}catch(e){throw new eU("failed to parse JWT Header body as base64url encoded JSON",{cause:e})}if(!eM(a))throw new eU("JWT Header must be a top level object");if(t(a),void 0!==a.crit)throw new eU('unexpected JWT "crit" header parameter');let p=ex(d);r!==tf&&(o=await r(a),await ty(l,u,o,p));try{c=JSON.parse(eP(ex(u)))}catch(e){throw new eU("failed to parse JWT Payload body as base64url encoded JSON",{cause:e})}if(!eM(c))throw new eU("JWT Payload must be a top level object");let m=ez()+i;if(void 0!==c.exp){if("number"!=typeof c.exp)throw new eU('unexpected JWT "exp" (expiration time) claim type');if(c.exp<=m-s)throw new eU('unexpected JWT "exp" (expiration time) claim value, timestamp is <= now()')}if(void 0!==c.iat&&"number"!=typeof c.iat)throw new eU('unexpected JWT "iat" (issued at) claim type');if(void 0!==c.iss&&"string"!=typeof c.iss)throw new eU('unexpected JWT "iss" (issuer) claim type');if(void 0!==c.nbf){if("number"!=typeof c.nbf)throw new eU('unexpected JWT "nbf" (not before) claim type');if(c.nbf>m+s)throw new eU('unexpected JWT "nbf" (not before) claim value, timestamp is > now()')}if(void 0!==c.aud&&"string"!=typeof c.aud&&!Array.isArray(c.aud))throw new eU('unexpected JWT "aud" (audience) claim type');return{header:a,claims:c,signature:p,key:o,jwt:e}}function tw(e,t,r){if(void 0!==e){if(r.alg!==e)throw new eU('unexpected JWT "alg" header parameter');return}if(Array.isArray(t)){if(!t.includes(r.alg))throw new eU('unexpected JWT "alg" header parameter');return}if("RS256"!==r.alg)throw new eU('unexpected JWT "alg" header parameter')}function tg(e,t){let{0:r,length:i}=e.getAll(t);if(i>1)throw new eU(`"${t}" parameter must be provided only once`);return r}let tv=Symbol(),tT=Symbol();function tk(e,t,r,i){var s;if(eG(e),eX(t),r instanceof URL&&(r=r.searchParams),!(r instanceof URLSearchParams))throw TypeError('"parameters" must be an instance of URLSearchParams, or URL');if(tg(r,"response"))throw new eU('"parameters" contains a JARM response, use validateJwtAuthResponse() instead of validateAuthResponse()');let n=tg(r,"iss"),a=tg(r,"state");if(!n&&e.authorization_response_iss_parameter_supported)throw new eU('response parameter "iss" (issuer) missing');if(n&&n!==e.issuer)throw new eU('unexpected "iss" (issuer) response parameter value');switch(i){case void 0:case tT:if(void 0!==a)throw new eU('unexpected "state" response parameter encountered');break;case tv:break;default:if(!eK(i))throw new eU('"expectedState" must be a non-empty string');if(void 0===a)throw new eU('response parameter "state" missing');if(a!==i)throw new eU('unexpected "state" response parameter value')}let o=tg(r,"error");if(o)return{error:o,error_description:tg(r,"error_description"),error_uri:tg(r,"error_uri")};let c=tg(r,"id_token"),l=tg(r,"token");if(void 0!==c||void 0!==l)throw new ej("implicit and hybrid flows are not supported");return s=new URLSearchParams(r),ta.add(s),s}e.s(["authorizationCodeGrantRequest",()=>to,"calculatePKCECodeChallenge",()=>eW,"generateRandomCodeVerifier",()=>eL,"generateRandomState",()=>eV,"isOAuth2Error",()=>e3,"processAuthorizationCodeOAuth2Response",()=>tu,"processRefreshTokenResponse",()=>ti,"refreshTokenGrantRequest",()=>te,"validateAuthResponse",()=>tk],485736);var tC=e.i(835676),tS=e.i(906360),tb=class{constructor(e){this.options=e}get projectId(){return this.options.projectId}getApiUrl(){return this.options.getBaseUrl()+"/api/v1"}async runNetworkDiagnostics(e,t){if(this.pendingNetworkDiagnostics)return await this.pendingNetworkDiagnostics;this.pendingNetworkDiagnostics=this._runNetworkDiagnosticsInner(e,t);try{return await this.pendingNetworkDiagnostics}finally{this.pendingNetworkDiagnostics=void 0}}async _runNetworkDiagnosticsInner(e,t){let r=async e=>{try{return await e(),"OK"}catch(e){return`${e}`}},i=await r(async()=>{let e=await fetch("https://1.1.1.1/cdn-cgi/trace");if(!e.ok)throw Error(`${e.status} ${e.statusText}: ${await e.text()}`)}),s=await r(async()=>{let e=await fetch(new URL("/health",this.getApiUrl()));if(!e.ok)throw Error(`${e.status} ${e.statusText}: ${await e.text()}`)}),n=await r(async()=>{let e=await fetch("https://app.stack-auth.com/health");if(!e.ok)throw Error(`${e.status} ${e.statusText}: ${await e.text()}`)}),a=await r(async()=>{let e=await fetch("https://api.stack-auth.com/health");if(!e.ok)throw Error(`${e.status} ${e.statusText}: ${await e.text()}`)});return{"navigator?.onLine":tS.globalVar.navigator?.onLine,cfTrace:i,baseUrlBackend:s,prodDashboard:n,prodBackend:a}}async _createNetworkError(e,t,r){return Error(f.deindent`
      Stack Auth is unable to connect to the server. Please check your internet connection and try again.

      If the problem persists, please contact support and provide a screenshot of your entire browser console.

      ${e}

      ${JSON.stringify(await this.runNetworkDiagnostics(t,r),null,2)}
    `,{cause:e})}async _networkRetry(e,t,r){let i=await s.Result.retry(e,5,{exponentialDelayBase:1e3});if("error"===i.status){if(tS.globalVar.navigator&&!1===tS.globalVar.navigator.onLine)throw Error("You are offline. Please check your internet connection and try again. (window.navigator.onLine is false)",{cause:i.error});throw await this._createNetworkError(i.error,t,r)}return i.data}async _networkRetryException(e,t,r){return await this._networkRetry(async()=>await s.Result.fromThrowingAsync(e),t,r)}async fetchNewAccessToken(e){if(!("publishableClientKey"in this.options))throw Error("Admin session token is currently not supported for fetching new access token. Did you try to log in on a StackApp initiated with the admin session?");let t={issuer:this.options.getBaseUrl(),algorithm:"oauth2",token_endpoint:this.getApiUrl()+"/auth/oauth/token"},r={client_id:this.projectId,client_secret:this.options.publishableClientKey,token_endpoint_auth_method:"client_secret_post"},s=await this._networkRetryException(async()=>{let s=await te(t,r,e.token),n=await this._processResponse(s);if("error"===n.status){let e=n.error;if(i.KnownErrors.RefreshTokenError.isInstance(e))return null;throw e}if(!n.data.ok){let e=await n.data.text();throw Error(`Failed to send refresh token request: ${n.status} ${e}`)}return n.data});if(!s)return null;let n=await ti(t,r,s);if(e3(n))throw new d.StackAssertionError("OAuth error",{result:n});if(!n.access_token)throw new d.StackAssertionError("Access token not found in token endpoint response, this is weird!");return eg.createIfValid(n.access_token)??(0,d.throwErr)("Access token in fetchNewAccessToken is invalid, looks like the backend is returning an invalid token!",{result:n})}async sendClientRequest(e,t,r,i="client"){return r??=this.createSession({refreshToken:null}),await this._networkRetry(()=>this.sendClientRequestInner(e,t,r,i),r,i)}createSession(e){return new eT({refreshAccessTokenCallback:async e=>await this.fetchNewAccessToken(e),...e})}async sendClientRequestAndCatchKnownError(e,t,r,i){try{return s.Result.ok(await this.sendClientRequest(e,t,r))}catch(e){for(let t of i)if(t.isInstance(e))return s.Result.error(e);throw e}}async sendClientRequestInner(e,t,r,n){let a,o=await r.getOrFetchLikelyValidTokens(2e4),c="projectOwnerSession"in this.options?this.options.projectOwnerSession:null,l=c?await c.getOrFetchLikelyValidTokens(2e4):null;await this.options.prepareRequest?.();let u=this.getApiUrl()+e;u.endsWith("/")&&(u=u.slice(0,-1));let p={..."WebSocketPair"in tS.globalVar?{}:{credentials:"omit"},...t,headers:{"X-Stack-Override-Error-Status":"true","X-Stack-Project-Id":this.projectId,"X-Stack-Access-Type":n,"X-Stack-Client-Version":this.options.clientVersion,...o?{"X-Stack-Access-Token":o.accessToken.token}:{},...o?.refreshToken?{"X-Stack-Refresh-Token":o.refreshToken.token}:{},"X-Stack-Allow-Anonymous-User":"true",..."publishableClientKey"in this.options?{"X-Stack-Publishable-Client-Key":this.options.publishableClientKey}:{},...l?{"X-Stack-Admin-Access-Token":l.accessToken.token}:{},"X-Stack-Random-Nonce":(0,tC.generateSecureRandomString)(),"ngrok-skip-browser-warning":"true",...this.options.extraRequestHeaders,...t.headers},..."WebSocketPair"in tS.globalVar?{}:{cache:"no-store"}};try{a=await fetch(u,p)}catch(e){if(e instanceof TypeError)if(h.HTTP_METHODS[p.method??"GET"].idempotent)return s.Result.error(e);else throw await this._createNetworkError(e,r,n);throw e}let m=await this._processResponse(a);if("error"===m.status){if(i.KnownErrors.InvalidAccessToken.isInstance(m.error)){if(!o)throw new d.StackAssertionError("Received invalid access token, but session is not logged in",{tokenObj:o,processedRes:m});return r.markAccessTokenExpired(o.accessToken),s.Result.error(m.error)}if(c&&(i.KnownErrors.InvalidAdminAccessToken.isInstance(m.error)||i.KnownErrors.ApiKeyNotFound.isInstance(m.error))){if(!l)throw new d.StackAssertionError("Received invalid admin access token, but admin session is not logged in",{adminTokenObj:l,processedRes:m});return c.markAccessTokenExpired(l.accessToken),s.Result.error(m.error)}throw m.error}let f=Object.assign(m.data,{usedTokens:o});if(f.ok)return s.Result.ok(f);if(429===f.status){let e=f.headers.get("Retry-After");return null!==e?(console.log(`Rate limited while sending request to ${u}. Will retry after ${e} seconds...`),await (0,em.wait)(1e3*Number(e)),s.Result.error(Error(`Rate limited, retrying after ${e} seconds`))):(console.log(`Rate limited while sending request to ${u}, no retry-after header received. Retrying...`),s.Result.error(Error("Rate limited, no retry-after header received")))}{let t=await f.text(),r=new d.StackAssertionError(`Failed to send request to ${u}: ${f.status} ${t}`,{request:p,res:f,path:e});if(508===f.status&&t.includes("INFINITE_LOOP_DETECTED"))return s.Result.error(r);throw r}}async _processResponse(e){let t=e;if(e.headers.has("x-stack-actual-status")){let r=Number(e.headers.get("x-stack-actual-status"));t=new Response(e.body,{status:r,statusText:e.statusText,headers:e.headers})}if(t.headers.has("x-stack-known-error")){let e=await t.json();if(t.headers.get("x-stack-known-error")!==e.code)throw new d.StackAssertionError("Mismatch between x-stack-known-error header and error code in body; the server's response is invalid");let r=i.KnownError.fromJson(e);return s.Result.error(r)}return s.Result.ok(t)}async checkFeatureSupport(e){let t=await this.sendClientRequest("/check-feature-support",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},null);throw new d.StackAssertionError(await t.text())}async sendForgotPasswordEmail(e,t){let r=await this.sendClientRequestAndCatchKnownError("/auth/password/send-reset-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,callback_url:t})},null,[i.KnownErrors.UserNotFound]);return"error"===r.status?s.Result.error(r.error):s.Result.ok(void 0)}async sendVerificationEmail(e,t,r){let s=await this.sendClientRequestAndCatchKnownError("/contact-channels/send-verification-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,callback_url:t})},r,[i.KnownErrors.EmailAlreadyVerified]);if("error"===s.status)return s.error}async sendMagicLinkEmail(e,t){let r=await this.sendClientRequestAndCatchKnownError("/auth/otp/send-sign-in-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,callback_url:t})},null,[i.KnownErrors.RedirectUrlNotWhitelisted]);return"error"===r.status?s.Result.error(r.error):s.Result.ok(await r.data.json())}async resetPassword(e){let t=await this.sendClientRequestAndCatchKnownError("onlyVerifyCode"in e?"/auth/password/reset/check-code":"/auth/password/reset",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e.code,..."password"in e?{password:e.password}:{}})},null,[i.KnownErrors.VerificationCodeError]);return"error"===t.status?s.Result.error(t.error):s.Result.ok(void 0)}async updatePassword(e,t){let r=await this.sendClientRequestAndCatchKnownError("/auth/password/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({old_password:e.oldPassword,new_password:e.newPassword})},t,[i.KnownErrors.PasswordConfirmationMismatch,i.KnownErrors.PasswordRequirementsNotMet]);if("error"===r.status)return r.error}async setPassword(e,t){let r=await this.sendClientRequestAndCatchKnownError("/auth/password/set",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},t,[i.KnownErrors.PasswordRequirementsNotMet]);if("error"===r.status)return r.error}async verifyPasswordResetCode(e){let t=await this.resetPassword({code:e,onlyVerifyCode:!0});return"error"===t.status?s.Result.error(t.error):s.Result.ok(void 0)}async verifyEmail(e){let t=await this.sendClientRequestAndCatchKnownError("/contact-channels/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})},null,[i.KnownErrors.VerificationCodeError]);return"error"===t.status?s.Result.error(t.error):s.Result.ok(void 0)}async initiatePasskeyRegistration(e,t){let r=await this.sendClientRequestAndCatchKnownError("/auth/passkey/initiate-passkey-registration",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},t,[]);return"error"===r.status?s.Result.error(r.error):s.Result.ok(await r.data.json())}async registerPasskey(e,t){let r=await this.sendClientRequestAndCatchKnownError("/auth/passkey/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},t,[i.KnownErrors.PasskeyRegistrationFailed]);return"error"===r.status?s.Result.error(r.error):s.Result.ok(void 0)}async initiatePasskeyAuthentication(e,t){let r=await this.sendClientRequestAndCatchKnownError("/auth/passkey/initiate-passkey-authentication",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},t,[]);return"error"===r.status?s.Result.error(r.error):s.Result.ok(await r.data.json())}async sendTeamInvitation(e){await this.sendClientRequest("/team-invitations/send-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,team_id:e.teamId,callback_url:e.callbackUrl})},e.session)}async acceptTeamInvitation(e){let t=await this.sendClientRequestAndCatchKnownError("check"===e.type?"/team-invitations/accept/check-code":"details"===e.type?"/team-invitations/accept/details":"/team-invitations/accept",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e.code})},e.session,[i.KnownErrors.VerificationCodeError]);return"error"===t.status?s.Result.error(t.error):s.Result.ok(await t.data.json())}async totpMfa(e,t,r){let i=await this.sendClientRequest("/auth/mfa/sign-in",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e,type:"totp",totp:t})},r),s=await i.json();return{accessToken:s.access_token,refreshToken:s.refresh_token,newUser:s.is_new_user}}async signInWithCredential(e,t,r){let n=await this.sendClientRequestAndCatchKnownError("/auth/password/sign-in",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})},r,[i.KnownErrors.EmailPasswordMismatch]);if("error"===n.status)return s.Result.error(n.error);let a=await n.data.json();return s.Result.ok({accessToken:a.access_token,refreshToken:a.refresh_token})}async signUpWithCredential(e,t,r,n){let a=await this.sendClientRequestAndCatchKnownError("/auth/password/sign-up",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({email:e,password:t,verification_callback_url:r})},n,[i.KnownErrors.UserWithEmailAlreadyExists,i.KnownErrors.PasswordRequirementsNotMet]);if("error"===a.status)return s.Result.error(a.error);let o=await a.data.json();return s.Result.ok({accessToken:o.access_token,refreshToken:o.refresh_token})}async signUpAnonymously(e){let t=await this.sendClientRequestAndCatchKnownError("/auth/anonymous/sign-up",{method:"POST"},e,[]);if("error"===t.status)return s.Result.error(t.error);let r=await t.data.json();return s.Result.ok({accessToken:r.access_token,refreshToken:r.refresh_token})}async signInWithMagicLink(e,t){let r=await this.sendClientRequestAndCatchKnownError("/auth/otp/sign-in",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})},t,[i.KnownErrors.VerificationCodeError]);if("error"===r.status)return s.Result.error(r.error);let n=await r.data.json();return s.Result.ok({accessToken:n.access_token,refreshToken:n.refresh_token,newUser:n.is_new_user})}async signInWithMfa(e,t,r){let n=await this.sendClientRequestAndCatchKnownError("/auth/mfa/sign-in",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"totp",totp:e,code:t})},r,[i.KnownErrors.VerificationCodeError]);if("error"===n.status)return s.Result.error(n.error);let a=await n.data.json();return s.Result.ok({accessToken:a.access_token,refreshToken:a.refresh_token,newUser:a.is_new_user})}async signInWithPasskey(e,t){let r=await this.sendClientRequestAndCatchKnownError("/auth/passkey/sign-in",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},t,[i.KnownErrors.PasskeyAuthenticationFailed]);if("error"===r.status)return s.Result.error(r.error);let n=await r.data.json();return s.Result.ok({accessToken:n.access_token,refreshToken:n.refresh_token})}async getOAuthUrl(e){let t=new URL(e.redirectUrl);for(let e of["code","state"])t.searchParams.has(e)&&console.warn("Redirect URL already contains "+e+" parameter, removing it as it will be overwritten by the OAuth callback"),t.searchParams.delete(e);if(!("publishableClientKey"in this.options))throw Error("Admin session token is currently not supported for OAuth");let r=new URL(this.getApiUrl()+"/auth/oauth/authorize/"+e.provider.toLowerCase());r.searchParams.set("client_id",this.projectId),r.searchParams.set("client_secret",this.options.publishableClientKey),r.searchParams.set("redirect_uri",t.toString()),r.searchParams.set("scope","legacy"),r.searchParams.set("state",e.state),r.searchParams.set("grant_type","authorization_code"),r.searchParams.set("code_challenge",e.codeChallenge),r.searchParams.set("code_challenge_method","S256"),r.searchParams.set("response_type","code"),r.searchParams.set("type",e.type),r.searchParams.set("error_redirect_url",e.errorRedirectUrl);let i=await e.session.getOrFetchLikelyValidTokens(2e4);return i&&r.searchParams.set("token",i.accessToken.token),e.afterCallbackRedirectUrl&&r.searchParams.set("after_callback_redirect_url",e.afterCallbackRedirectUrl),e.providerScope&&r.searchParams.set("provider_scope",e.providerScope),r.toString()}async callOAuthCallback(e){if(!("publishableClientKey"in this.options))throw Error("Admin session token is currently not supported for OAuth");let t={issuer:this.options.getBaseUrl(),algorithm:"oauth2",token_endpoint:this.getApiUrl()+"/auth/oauth/token"},r={client_id:this.projectId,client_secret:this.options.publishableClientKey,token_endpoint_auth_method:"client_secret_post"},s=await this._networkRetryException(async()=>tk(t,r,e.oauthParams,e.state));if(e3(s))throw new d.StackAssertionError("Error validating outer OAuth response",{params:s});let n=await to(t,r,s,e.redirectUri,e.codeVerifier),a=await tu(t,r,n);if(e3(a)){if("code"in a&&"MULTI_FACTOR_AUTHENTICATION_REQUIRED"===a.code)throw new i.KnownErrors.MultiFactorAuthenticationRequired(a.details.attempt_code);throw new d.StackAssertionError("Outer OAuth error during authorization code response",{result:a})}return{newUser:a.is_new_user,afterCallbackRedirectUrl:a.after_callback_redirect_url,accessToken:a.access_token,refreshToken:a.refresh_token??(0,d.throwErr)("Refresh token not found in outer OAuth response")}}async signOut(e){if(await e.getOrFetchLikelyValidTokens(2e4)){let t=await this.sendClientRequestAndCatchKnownError("/auth/sessions/current",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({})},e,[i.KnownErrors.RefreshTokenError]);if("error"===t.status)if(i.KnownErrors.RefreshTokenError.isInstance(t.error));else throw new d.StackAssertionError("Unexpected error",{error:t.error})}e.markInvalid()}async getClientUserByToken(e){let t=await this.sendClientRequestAndCatchKnownError("/users/me",{},e,[i.KnownErrors.CannotGetOwnUserWithoutUser]);if("error"===t.status)if(i.KnownErrors.CannotGetOwnUserWithoutUser.isInstance(t.error))return null;else throw new d.StackAssertionError("Unexpected uncaught error",{cause:t.error});let r=t.data,s=await r.json();if(!s)throw new d.StackAssertionError("User endpoint returned null; this should never happen");return s}async listTeamInvitations(e,t){let r=await this.sendClientRequest("/team-invitations?"+new URLSearchParams({team_id:e.teamId}),{},t);return(await r.json()).items}async revokeTeamInvitation(e,t,r){await this.sendClientRequest(`/team-invitations/${e}?team_id=${t}`,{method:"DELETE"},r)}async listTeamMemberProfiles(e,t){let r=await this.sendClientRequest("/team-member-profiles?"+new URLSearchParams((0,m.filterUndefined)({team_id:e.teamId,user_id:e.userId})),{},t);return(await r.json()).items}async getTeamMemberProfile(e,t){let r=await this.sendClientRequest(`/team-member-profiles/${e.teamId}/${e.userId}`,{},t);return await r.json()}async leaveTeam(e,t){await this.sendClientRequest(`/team-memberships/${e}/me`,{method:"DELETE",headers:{"content-type":"application/json"},body:JSON.stringify({})},t)}async updateTeamMemberProfile(e,t){await this.sendClientRequest(`/team-member-profiles/${e.teamId}/${e.userId}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(e.profile)},t)}async updateTeam(e,t){await this.sendClientRequest(`/teams/${e.teamId}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(e.data)},t)}async listCurrentUserTeamPermissions(e,t){let r=await this.sendClientRequest(`/team-permissions?team_id=${e.teamId}&user_id=me&recursive=${e.recursive}`,{},t);return(await r.json()).items}async listCurrentUserProjectPermissions(e,t){let r=await this.sendClientRequest(`/project-permissions?user_id=me&recursive=${e.recursive}`,{},t);return(await r.json()).items}async listCurrentUserTeams(e){let t=await this.sendClientRequest("/teams?user_id=me",{},e);return(await t.json()).items}async getClientProject(){let e=await this.sendClientRequestAndCatchKnownError("/projects/current",{},null,[i.KnownErrors.ProjectNotFound]);if("error"===e.status)return s.Result.error(e.error);let t=e.data,r=await t.json();return s.Result.ok(r)}async updateClientUser(e,t){await this.sendClientRequest("/users/me",{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(e)},t)}async listProjects(e){let t=await this.sendClientRequest("/internal/projects",{},e);if(!t.ok)throw Error("Failed to list projects: "+t.status+" "+await t.text());return(await t.json()).items}async createProject(e,t){let r=await this.sendClientRequest("/internal/projects",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)},t);if(!r.ok)throw Error("Failed to create project: "+r.status+" "+await r.text());return await r.json()}async createProviderAccessToken(e,t,r){let i=await this.sendClientRequest(`/connected-accounts/me/${e}/access-token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({scope:t})},r);return await i.json()}async createClientTeam(e,t){let r=await this.sendClientRequest("/teams",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)},t);return await r.json()}async deleteTeam(e,t){await this.sendClientRequest(`/teams/${e}`,{method:"DELETE"},t)}async deleteCurrentUser(e){await this.sendClientRequest("/users/me",{method:"DELETE"},e)}async createClientContactChannel(e,t){let r=await this.sendClientRequest("/contact-channels",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)},t);return await r.json()}async updateClientContactChannel(e,t,r){let i=await this.sendClientRequest(`/contact-channels/me/${e}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(t)},r);return await i.json()}async deleteClientContactChannel(e,t){await this.sendClientRequest(`/contact-channels/me/${e}`,{method:"DELETE"},t)}async deleteSession(e,t){await this.sendClientRequest(`/auth/sessions/${e}?user_id=me`,{method:"DELETE"},t)}async listSessions(e){let t=await this.sendClientRequest("/auth/sessions?user_id=me",{method:"GET"},e);return await t.json()}async listClientContactChannels(e){let t=await this.sendClientRequest("/contact-channels?user_id=me",{method:"GET"},e);return(await t.json()).items}async sendCurrentUserContactChannelVerificationEmail(e,t,r){let n=await this.sendClientRequestAndCatchKnownError(`/contact-channels/me/${e}/send-verification-code`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({callback_url:t})},r,[i.KnownErrors.EmailAlreadyVerified]);return"error"===n.status?s.Result.error(n.error):s.Result.ok(void 0)}async cliLogin(e,t,r){let n=await this.sendClientRequestAndCatchKnownError("/auth/cli/complete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({login_code:e,refresh_token:t})},r,[i.KnownErrors.SchemaError]);return"error"===n.status?s.Result.error(n.error):s.Result.ok(void 0)}async _getApiKeyRequestInfo(e){if("user_id"in e&&"team_id"in e)throw new d.StackAssertionError("Cannot specify both user_id and team_id in _getApiKeyRequestInfo");return{endpoint:"team_id"in e?"/team-api-keys":"/user-api-keys",queryParams:new URLSearchParams((0,m.filterUndefinedOrNull)(e))}}async listProjectApiKeys(e,t,r){let i=("client"===r?this.sendClientRequest:this.sendServerRequest).bind(this),{endpoint:s,queryParams:n}=await this._getApiKeyRequestInfo(e),a=await i(`${s}?${n.toString()}`,{method:"GET"},t,r);return(await a.json()).items}async createProjectApiKey(e,t,r){let i=("client"===r?this.sendClientRequest:this.sendServerRequest).bind(this),{endpoint:s}=await this._getApiKeyRequestInfo(e),n=await i(`${s}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)},t,r);return await n.json()}async getProjectApiKey(e,t,r,i){let s=("client"===i?this.sendClientRequest:this.sendServerRequest).bind(this),{endpoint:n,queryParams:a}=await this._getApiKeyRequestInfo(e),o=await s(`${n}/${t}?${a.toString()}`,{method:"GET"},r,i);return await o.json()}async updateProjectApiKey(e,t,r,i,s){let n=("client"===s?this.sendClientRequest:this.sendServerRequest).bind(this),{endpoint:a,queryParams:o}=await this._getApiKeyRequestInfo(e),c=await n(`${a}/${t}?${o.toString()}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(r)},i,s);return await c.json()}async checkProjectApiKey(e,t,r,s){let n=("client"===s?this.sendClientRequestAndCatchKnownError:this.sendServerRequestAndCatchKnownError).bind(this),a=await n(`/${e}-api-keys/check`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({api_key:t})},r,[i.KnownErrors.ApiKeyNotValid]);return"error"===a.status?null:await a.data.json()}async listNotificationCategories(e){let t=await this.sendClientRequest("/emails/notification-preference/me",{},e);return(await t.json()).items}async setNotificationsEnabled(e,t,r){await this.sendClientRequest(`/emails/notification-preference/me/${e}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify({enabled:t})},r)}async getOAuthProvider(e,t,r){let i=await this.sendClientRequest(`/oauth-providers/${e}/${t}`,{method:"GET"},r);return await i.json()}async updateOAuthProvider(e,t,r,i){let s=await this.sendClientRequest(`/oauth-providers/${e}/${t}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(r)},i);return await s.json()}async listOAuthProviders(e={},t){let r=new URLSearchParams((0,m.filterUndefined)(e)),i=await this.sendClientRequest(`/oauth-providers${r.toString()?`?${r.toString()}`:""}`,{method:"GET"},t);return(await i.json()).items}async deleteOAuthProvider(e,t,r){let i=await this.sendClientRequest(`/oauth-providers/${e}/${t}`,{method:"DELETE"},r);return await i.json()}async getItem(e,t){let r,i;if("userId"in e)r="user",i=e.userId;else if("teamId"in e)r="team",i=e.teamId;else if("customCustomerId"in e)r="custom",i=e.customCustomerId;else throw new d.StackAssertionError("getItem requires one of userId, teamId, or customCustomerId");let s=await this.sendClientRequest(y.urlString`/payments/items/${r}/${i}/${e.itemId}`,{},t);return await s.json()}async listProducts(e,t){let r=new URLSearchParams((0,m.filterUndefined)({cursor:e.cursor,limit:void 0!==e.limit?e.limit.toString():void 0})),i=y.urlString`/payments/products/${e.customer_type}/${e.customer_id}`,s=await this.sendClientRequest(`${i}${r.toString()?`?${r.toString()}`:""}`,{},t);return await s.json()}async createCheckoutUrl(e,t,r,i,s){let n=await this.sendClientRequest("/payments/purchases/create-purchase-url",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({customer_type:e,customer_id:t,..."string"==typeof r?{product_id:r}:{inline_product:r},return_url:s})},i),{url:a}=await n.json();return a}async transferProject(e,t,r){if("internal"!==this.options.projectId)throw new d.StackAssertionError("StackClientInterface.transferProject() is only available for internal projects (please specify the project ID in the constructor)");await this.sendClientRequest("/internal/projects/transfer",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({project_id:t,new_team_id:r})},e)}},tE=class extends tb{constructor(e){super(e),this.options=e}async sendServerRequest(e,t,r,i="server"){return await this.sendClientRequest(e,{...t,headers:{"x-stack-secret-server-key":"secretServerKey"in this.options?this.options.secretServerKey:"",...t.headers}},r,i)}async sendServerRequestAndCatchKnownError(e,t,r,i){try{return s.Result.ok(await this.sendServerRequest(e,t,r))}catch(e){for(let t of i)if(t.isInstance(e))return s.Result.error(e);throw e}}async createServerUser(e){let t=await this.sendServerRequest("/users",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)},null);return await t.json()}async getServerUserByToken(e){let t=await this.sendServerRequestAndCatchKnownError("/users/me",{},e,[i.KnownErrors.CannotGetOwnUserWithoutUser]);if("error"===t.status)if(i.KnownErrors.CannotGetOwnUserWithoutUser.isInstance(t.error))return null;else throw new d.StackAssertionError("Unexpected uncaught error",{cause:t.error});let r=t.data,s=await r.json();if(!s)throw new d.StackAssertionError("User endpoint returned null; this should never happen");return s}async getServerUserById(e){let t=await this.sendServerRequestAndCatchKnownError(y.urlString`/users/${e}`,{},null,[i.KnownErrors.UserNotFound]);if("error"===t.status)return s.Result.error(t.error);let r=await t.data.json();return s.Result.ok(r)}async listServerTeamInvitations(e){let t=await this.sendServerRequest(y.urlString`/team-invitations?team_id=${e.teamId}`,{},null);return(await t.json()).items}async revokeServerTeamInvitation(e,t){await this.sendServerRequest(y.urlString`/team-invitations/${e}?team_id=${t}`,{method:"DELETE"},null)}async listServerTeamMemberProfiles(e){let t=await this.sendServerRequest(y.urlString`/team-member-profiles?team_id=${e.teamId}`,{},null);return(await t.json()).items}async getServerTeamMemberProfile(e){let t=await this.sendServerRequest(y.urlString`/team-member-profiles/${e.teamId}/${e.userId}`,{},null);return await t.json()}async listServerTeamPermissions(e,t){let r=await this.sendServerRequest(`/team-permissions?${new URLSearchParams((0,m.filterUndefined)({user_id:e.userId,team_id:e.teamId,recursive:e.recursive.toString()}))}`,{},t);return(await r.json()).items}async listServerProjectPermissions(e,t){let r=await this.sendServerRequest(`/project-permissions?${new URLSearchParams((0,m.filterUndefined)({user_id:e.userId,recursive:e.recursive.toString()}))}`,{},t);return(await r.json()).items}async listServerUsers(e){let t=new URLSearchParams((0,m.filterUndefined)({cursor:e.cursor,limit:e.limit?.toString(),desc:e.desc?.toString(),...e.orderBy?{order_by:({signedUpAt:"signed_up_at"})[e.orderBy]}:{},...e.query?{query:e.query}:{},...e.includeAnonymous?{include_anonymous:"true"}:{}})),r=await this.sendServerRequest("/users?"+t.toString(),{},null);return await r.json()}async listServerTeams(e){let t=await this.sendServerRequest(`/teams?${new URLSearchParams((0,m.filterUndefined)({user_id:e?.userId}))}`,{},null);return(await t.json()).items}async getServerTeam(e){let t=await this.sendServerRequest(`/teams/${e}`,{},null);return await t.json()}async listServerTeamUsers(e){let t=await this.sendServerRequest(`/users?team_id=${e}`,{},null);return(await t.json()).items}async createServerTeam(e){let t=await this.sendServerRequest("/teams",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)},null);return await t.json()}async updateServerTeam(e,t){let r=await this.sendServerRequest(y.urlString`/teams/${e}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(t)},null);return await r.json()}async deleteServerTeam(e){await this.sendServerRequest(y.urlString`/teams/${e}`,{method:"DELETE"},null)}async addServerUserToTeam(e){let t=await this.sendServerRequest(y.urlString`/team-memberships/${e.teamId}/${e.userId}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({})},null);return await t.json()}async removeServerUserFromTeam(e){await this.sendServerRequest(y.urlString`/team-memberships/${e.teamId}/${e.userId}`,{method:"DELETE",headers:{"content-type":"application/json"},body:JSON.stringify({})},null)}async updateServerUser(e,t){let r=await this.sendServerRequest(y.urlString`/users/${e}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(t)},null);return await r.json()}async createServerProviderAccessToken(e,t,r){let i=await this.sendServerRequest(y.urlString`/connected-accounts/${e}/${t}/access-token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({scope:r})},null);return await i.json()}async createServerUserSession(e,t,r){let i=await this.sendServerRequest("/auth/sessions",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({user_id:e,expires_in_millis:t,is_impersonation:r})},null),s=await i.json();return{accessToken:s.access_token,refreshToken:s.refresh_token}}async leaveServerTeam(e){await this.sendClientRequest(y.urlString`/team-memberships/${e.teamId}/${e.userId}`,{method:"DELETE",headers:{"content-type":"application/json"},body:JSON.stringify({})},null)}async updateServerTeamMemberProfile(e){await this.sendServerRequest(y.urlString`/team-member-profiles/${e.teamId}/${e.userId}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(e.profile)},null)}async grantServerTeamUserPermission(e,t,r){await this.sendServerRequest(y.urlString`/team-permissions/${e}/${t}/${r}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({})},null)}async grantServerProjectPermission(e,t){await this.sendServerRequest(y.urlString`/project-permissions/${e}/${t}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({})},null)}async revokeServerTeamUserPermission(e,t,r){await this.sendServerRequest(y.urlString`/team-permissions/${e}/${t}/${r}`,{method:"DELETE",headers:{"content-type":"application/json"},body:JSON.stringify({})},null)}async revokeServerProjectPermission(e,t){await this.sendServerRequest(y.urlString`/project-permissions/${e}/${t}`,{method:"DELETE",headers:{"content-type":"application/json"},body:JSON.stringify({})},null)}async deleteServerUser(e){await this.sendServerRequest(y.urlString`/users/${e}`,{method:"DELETE",headers:{"content-type":"application/json"},body:JSON.stringify({})},null)}async createServerContactChannel(e){let t=await this.sendServerRequest("/contact-channels",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)},null);return await t.json()}async updateServerContactChannel(e,t,r){let i=await this.sendServerRequest(y.urlString`/contact-channels/${e}/${t}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(r)},null);return await i.json()}async deleteServerContactChannel(e,t){await this.sendServerRequest(y.urlString`/contact-channels/${e}/${t}`,{method:"DELETE"},null)}async listServerContactChannels(e){let t=await this.sendServerRequest(y.urlString`/contact-channels?user_id=${e}`,{method:"GET"},null);return(await t.json()).items}async listServerNotificationCategories(e){let t=await this.sendServerRequest(y.urlString`/emails/notification-preference/${e}`,{method:"GET"},null);return(await t.json()).items}async setServerNotificationsEnabled(e,t,r){await this.sendServerRequest(y.urlString`/emails/notification-preference/${e}/${t}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify({enabled:r})},null)}async sendServerContactChannelVerificationEmail(e,t,r){await this.sendServerRequest(y.urlString`/contact-channels/${e}/${t}/send-verification-code`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({callback_url:r})},null)}async listServerSessions(e){let t=await this.sendServerRequest(y.urlString`/auth/sessions?user_id=${e}`,{method:"GET"},null);return await t.json()}async deleteServerSession(e){await this.sendServerRequest(y.urlString`/auth/sessions/${e}`,{method:"DELETE"},null)}async sendServerTeamInvitation(e){await this.sendServerRequest("/team-invitations/send-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,team_id:e.teamId,callback_url:e.callbackUrl})},null)}async updatePassword(e){let t=await this.sendServerRequestAndCatchKnownError("/auth/password/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({old_password:e.oldPassword,new_password:e.newPassword})},null,[i.KnownErrors.PasswordConfirmationMismatch,i.KnownErrors.PasswordRequirementsNotMet]);if("error"===t.status)return t.error}async createServerOAuthProvider(e){let t=await this.sendServerRequest("/oauth-providers",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)},null);return await t.json()}async listServerOAuthProviders(e={}){let t=new URLSearchParams((0,m.filterUndefined)(e)),r=await this.sendServerRequest(`/oauth-providers${t.toString()?`?${t.toString()}`:""}`,{method:"GET"},null);return(await r.json()).items}async updateServerOAuthProvider(e,t,r){let i=await this.sendServerRequest(y.urlString`/oauth-providers/${e}/${t}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(r)},null);return await i.json()}async deleteServerOAuthProvider(e,t){let r=await this.sendServerRequest(y.urlString`/oauth-providers/${e}/${t}`,{method:"DELETE"},null);return await r.json()}async sendEmail(e){return await this.sendServerRequest("/emails/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_ids:e.userIds,all_users:e.allUsers,theme_id:e.themeId,html:e.html,subject:e.subject,notification_category_name:e.notificationCategoryName,template_id:e.templateId,variables:e.variables,draft_id:e.draftId})},null),s.Result.ok(void 0)}async updateItemQuantity(e,t){let r,i,s=e.itemId;if("userId"in e)r="user",i=e.userId;else if("teamId"in e)r="team",i=e.teamId;else if("customCustomerId"in e)r="custom",i=e.customCustomerId;else throw new d.StackAssertionError("updateItemQuantity requires one of userId, teamId, or customCustomerId");let n=new URLSearchParams({allow_negative:(t.allow_negative??!1).toString()});await this.sendServerRequest(`/payments/items/${r}/${i}/${s}/update-quantity?${n.toString()}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({delta:t.delta,expires_at:t.expires_at,description:t.description})},null)}async grantProduct(e){if(!e.productId&&!e.product)throw new d.StackAssertionError("grantProduct requires either productId or product");if(e.productId&&e.product)throw new d.StackAssertionError("grantProduct should not receive both productId and product");let t=(0,m.filterUndefined)({product_id:e.productId,product_inline:e.product,quantity:e.quantity});await this.sendServerRequest(y.urlString`/payments/products/${e.customerType}/${e.customerId}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(t)},null)}async getDataVaultStoreValue(e,t,r){let s=await (0,n.hashKey)(e,r),a=await this.sendServerRequestAndCatchKnownError(`/data-vault/stores/${t}/get`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({hashed_key:s})},null,[i.KnownErrors.DataVaultStoreHashedKeyDoesNotExist]);if("error"===a.status)if(i.KnownErrors.DataVaultStoreHashedKeyDoesNotExist.isInstance(a.error))return null;else throw new d.StackAssertionError("Unexpected uncaught error",{cause:a.error});let o=(await a.data.json()).encrypted_value;if("string"!=typeof o)throw new d.StackAssertionError("encrypted_value is not a string",{type:typeof o});return await (0,n.decryptValue)(e,r,o)}async setDataVaultStoreValue(e,t,r,i){let s=await (0,n.hashKey)(e,r),a=await (0,n.encryptValue)(e,r,i);await this.sendServerRequest(`/data-vault/stores/${t}/set`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({hashed_key:s,encrypted_value:a})},null)}async initiateServerPasskeyRegistration(e){let{accessToken:t,refreshToken:r}=await this.createServerUserSession(e,6e4*2,!1),i=new eT({accessToken:t,refreshToken:r,refreshAccessTokenCallback:async()=>null});return await this.initiatePasskeyRegistration({},i)}},tA=class extends tE{constructor(e){super(e),this.options=e}async sendAdminRequest(e,t,r,i="admin"){return await this.sendServerRequest(e,{...t,headers:{"x-stack-super-secret-admin-key":"superSecretAdminKey"in this.options?this.options.superSecretAdminKey:"",...t.headers}},r,i)}async sendAdminRequestAndCatchKnownError(e,t,r,i){try{return s.Result.ok(await this.sendAdminRequest(e,t,r))}catch(e){for(let t of i)if(t.isInstance(e))return s.Result.error(e);throw e}}async getProject(){let e=await this.sendAdminRequest("/internal/projects/current",{method:"GET"},null);return await e.json()}async updateProject(e){let t=await this.sendAdminRequest("/internal/projects/current",{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(e)},null);return await t.json()}async createInternalApiKey(e){let t=await this.sendAdminRequest("/internal/api-keys",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)},null);return await t.json()}async listInternalApiKeys(){let e=await this.sendAdminRequest("/internal/api-keys",{},null);return(await e.json()).items}async revokeInternalApiKeyById(e){await this.sendAdminRequest(`/internal/api-keys/${e}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify({revoked:!0})},null)}async getInternalApiKey(e,t){let r=await this.sendAdminRequest(`/internal/api-keys/${e}`,{},t);return await r.json()}async listInternalEmailTemplates(){let e=await this.sendAdminRequest("/internal/email-templates",{},null);return(await e.json()).templates}async listInternalEmailDrafts(){let e=await this.sendAdminRequest("/internal/email-drafts",{},null);return(await e.json()).drafts}async createEmailDraft(e){let t=await this.sendAdminRequest("/internal/email-drafts",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)},null);return await t.json()}async updateEmailDraft(e,t){await this.sendAdminRequest(`/internal/email-drafts/${e}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(t)},null)}async listEmailThemes(){let e=await this.sendAdminRequest("/internal/email-themes",{},null);return(await e.json()).themes}async listTeamPermissionDefinitions(){let e=await this.sendAdminRequest("/team-permission-definitions",{},null);return(await e.json()).items}async createTeamPermissionDefinition(e){let t=await this.sendAdminRequest("/team-permission-definitions",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)},null);return await t.json()}async updateTeamPermissionDefinition(e,t){let r=await this.sendAdminRequest(`/team-permission-definitions/${e}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(t)},null);return await r.json()}async deleteTeamPermissionDefinition(e){await this.sendAdminRequest(`/team-permission-definitions/${e}`,{method:"DELETE"},null)}async listProjectPermissionDefinitions(){let e=await this.sendAdminRequest("/project-permission-definitions",{},null);return(await e.json()).items}async createProjectPermissionDefinition(e){let t=await this.sendAdminRequest("/project-permission-definitions",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)},null);return await t.json()}async updateProjectPermissionDefinition(e,t){let r=await this.sendAdminRequest(`/project-permission-definitions/${e}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(t)},null);return await r.json()}async deleteProjectPermissionDefinition(e){await this.sendAdminRequest(`/project-permission-definitions/${e}`,{method:"DELETE"},null)}async getSvixToken(){let e=await this.sendAdminRequest("/webhooks/svix-token",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({})},null);return await e.json()}async deleteProject(){await this.sendAdminRequest("/internal/projects/current",{method:"DELETE"},null)}async getMetrics(e=!1){let t=new URLSearchParams;e&&t.append("include_anonymous","true");let r=t.toString(),i=await this.sendAdminRequest(`/internal/metrics${r?`?${r}`:""}`,{method:"GET"},null);return await i.json()}async sendTestEmail(e){let t=await this.sendAdminRequest("/internal/send-test-email",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)},null);return await t.json()}async sendTestWebhook(e){let t=await this.sendAdminRequest("/internal/send-test-webhook",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)},null);return await t.json()}async listSentEmails(){let e=await this.sendAdminRequest("/internal/emails",{method:"GET"},null);return await e.json()}async sendSignInInvitationEmail(e,t){await this.sendAdminRequest("/internal/send-sign-in-invitation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,callback_url:t})},null)}async sendChatMessage(e,t,r,i){let s=await this.sendAdminRequest(`/internal/ai-chat/${e}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({context_type:t,messages:r}),signal:i},null);return await s.json()}async saveChatMessage(e,t){await this.sendAdminRequest(`/internal/ai-chat/${e}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify({message:t})},null)}async listChatMessages(e){let t=await this.sendAdminRequest(`/internal/ai-chat/${e}`,{method:"GET"},null);return await t.json()}async renderEmailPreview(e){let t=await this.sendAdminRequest("/emails/render-email",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({theme_id:e.themeId,theme_tsx_source:e.themeTsxSource,template_id:e.templateId,template_tsx_source:e.templateTsxSource})},null);return await t.json()}async createEmailTheme(e){let t=await this.sendAdminRequest("/internal/email-themes",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({display_name:e})},null);return await t.json()}async getEmailTheme(e){let t=await this.sendAdminRequest(`/internal/email-themes/${e}`,{method:"GET"},null);return await t.json()}async updateEmailTheme(e,t){await this.sendAdminRequest(`/internal/email-themes/${e}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify({tsx_source:t})},null)}async updateEmailTemplate(e,t,r){let i=await this.sendAdminRequest(`/internal/email-templates/${e}`,{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify({tsx_source:t,theme_id:r})},null);return await i.json()}async getConfig(){let e=await this.sendAdminRequest("/internal/config",{method:"GET"},null);return await e.json()}async updateConfig(e){let t=await this.sendAdminRequest("/internal/config/override",{method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify({config_override_string:JSON.stringify(e.configOverride)})},null);return await t.json()}async createEmailTemplate(e){let t=await this.sendAdminRequest("/internal/email-templates",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({display_name:e})},null);return await t.json()}async setupPayments(){let e=await this.sendAdminRequest("/internal/payments/setup",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({})},null);return await e.json()}async getStripeAccountInfo(){let e=await this.sendAdminRequestAndCatchKnownError("/internal/payments/stripe/account-info",{},null,[i.KnownErrors.StripeAccountInfoNotFound]);return"error"===e.status?null:await e.data.json()}async createStripeWidgetAccountSession(){let e=await this.sendAdminRequest("/internal/payments/stripe-widgets/account-session",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({})},null);return await e.json()}async listTransactions(e){let t=new URLSearchParams;e?.cursor&&t.set("cursor",e.cursor),"number"==typeof e?.limit&&t.set("limit",String(e.limit)),e?.type&&t.set("type",e.type),e?.customerType&&t.set("customer_type",e.customerType);let r=await this.sendAdminRequest(`/internal/payments/transactions${t.size?`?${t.toString()}`:""}`,{method:"GET"},null),i=await r.json();return{transactions:i.transactions,nextCursor:i.next_cursor}}}},934217,e=>{"use strict";function t(){return"undefined"!=typeof window&&"undefined"!=typeof document&&void 0!==document.createElement}e.i(91e3),e.i(717817),e.s(["isBrowserLike",()=>t])},732517,e=>{"use strict";var t=e.i(106772),r=e.i(934217),i=e.i(510835),s=e.i(717817),n=new WeakMap;function a(e){if("use"in t.default)return t.default.use(e);if(n.has(e)){let t=n.get(e);if("pending"===t.status)throw e;if("ok"===t.status)return t.data;throw t.error}throw n.set(e,{status:"pending",progress:void 0}),(0,i.runAsynchronously)(async()=>{try{let t=await e;n.set(e,{status:"ok",data:t})}catch(t){n.set(e,{status:"error",error:t})}}),e}function o(e){return 19>parseInt(t.default.version.split(".")[0])?t.default.forwardRef(e):t=>e(t,t.ref)}function c(){throw a((0,i.neverResolve)()),Error("Somehow a Promise that never resolves was resolved?")}var l=class extends Error{constructor(e){super(s.deindent`
      Suspense boundary not found! Read the error message below carefully on how to fix it.

      ${e.caller??"This code path"} attempted to display a loading indicator, but didn't find a Suspense boundary above it. Please read the error message below carefully.
      
      The fix depends on which of the 4 scenarios caused it:
      
      1. [Next.js] You are missing a loading.tsx file in your app directory. Fix it by adding a loading.tsx file in your app directory.

      2. [React] You are missing a <Suspense> boundary in your component. Fix it by wrapping your component (or the entire app) in a <Suspense> component.

      3. [Next.js] The component is rendered in the root (outermost) layout.tsx or template.tsx file. Next.js does not wrap those files in a Suspense boundary, even if there is a loading.tsx file in the same folder. To fix it, wrap your layout inside a route group like this:

        - app
        - - layout.tsx  // contains <html> and <body>, alongside providers and other components that don't need ${e.caller??"this code path"}
        - - loading.tsx  // required for suspense
        - - (main)
        - - - layout.tsx  // contains the main layout of your app, like a sidebar or a header, and can use ${e.caller??"this code path"}
        - - - route.tsx  // your actual main page
        - - - the rest of your app

        For more information on this approach, see Next's documentation on route groups: https://nextjs.org/docs/app/building-your-application/routing/route-groups
      
      4. You caught this error with try-catch or a custom error boundary. Fix this by rethrowing the error or not catching it in the first place.

      See: https://nextjs.org/docs/messages/missing-suspense-with-csr-bailout

      More information on SSR and Suspense boundaries: https://react.dev/reference/react/Suspense#providing-a-fallback-for-server-errors-and-client-only-content
    `),this.name="NoSuspenseBoundaryError",this.reason=e.caller??"suspendIfSsr()",this.digest="BAILOUT_TO_CLIENT_SIDE_RENDERING"}};function u(e){if(!(0,r.isBrowserLike)())throw new l({caller:e})}e.s(["forwardRefIfNeeded",()=>o,"suspend",()=>c,"suspendIfSsr",()=>u,"use",()=>a])},502627,(e,t,r)=>{"use strict";r.parse=function(e,t){if("string"!=typeof e)throw TypeError("argument str must be a string");for(var r={},i=(t||{}).decode||n,s=0;s<e.length;){var a=e.indexOf("=",s);if(-1===a)break;var o=e.indexOf(";",s);if(-1===o)o=e.length;else if(o<a){s=e.lastIndexOf(";",a-1)+1;continue}var c=e.slice(s,a).trim();if(void 0===r[c]){var l=e.slice(a+1,o).trim();34===l.charCodeAt(0)&&(l=l.slice(1,-1)),r[c]=function(e,t){try{return t(e)}catch(t){return e}}(l,i)}s=o+1}return r},r.serialize=function(e,t,r){var n=r||{},o=n.encode||a;if("function"!=typeof o)throw TypeError("option encode is invalid");if(!s.test(e))throw TypeError("argument name is invalid");var c=o(t);if(c&&!s.test(c))throw TypeError("argument val is invalid");var l=e+"="+c;if(null!=n.maxAge){var u=n.maxAge-0;if(isNaN(u)||!isFinite(u))throw TypeError("option maxAge is invalid");l+="; Max-Age="+Math.floor(u)}if(n.domain){if(!s.test(n.domain))throw TypeError("option domain is invalid");l+="; Domain="+n.domain}if(n.path){if(!s.test(n.path))throw TypeError("option path is invalid");l+="; Path="+n.path}if(n.expires){var d,h=n.expires;if(d=h,"[object Date]"!==i.call(d)&&!(d instanceof Date)||isNaN(h.valueOf()))throw TypeError("option expires is invalid");l+="; Expires="+h.toUTCString()}if(n.httpOnly&&(l+="; HttpOnly"),n.secure&&(l+="; Secure"),n.partitioned&&(l+="; Partitioned"),n.priority)switch("string"==typeof n.priority?n.priority.toLowerCase():n.priority){case"low":l+="; Priority=Low";break;case"medium":l+="; Priority=Medium";break;case"high":l+="; Priority=High";break;default:throw TypeError("option priority is invalid")}if(n.sameSite)switch("string"==typeof n.sameSite?n.sameSite.toLowerCase():n.sameSite){case!0:case"strict":l+="; SameSite=Strict";break;case"lax":l+="; SameSite=Lax";break;case"none":l+="; SameSite=None";break;default:throw TypeError("option sameSite is invalid")}return l};var i=Object.prototype.toString,s=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function n(e){return -1!==e.indexOf("%")?decodeURIComponent(e):e}function a(e){return encodeURIComponent(e)}},40397,(e,t,r)=>{"use strict";var i=Object.defineProperty,s=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,a=Object.prototype.hasOwnProperty,o={},c={RequestCookies:()=>f,ResponseCookies:()=>y,parseCookie:()=>d,parseSetCookie:()=>h,stringifyCookie:()=>u};for(var l in c)i(o,l,{get:c[l],enumerable:!0});function u(e){var t;let r=["path"in e&&e.path&&`Path=${e.path}`,"expires"in e&&(e.expires||0===e.expires)&&`Expires=${("number"==typeof e.expires?new Date(e.expires):e.expires).toUTCString()}`,"maxAge"in e&&"number"==typeof e.maxAge&&`Max-Age=${e.maxAge}`,"domain"in e&&e.domain&&`Domain=${e.domain}`,"secure"in e&&e.secure&&"Secure","httpOnly"in e&&e.httpOnly&&"HttpOnly","sameSite"in e&&e.sameSite&&`SameSite=${e.sameSite}`,"partitioned"in e&&e.partitioned&&"Partitioned","priority"in e&&e.priority&&`Priority=${e.priority}`].filter(Boolean),i=`${e.name}=${encodeURIComponent(null!=(t=e.value)?t:"")}`;return 0===r.length?i:`${i}; ${r.join("; ")}`}function d(e){let t=new Map;for(let r of e.split(/; */)){if(!r)continue;let e=r.indexOf("=");if(-1===e){t.set(r,"true");continue}let[i,s]=[r.slice(0,e),r.slice(e+1)];try{t.set(i,decodeURIComponent(null!=s?s:"true"))}catch{}}return t}function h(e){if(!e)return;let[[t,r],...i]=d(e),{domain:s,expires:n,httponly:a,maxage:o,path:c,samesite:l,secure:u,partitioned:h,priority:f}=Object.fromEntries(i.map(([e,t])=>[e.toLowerCase().replace(/-/g,""),t]));{var y,_,w={name:t,value:decodeURIComponent(r),domain:s,...n&&{expires:new Date(n)},...a&&{httpOnly:!0},..."string"==typeof o&&{maxAge:Number(o)},path:c,...l&&{sameSite:p.includes(y=(y=l).toLowerCase())?y:void 0},...u&&{secure:!0},...f&&{priority:m.includes(_=(_=f).toLowerCase())?_:void 0},...h&&{partitioned:!0}};let e={};for(let t in w)w[t]&&(e[t]=w[t]);return e}}t.exports=((e,t,r,o)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let c of n(t))a.call(e,c)||c===r||i(e,c,{get:()=>t[c],enumerable:!(o=s(t,c))||o.enumerable});return e})(i({},"__esModule",{value:!0}),o);var p=["strict","lax","none"],m=["low","medium","high"],f=class{constructor(e){this._parsed=new Map,this._headers=e;const t=e.get("cookie");if(t)for(const[e,r]of d(t))this._parsed.set(e,{name:e,value:r})}[Symbol.iterator](){return this._parsed[Symbol.iterator]()}get size(){return this._parsed.size}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let r=Array.from(this._parsed);if(!e.length)return r.map(([e,t])=>t);let i="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return r.filter(([e])=>e===i).map(([e,t])=>t)}has(e){return this._parsed.has(e)}set(...e){let[t,r]=1===e.length?[e[0].name,e[0].value]:e,i=this._parsed;return i.set(t,{name:t,value:r}),this._headers.set("cookie",Array.from(i).map(([e,t])=>u(t)).join("; ")),this}delete(e){let t=this._parsed,r=Array.isArray(e)?e.map(e=>t.delete(e)):t.delete(e);return this._headers.set("cookie",Array.from(t).map(([e,t])=>u(t)).join("; ")),r}clear(){return this.delete(Array.from(this._parsed.keys())),this}[Symbol.for("edge-runtime.inspect.custom")](){return`RequestCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(e=>`${e.name}=${encodeURIComponent(e.value)}`).join("; ")}},y=class{constructor(e){var t,r,i;this._parsed=new Map,this._headers=e;const s=null!=(i=null!=(r=null==(t=e.getSetCookie)?void 0:t.call(e))?r:e.get("set-cookie"))?i:[];for(const e of Array.isArray(s)?s:function(e){if(!e)return[];var t,r,i,s,n,a=[],o=0;function c(){for(;o<e.length&&/\s/.test(e.charAt(o));)o+=1;return o<e.length}for(;o<e.length;){for(t=o,n=!1;c();)if(","===(r=e.charAt(o))){for(i=o,o+=1,c(),s=o;o<e.length&&"="!==(r=e.charAt(o))&&";"!==r&&","!==r;)o+=1;o<e.length&&"="===e.charAt(o)?(n=!0,o=s,a.push(e.substring(t,i)),t=o):o=i+1}else o+=1;(!n||o>=e.length)&&a.push(e.substring(t,e.length))}return a}(s)){const t=h(e);t&&this._parsed.set(t.name,t)}}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let r=Array.from(this._parsed.values());if(!e.length)return r;let i="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return r.filter(e=>e.name===i)}has(e){return this._parsed.has(e)}set(...e){let[t,r,i]=1===e.length?[e[0].name,e[0].value,e[0]]:e,s=this._parsed;return s.set(t,function(e={name:"",value:""}){return"number"==typeof e.expires&&(e.expires=new Date(e.expires)),e.maxAge&&(e.expires=new Date(Date.now()+1e3*e.maxAge)),(null===e.path||void 0===e.path)&&(e.path="/"),e}({name:t,value:r,...i})),function(e,t){for(let[,r]of(t.delete("set-cookie"),e)){let e=u(r);t.append("set-cookie",e)}}(s,this._headers),this}delete(...e){let[t,r]="string"==typeof e[0]?[e[0]]:[e[0].name,e[0]];return this.set({...r,name:t,value:"",expires:new Date(0)})}[Symbol.for("edge-runtime.inspect.custom")](){return`ResponseCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(u).join("; ")}}},247548,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i={RequestCookies:function(){return n.RequestCookies},ResponseCookies:function(){return n.ResponseCookies},stringifyCookie:function(){return n.stringifyCookie}};for(var s in i)Object.defineProperty(r,s,{enumerable:!0,get:i[s]});let n=e.r(40397)},80442,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i={MutableRequestCookiesAdapter:function(){return p},ReadonlyRequestCookiesError:function(){return c},RequestCookiesAdapter:function(){return l},appendMutableCookies:function(){return h},areCookiesMutableInCurrentPhase:function(){return f},createCookiesWithMutableAccessCheck:function(){return m},getModifiedCookieValues:function(){return d},responseCookiesToRequestCookies:function(){return _}};for(var s in i)Object.defineProperty(r,s,{enumerable:!0,get:i[s]});let n=e.r(247548),a=e.r(320854),o=e.r(583701);class c extends Error{constructor(){super("Cookies can only be modified in a Server Action or Route Handler. Read more: https://nextjs.org/docs/app/api-reference/functions/cookies#options")}static callable(){throw new c}}class l{static seal(e){return new Proxy(e,{get(e,t,r){switch(t){case"clear":case"delete":case"set":return c.callable;default:return a.ReflectAdapter.get(e,t,r)}}})}}let u=Symbol.for("next.mutated.cookies");function d(e){let t=e[u];return t&&Array.isArray(t)&&0!==t.length?t:[]}function h(e,t){let r=d(t);if(0===r.length)return!1;let i=new n.ResponseCookies(e),s=i.getAll();for(let e of r)i.set(e);for(let e of s)i.set(e);return!0}class p{static wrap(e,t){let r=new n.ResponseCookies(new Headers);for(let t of e.getAll())r.set(t);let i=[],s=new Set,c=()=>{let e=o.workAsyncStorage.getStore();if(e&&(e.pathWasRevalidated=!0),i=r.getAll().filter(e=>s.has(e.name)),t){let e=[];for(let t of i){let r=new n.ResponseCookies(new Headers);r.set(t),e.push(r.toString())}t(e)}},l=new Proxy(r,{get(e,t,r){switch(t){case u:return i;case"delete":return function(...t){s.add("string"==typeof t[0]?t[0]:t[0].name);try{return e.delete(...t),l}finally{c()}};case"set":return function(...t){s.add("string"==typeof t[0]?t[0]:t[0].name);try{return e.set(...t),l}finally{c()}};default:return a.ReflectAdapter.get(e,t,r)}}});return l}}function m(e){let t=new Proxy(e.mutableCookies,{get(r,i,s){switch(i){case"delete":return function(...i){return y(e,"cookies().delete"),r.delete(...i),t};case"set":return function(...i){return y(e,"cookies().set"),r.set(...i),t};default:return a.ReflectAdapter.get(r,i,s)}}});return t}function f(e){return"action"===e.phase}function y(e,t){if(!f(e))throw new c}function _(e){let t=new n.RequestCookies(new Headers);for(let r of e.getAll())t.set(r);return t}},729427,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"cookies",{enumerable:!0,get:function(){return p}});let i=e.r(80442),s=e.r(247548),n=e.r(583701),a=e.r(854150),o=e.r(782320),c=e.r(646895),l=e.r(864872),u=e.r(763706),d=e.r(286457),h=e.r(210170);function p(){let e="cookies",t=n.workAsyncStorage.getStore(),r=a.workUnitAsyncStorage.getStore();if(t){if(r&&"after"===r.phase&&!(0,d.isRequestAPICallableInsideAfter)())throw Object.defineProperty(Error(`Route ${t.route} used \`cookies()\` inside \`after()\`. This is not supported. If you need this data inside an \`after()\` callback, use \`cookies()\` outside of the callback. See more info here: https://nextjs.org/docs/canary/app/api-reference/functions/after`),"__NEXT_ERROR_CODE",{value:"E843",enumerable:!1,configurable:!0});if(t.forceStatic)return f(i.RequestCookiesAdapter.seal(new s.RequestCookies(new Headers({}))));if(t.dynamicShouldError)throw Object.defineProperty(new c.StaticGenBailoutError(`Route ${t.route} with \`dynamic = "error"\` couldn't be rendered statically because it used \`cookies()\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E849",enumerable:!1,configurable:!0});if(r)switch(r.type){case"cache":let n=Object.defineProperty(Error(`Route ${t.route} used \`cookies()\` inside "use cache". Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use \`cookies()\` outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/messages/next-request-in-use-cache`),"__NEXT_ERROR_CODE",{value:"E831",enumerable:!1,configurable:!0});throw Error.captureStackTrace(n,p),t.invalidDynamicUsageError??=n,n;case"unstable-cache":throw Object.defineProperty(Error(`Route ${t.route} used \`cookies()\` inside a function cached with \`unstable_cache()\`. Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use \`cookies()\` outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/app/api-reference/functions/unstable_cache`),"__NEXT_ERROR_CODE",{value:"E846",enumerable:!1,configurable:!0});case"prerender":var u=t,y=r;let a=m.get(y);if(a)return a;let _=(0,l.makeHangingPromise)(y.renderSignal,u.route,"`cookies()`");return m.set(y,_),_;case"prerender-client":let w="`cookies`";throw Object.defineProperty(new h.InvariantError(`${w} must not be used within a Client Component. Next.js should be preventing ${w} from being included in Client Components statically, but did not in this case.`),"__NEXT_ERROR_CODE",{value:"E832",enumerable:!1,configurable:!0});case"prerender-ppr":return(0,o.postponeWithTracking)(t.route,e,r.dynamicTracking);case"prerender-legacy":return(0,o.throwToInterruptStaticGeneration)(e,t,r);case"prerender-runtime":return(0,o.delayUntilRuntimeStage)(r,f(r.cookies));case"private-cache":return f(r.cookies);case"request":return(0,o.trackDynamicDataInDynamicRender)(r),f((0,i.areCookiesMutableInCurrentPhase)(r)?r.userspaceMutableCookies:r.cookies)}}(0,a.throwForMissingRequestStore)(e)}e.r(884450);let m=new WeakMap;function f(e){let t=m.get(e);if(t)return t;let r=Promise.resolve(e);return m.set(e,r),r}(0,u.createDedupedByCallsiteServerErrorLoggerDev)(function(e,t){let r=e?`Route "${e}" `:"This route ";return Object.defineProperty(Error(`${r}used ${t}. \`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`),"__NEXT_ERROR_CODE",{value:"E830",enumerable:!1,configurable:!0})})},16282,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i={HeadersAdapter:function(){return o},ReadonlyHeadersError:function(){return a}};for(var s in i)Object.defineProperty(r,s,{enumerable:!0,get:i[s]});let n=e.r(320854);class a extends Error{constructor(){super("Headers cannot be modified. Read more: https://nextjs.org/docs/app/api-reference/functions/headers")}static callable(){throw new a}}class o extends Headers{constructor(e){super(),this.headers=new Proxy(e,{get(t,r,i){if("symbol"==typeof r)return n.ReflectAdapter.get(t,r,i);let s=r.toLowerCase(),a=Object.keys(e).find(e=>e.toLowerCase()===s);if(void 0!==a)return n.ReflectAdapter.get(t,a,i)},set(t,r,i,s){if("symbol"==typeof r)return n.ReflectAdapter.set(t,r,i,s);let a=r.toLowerCase(),o=Object.keys(e).find(e=>e.toLowerCase()===a);return n.ReflectAdapter.set(t,o??r,i,s)},has(t,r){if("symbol"==typeof r)return n.ReflectAdapter.has(t,r);let i=r.toLowerCase(),s=Object.keys(e).find(e=>e.toLowerCase()===i);return void 0!==s&&n.ReflectAdapter.has(t,s)},deleteProperty(t,r){if("symbol"==typeof r)return n.ReflectAdapter.deleteProperty(t,r);let i=r.toLowerCase(),s=Object.keys(e).find(e=>e.toLowerCase()===i);return void 0===s||n.ReflectAdapter.deleteProperty(t,s)}})}static seal(e){return new Proxy(e,{get(e,t,r){switch(t){case"append":case"delete":case"set":return a.callable;default:return n.ReflectAdapter.get(e,t,r)}}})}merge(e){return Array.isArray(e)?e.join(", "):e}static from(e){return e instanceof Headers?e:new o(e)}append(e,t){let r=this.headers[e];"string"==typeof r?this.headers[e]=[r,t]:Array.isArray(r)?r.push(t):this.headers[e]=t}delete(e){delete this.headers[e]}get(e){let t=this.headers[e];return void 0!==t?this.merge(t):null}has(e){return void 0!==this.headers[e]}set(e,t){this.headers[e]=t}forEach(e,t){for(let[r,i]of this.entries())e.call(t,i,r,this)}*entries(){for(let e of Object.keys(this.headers)){let t=e.toLowerCase(),r=this.get(t);yield[t,r]}}*keys(){for(let e of Object.keys(this.headers)){let t=e.toLowerCase();yield t}}*values(){for(let e of Object.keys(this.headers)){let t=this.get(e);yield t}}[Symbol.iterator](){return this.entries()}}},235087,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"headers",{enumerable:!0,get:function(){return h}});let i=e.r(16282),s=e.r(583701),n=e.r(854150),a=e.r(782320),o=e.r(646895),c=e.r(864872),l=e.r(763706),u=e.r(286457),d=e.r(210170);function h(){let e="headers",t=s.workAsyncStorage.getStore(),r=n.workUnitAsyncStorage.getStore();if(t){if(r&&"after"===r.phase&&!(0,u.isRequestAPICallableInsideAfter)())throw Object.defineProperty(Error(`Route ${t.route} used \`headers()\` inside \`after()\`. This is not supported. If you need this data inside an \`after()\` callback, use \`headers()\` outside of the callback. See more info here: https://nextjs.org/docs/canary/app/api-reference/functions/after`),"__NEXT_ERROR_CODE",{value:"E839",enumerable:!1,configurable:!0});if(t.forceStatic)return m(i.HeadersAdapter.seal(new Headers({})));if(r)switch(r.type){case"cache":{let e=Object.defineProperty(Error(`Route ${t.route} used \`headers()\` inside "use cache". Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use \`headers()\` outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/messages/next-request-in-use-cache`),"__NEXT_ERROR_CODE",{value:"E833",enumerable:!1,configurable:!0});throw Error.captureStackTrace(e,h),t.invalidDynamicUsageError??=e,e}case"unstable-cache":throw Object.defineProperty(Error(`Route ${t.route} used \`headers()\` inside a function cached with \`unstable_cache()\`. Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use \`headers()\` outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/app/api-reference/functions/unstable_cache`),"__NEXT_ERROR_CODE",{value:"E838",enumerable:!1,configurable:!0})}if(t.dynamicShouldError)throw Object.defineProperty(new o.StaticGenBailoutError(`Route ${t.route} with \`dynamic = "error"\` couldn't be rendered statically because it used \`headers()\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E828",enumerable:!1,configurable:!0});if(r)switch(r.type){case"prerender":var l=t,f=r;let s=p.get(f);if(s)return s;let n=(0,c.makeHangingPromise)(f.renderSignal,l.route,"`headers()`");return p.set(f,n),n;case"prerender-client":let y="`headers`";throw Object.defineProperty(new d.InvariantError(`${y} must not be used within a client component. Next.js should be preventing ${y} from being included in client components statically, but did not in this case.`),"__NEXT_ERROR_CODE",{value:"E693",enumerable:!1,configurable:!0});case"prerender-ppr":return(0,a.postponeWithTracking)(t.route,e,r.dynamicTracking);case"prerender-legacy":return(0,a.throwToInterruptStaticGeneration)(e,t,r);case"prerender-runtime":return(0,a.delayUntilRuntimeStage)(r,m(r.headers));case"private-cache":return m(r.headers);case"request":return(0,a.trackDynamicDataInDynamicRender)(r),m(r.headers)}}(0,n.throwForMissingRequestStore)(e)}e.r(884450);let p=new WeakMap;function m(e){let t=p.get(e);if(t)return t;let r=Promise.resolve(e);return p.set(e,r),r}(0,l.createDedupedByCallsiteServerErrorLoggerDev)(function(e,t){let r=e?`Route "${e}" `:"This route ";return Object.defineProperty(Error(`${r}used ${t}. \`headers()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`),"__NEXT_ERROR_CODE",{value:"E836",enumerable:!1,configurable:!0})})},689911,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"draftMode",{enumerable:!0,get:function(){return u}});let i=e.r(854150),s=e.r(583701),n=e.r(782320),a=e.r(763706),o=e.r(646895),c=e.r(77759),l=e.r(210170);function u(){let e=s.workAsyncStorage.getStore(),t=i.workUnitAsyncStorage.getStore();switch((!e||!t)&&(0,i.throwForMissingRequestStore)("draftMode"),t.type){case"prerender-runtime":return(0,n.delayUntilRuntimeStage)(t,d(t.draftMode,e));case"request":return d(t.draftMode,e);case"cache":case"private-cache":case"unstable-cache":let r=(0,i.getDraftModeProviderForCacheScope)(e,t);if(r)return d(r,e);case"prerender":case"prerender-client":case"prerender-ppr":case"prerender-legacy":return d(null,e);default:return t}}function d(e,t){let r=p.get(e??h);return r||Promise.resolve(new m(e))}e.r(320854);let h={},p=new WeakMap;class m{constructor(e){this._provider=e}get isEnabled(){return null!==this._provider&&this._provider.isEnabled}enable(){f("draftMode().enable()",this.enable),null!==this._provider&&this._provider.enable()}disable(){f("draftMode().disable()",this.disable),null!==this._provider&&this._provider.disable()}}function f(e,t){let r=s.workAsyncStorage.getStore(),a=i.workUnitAsyncStorage.getStore();if(r){if((null==a?void 0:a.phase)==="after")throw Object.defineProperty(Error(`Route ${r.route} used "${e}" inside \`after()\`. The enabled status of \`draftMode()\` can be read inside \`after()\` but you cannot enable or disable \`draftMode()\`. See more info here: https://nextjs.org/docs/app/api-reference/functions/after`),"__NEXT_ERROR_CODE",{value:"E845",enumerable:!1,configurable:!0});if(r.dynamicShouldError)throw Object.defineProperty(new o.StaticGenBailoutError(`Route ${r.route} with \`dynamic = "error"\` couldn't be rendered statically because it used \`${e}\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E553",enumerable:!1,configurable:!0});if(a)switch(a.type){case"cache":case"private-cache":{let i=Object.defineProperty(Error(`Route ${r.route} used "${e}" inside "use cache". The enabled status of \`draftMode()\` can be read in caches but you must not enable or disable \`draftMode()\` inside a cache. See more info here: https://nextjs.org/docs/messages/next-request-in-use-cache`),"__NEXT_ERROR_CODE",{value:"E829",enumerable:!1,configurable:!0});throw Error.captureStackTrace(i,t),r.invalidDynamicUsageError??=i,i}case"unstable-cache":throw Object.defineProperty(Error(`Route ${r.route} used "${e}" inside a function cached with \`unstable_cache()\`. The enabled status of \`draftMode()\` can be read in caches but you must not enable or disable \`draftMode()\` inside a cache. See more info here: https://nextjs.org/docs/app/api-reference/functions/unstable_cache`),"__NEXT_ERROR_CODE",{value:"E844",enumerable:!1,configurable:!0});case"prerender":case"prerender-runtime":{let t=Object.defineProperty(Error(`Route ${r.route} used ${e} without first calling \`await connection()\`. See more info here: https://nextjs.org/docs/messages/next-prerender-sync-headers`),"__NEXT_ERROR_CODE",{value:"E126",enumerable:!1,configurable:!0});return(0,n.abortAndThrowOnSynchronousRequestDataAccess)(r.route,e,t,a)}case"prerender-client":let i="`draftMode`";throw Object.defineProperty(new l.InvariantError(`${i} must not be used within a Client Component. Next.js should be preventing ${i} from being included in Client Components statically, but did not in this case.`),"__NEXT_ERROR_CODE",{value:"E832",enumerable:!1,configurable:!0});case"prerender-ppr":return(0,n.postponeWithTracking)(r.route,e,a.dynamicTracking);case"prerender-legacy":a.revalidate=0;let s=Object.defineProperty(new c.DynamicServerError(`Route ${r.route} couldn't be rendered statically because it used \`${e}\`. See more info here: https://nextjs.org/docs/messages/dynamic-server-error`),"__NEXT_ERROR_CODE",{value:"E558",enumerable:!1,configurable:!0});throw r.dynamicUsageDescription=e,r.dynamicUsageStack=s.stack,s;case"request":(0,n.trackDynamicDataInDynamicRender)(a)}}}(0,a.createDedupedByCallsiteServerErrorLoggerDev)(function(e,t){let r=e?`Route "${e}" `:"This route ";return Object.defineProperty(Error(`${r}used ${t}. \`draftMode()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`),"__NEXT_ERROR_CODE",{value:"E835",enumerable:!1,configurable:!0})})},894736,(e,t,r)=>{t.exports.cookies=e.r(729427).cookies,t.exports.headers=e.r(235087).headers,t.exports.draftMode=e.r(689911).draftMode},833277,e=>{"use strict";var t=e.i(662790),r=e.i(722777),i=e.i(106772);let s=(0,i.createContext)(void 0);function n({children:e}){let i=(0,r.useUser)();return(0,t.jsx)(s.Provider,{value:i,children:e})}function a({children:e}){return(0,t.jsx)(i.Suspense,{fallback:null,children:(0,t.jsx)(n,{children:e})})}function o(){let e=(0,i.useContext)(s);if(void 0===e)throw Error("useUserContext must be used within a UserProvider");return e}e.s(["UserProvider",()=>a,"useUserContext",()=>o])},948247,e=>{"use strict";var t=e.i(106772),r=e.i(291967),i=e.i(430406),s=e.i(79014),n=e.i(393136),a=e.i(122925),o=e.i(670465),c=e.i(695587),l=e.i(255235),u=e.i(254440),d=e.i(31007),h=e.i(315599),p=e.i(306839),m=e.i(214260),f=e.i(111052),y=e.i(913075),_=e.i(665489),w=e.i(938657),g=e.i(73772),v=e.i(97496),T=e.i(662790),k=["Enter"," "],C=["ArrowUp","PageDown","End"],S=["ArrowDown","PageUp","Home",...C],b={ltr:[...k,"ArrowRight"],rtl:[...k,"ArrowLeft"]},E={ltr:["ArrowLeft"],rtl:["ArrowRight"]},A="Menu",[I,R,O]=(0,o.createCollection)(A),[P,x]=(0,s.createContextScope)(A,[O,p.createPopperScope,y.createRovingFocusGroupScope]),j=(0,p.createPopperScope)(),U=(0,y.createRovingFocusGroupScope)(),[N,D]=P(A),[F,$]=P(A),M=e=>{let{__scopeMenu:r,open:i=!1,children:s,dir:n,onOpenChange:a,modal:o=!0}=e,l=j(r),[u,d]=t.useState(null),h=t.useRef(!1),m=(0,w.useCallbackRef)(a),f=(0,c.useDirection)(n);return t.useEffect(()=>{let e=()=>{h.current=!0,document.addEventListener("pointerdown",t,{capture:!0,once:!0}),document.addEventListener("pointermove",t,{capture:!0,once:!0})},t=()=>h.current=!1;return document.addEventListener("keydown",e,{capture:!0}),()=>{document.removeEventListener("keydown",e,{capture:!0}),document.removeEventListener("pointerdown",t,{capture:!0}),document.removeEventListener("pointermove",t,{capture:!0})}},[]),(0,T.jsx)(p.Root,{...l,children:(0,T.jsx)(N,{scope:r,open:i,onOpenChange:m,content:u,onContentChange:d,children:(0,T.jsx)(F,{scope:r,onClose:t.useCallback(()=>m(!1),[m]),isUsingKeyboardRef:h,dir:f,modal:o,children:s})})})};M.displayName=A;var K=t.forwardRef((e,t)=>{let{__scopeMenu:r,...i}=e,s=j(r);return(0,T.jsx)(p.Anchor,{...s,...i,ref:t})});K.displayName="MenuAnchor";var q="MenuPortal",[L,V]=P(q,{forceMount:void 0}),W=e=>{let{__scopeMenu:t,forceMount:r,children:i,container:s}=e,n=D(q,t);return(0,T.jsx)(L,{scope:t,forceMount:r,children:(0,T.jsx)(f.Presence,{present:r||n.open,children:(0,T.jsx)(m.Portal,{asChild:!0,container:s,children:i})})})};W.displayName=q;var J="MenuContent",[H,B]=P(J),z=t.forwardRef((e,t)=>{let r=V(J,e.__scopeMenu),{forceMount:i=r.forceMount,...s}=e,n=D(J,e.__scopeMenu),a=$(J,e.__scopeMenu);return(0,T.jsx)(I.Provider,{scope:e.__scopeMenu,children:(0,T.jsx)(f.Presence,{present:i||n.open,children:(0,T.jsx)(I.Slot,{scope:e.__scopeMenu,children:a.modal?(0,T.jsx)(Y,{...s,ref:t}):(0,T.jsx)(G,{...s,ref:t})})})})}),Y=t.forwardRef((e,s)=>{let n=D(J,e.__scopeMenu),a=t.useRef(null),o=(0,i.useComposedRefs)(s,a);return t.useEffect(()=>{let e=a.current;if(e)return(0,g.hideOthers)(e)},[]),(0,T.jsx)(Q,{...e,ref:o,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:(0,r.composeEventHandlers)(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),G=t.forwardRef((e,t)=>{let r=D(J,e.__scopeMenu);return(0,T.jsx)(Q,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),X=(0,_.createSlot)("MenuContent.ScrollLock"),Q=t.forwardRef((e,s)=>{let{__scopeMenu:n,loop:a=!1,trapFocus:o,onOpenAutoFocus:c,onCloseAutoFocus:h,disableOutsidePointerEvents:m,onEntryFocus:f,onEscapeKeyDown:_,onPointerDownOutside:w,onFocusOutside:g,onInteractOutside:k,onDismiss:b,disableOutsideScroll:E,...A}=e,I=D(J,n),O=$(J,n),P=j(n),x=U(n),N=R(n),[F,M]=t.useState(null),K=t.useRef(null),q=(0,i.useComposedRefs)(s,K,I.onContentChange),L=t.useRef(0),V=t.useRef(""),W=t.useRef(0),B=t.useRef(null),z=t.useRef("right"),Y=t.useRef(0),G=E?v.RemoveScroll:t.Fragment;t.useEffect(()=>()=>window.clearTimeout(L.current),[]),(0,u.useFocusGuards)();let Q=t.useCallback(e=>{var t,r;return z.current===B.current?.side&&(t=e,!!(r=B.current?.area)&&function(e,t){let{x:r,y:i}=e,s=!1;for(let e=0,n=t.length-1;e<t.length;n=e++){let a=t[e],o=t[n],c=a.x,l=a.y,u=o.x,d=o.y;l>i!=d>i&&r<(u-c)*(i-l)/(d-l)+c&&(s=!s)}return s}({x:t.clientX,y:t.clientY},r))},[]);return(0,T.jsx)(H,{scope:n,searchRef:V,onItemEnter:t.useCallback(e=>{Q(e)&&e.preventDefault()},[Q]),onItemLeave:t.useCallback(e=>{Q(e)||(K.current?.focus(),M(null))},[Q]),onTriggerLeave:t.useCallback(e=>{Q(e)&&e.preventDefault()},[Q]),pointerGraceTimerRef:W,onPointerGraceIntentChange:t.useCallback(e=>{B.current=e},[]),children:(0,T.jsx)(G,{...E?{as:X,allowPinchZoom:!0}:void 0,children:(0,T.jsx)(d.FocusScope,{asChild:!0,trapped:o,onMountAutoFocus:(0,r.composeEventHandlers)(c,e=>{e.preventDefault(),K.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:h,children:(0,T.jsx)(l.DismissableLayer,{asChild:!0,disableOutsidePointerEvents:m,onEscapeKeyDown:_,onPointerDownOutside:w,onFocusOutside:g,onInteractOutside:k,onDismiss:b,children:(0,T.jsx)(y.Root,{asChild:!0,...x,dir:O.dir,orientation:"vertical",loop:a,currentTabStopId:F,onCurrentTabStopIdChange:M,onEntryFocus:(0,r.composeEventHandlers)(f,e=>{O.isUsingKeyboardRef.current||e.preventDefault()}),preventScrollOnEntryFocus:!0,children:(0,T.jsx)(p.Content,{role:"menu","aria-orientation":"vertical","data-state":eE(I.open),"data-radix-menu-content":"",dir:O.dir,...P,...A,ref:q,style:{outline:"none",...A.style},onKeyDown:(0,r.composeEventHandlers)(A.onKeyDown,e=>{let t=e.target.closest("[data-radix-menu-content]")===e.currentTarget,r=e.ctrlKey||e.altKey||e.metaKey,i=1===e.key.length;if(t){var s;let t,n,a,o,c,l;"Tab"===e.key&&e.preventDefault(),!r&&i&&(s=e.key,t=V.current+s,n=N().filter(e=>!e.disabled),a=document.activeElement,o=n.find(e=>e.ref.current===a)?.textValue,c=function(e,t,r){var i;let s=t.length>1&&Array.from(t).every(e=>e===t[0])?t[0]:t,n=r?e.indexOf(r):-1,a=(i=Math.max(n,0),e.map((t,r)=>e[(i+r)%e.length]));1===s.length&&(a=a.filter(e=>e!==r));let o=a.find(e=>e.toLowerCase().startsWith(s.toLowerCase()));return o!==r?o:void 0}(n.map(e=>e.textValue),t,o),l=n.find(e=>e.textValue===c)?.ref.current,function e(t){V.current=t,window.clearTimeout(L.current),""!==t&&(L.current=window.setTimeout(()=>e(""),1e3))}(t),l&&setTimeout(()=>l.focus()))}let n=K.current;if(e.target!==n||!S.includes(e.key))return;e.preventDefault();let a=N().filter(e=>!e.disabled).map(e=>e.ref.current);C.includes(e.key)&&a.reverse(),function(e){let t=document.activeElement;for(let r of e)if(r===t||(r.focus(),document.activeElement!==t))return}(a)}),onBlur:(0,r.composeEventHandlers)(e.onBlur,e=>{e.currentTarget.contains(e.target)||(window.clearTimeout(L.current),V.current="")}),onPointerMove:(0,r.composeEventHandlers)(e.onPointerMove,eR(e=>{let t=e.target,r=Y.current!==e.clientX;e.currentTarget.contains(t)&&r&&(z.current=e.clientX>Y.current?"right":"left",Y.current=e.clientX)}))})})})})})})});z.displayName=J;var Z=t.forwardRef((e,t)=>{let{__scopeMenu:r,...i}=e;return(0,T.jsx)(a.Primitive.div,{role:"group",...i,ref:t})});Z.displayName="MenuGroup";var ee=t.forwardRef((e,t)=>{let{__scopeMenu:r,...i}=e;return(0,T.jsx)(a.Primitive.div,{...i,ref:t})});ee.displayName="MenuLabel";var et="MenuItem",er="menu.itemSelect",ei=t.forwardRef((e,s)=>{let{disabled:n=!1,onSelect:o,...c}=e,l=t.useRef(null),u=$(et,e.__scopeMenu),d=B(et,e.__scopeMenu),h=(0,i.useComposedRefs)(s,l),p=t.useRef(!1);return(0,T.jsx)(es,{...c,ref:h,disabled:n,onClick:(0,r.composeEventHandlers)(e.onClick,()=>{let e=l.current;if(!n&&e){let t=new CustomEvent(er,{bubbles:!0,cancelable:!0});e.addEventListener(er,e=>o?.(e),{once:!0}),(0,a.dispatchDiscreteCustomEvent)(e,t),t.defaultPrevented?p.current=!1:u.onClose()}}),onPointerDown:t=>{e.onPointerDown?.(t),p.current=!0},onPointerUp:(0,r.composeEventHandlers)(e.onPointerUp,e=>{p.current||e.currentTarget?.click()}),onKeyDown:(0,r.composeEventHandlers)(e.onKeyDown,e=>{let t=""!==d.searchRef.current;n||t&&" "===e.key||k.includes(e.key)&&(e.currentTarget.click(),e.preventDefault())})})});ei.displayName=et;var es=t.forwardRef((e,s)=>{let{__scopeMenu:n,disabled:o=!1,textValue:c,...l}=e,u=B(et,n),d=U(n),h=t.useRef(null),p=(0,i.useComposedRefs)(s,h),[m,f]=t.useState(!1),[_,w]=t.useState("");return t.useEffect(()=>{let e=h.current;e&&w((e.textContent??"").trim())},[l.children]),(0,T.jsx)(I.ItemSlot,{scope:n,disabled:o,textValue:c??_,children:(0,T.jsx)(y.Item,{asChild:!0,...d,focusable:!o,children:(0,T.jsx)(a.Primitive.div,{role:"menuitem","data-highlighted":m?"":void 0,"aria-disabled":o||void 0,"data-disabled":o?"":void 0,...l,ref:p,onPointerMove:(0,r.composeEventHandlers)(e.onPointerMove,eR(e=>{o?u.onItemLeave(e):(u.onItemEnter(e),e.defaultPrevented||e.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:(0,r.composeEventHandlers)(e.onPointerLeave,eR(e=>u.onItemLeave(e))),onFocus:(0,r.composeEventHandlers)(e.onFocus,()=>f(!0)),onBlur:(0,r.composeEventHandlers)(e.onBlur,()=>f(!1))})})})}),en=t.forwardRef((e,t)=>{let{checked:i=!1,onCheckedChange:s,...n}=e;return(0,T.jsx)(ep,{scope:e.__scopeMenu,checked:i,children:(0,T.jsx)(ei,{role:"menuitemcheckbox","aria-checked":eA(i)?"mixed":i,...n,ref:t,"data-state":eI(i),onSelect:(0,r.composeEventHandlers)(n.onSelect,()=>s?.(!!eA(i)||!i),{checkForDefaultPrevented:!1})})})});en.displayName="MenuCheckboxItem";var ea="MenuRadioGroup",[eo,ec]=P(ea,{value:void 0,onValueChange:()=>{}}),el=t.forwardRef((e,t)=>{let{value:r,onValueChange:i,...s}=e,n=(0,w.useCallbackRef)(i);return(0,T.jsx)(eo,{scope:e.__scopeMenu,value:r,onValueChange:n,children:(0,T.jsx)(Z,{...s,ref:t})})});el.displayName=ea;var eu="MenuRadioItem",ed=t.forwardRef((e,t)=>{let{value:i,...s}=e,n=ec(eu,e.__scopeMenu),a=i===n.value;return(0,T.jsx)(ep,{scope:e.__scopeMenu,checked:a,children:(0,T.jsx)(ei,{role:"menuitemradio","aria-checked":a,...s,ref:t,"data-state":eI(a),onSelect:(0,r.composeEventHandlers)(s.onSelect,()=>n.onValueChange?.(i),{checkForDefaultPrevented:!1})})})});ed.displayName=eu;var eh="MenuItemIndicator",[ep,em]=P(eh,{checked:!1}),ef=t.forwardRef((e,t)=>{let{__scopeMenu:r,forceMount:i,...s}=e,n=em(eh,r);return(0,T.jsx)(f.Presence,{present:i||eA(n.checked)||!0===n.checked,children:(0,T.jsx)(a.Primitive.span,{...s,ref:t,"data-state":eI(n.checked)})})});ef.displayName=eh;var ey=t.forwardRef((e,t)=>{let{__scopeMenu:r,...i}=e;return(0,T.jsx)(a.Primitive.div,{role:"separator","aria-orientation":"horizontal",...i,ref:t})});ey.displayName="MenuSeparator";var e_=t.forwardRef((e,t)=>{let{__scopeMenu:r,...i}=e,s=j(r);return(0,T.jsx)(p.Arrow,{...s,...i,ref:t})});e_.displayName="MenuArrow";var ew="MenuSub",[eg,ev]=P(ew),eT=e=>{let{__scopeMenu:r,children:i,open:s=!1,onOpenChange:n}=e,a=D(ew,r),o=j(r),[c,l]=t.useState(null),[u,d]=t.useState(null),m=(0,w.useCallbackRef)(n);return t.useEffect(()=>(!1===a.open&&m(!1),()=>m(!1)),[a.open,m]),(0,T.jsx)(p.Root,{...o,children:(0,T.jsx)(N,{scope:r,open:s,onOpenChange:m,content:u,onContentChange:d,children:(0,T.jsx)(eg,{scope:r,contentId:(0,h.useId)(),triggerId:(0,h.useId)(),trigger:c,onTriggerChange:l,children:i})})})};eT.displayName=ew;var ek="MenuSubTrigger",eC=t.forwardRef((e,s)=>{let n=D(ek,e.__scopeMenu),a=$(ek,e.__scopeMenu),o=ev(ek,e.__scopeMenu),c=B(ek,e.__scopeMenu),l=t.useRef(null),{pointerGraceTimerRef:u,onPointerGraceIntentChange:d}=c,h={__scopeMenu:e.__scopeMenu},p=t.useCallback(()=>{l.current&&window.clearTimeout(l.current),l.current=null},[]);return t.useEffect(()=>p,[p]),t.useEffect(()=>{let e=u.current;return()=>{window.clearTimeout(e),d(null)}},[u,d]),(0,T.jsx)(K,{asChild:!0,...h,children:(0,T.jsx)(es,{id:o.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":o.contentId,"data-state":eE(n.open),...e,ref:(0,i.composeRefs)(s,o.onTriggerChange),onClick:t=>{e.onClick?.(t),e.disabled||t.defaultPrevented||(t.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:(0,r.composeEventHandlers)(e.onPointerMove,eR(t=>{c.onItemEnter(t),!t.defaultPrevented&&(e.disabled||n.open||l.current||(c.onPointerGraceIntentChange(null),l.current=window.setTimeout(()=>{n.onOpenChange(!0),p()},100)))})),onPointerLeave:(0,r.composeEventHandlers)(e.onPointerLeave,eR(e=>{p();let t=n.content?.getBoundingClientRect();if(t){let r=n.content?.dataset.side,i="right"===r,s=t[i?"left":"right"],a=t[i?"right":"left"];c.onPointerGraceIntentChange({area:[{x:e.clientX+(i?-5:5),y:e.clientY},{x:s,y:t.top},{x:a,y:t.top},{x:a,y:t.bottom},{x:s,y:t.bottom}],side:r}),window.clearTimeout(u.current),u.current=window.setTimeout(()=>c.onPointerGraceIntentChange(null),300)}else{if(c.onTriggerLeave(e),e.defaultPrevented)return;c.onPointerGraceIntentChange(null)}})),onKeyDown:(0,r.composeEventHandlers)(e.onKeyDown,t=>{let r=""!==c.searchRef.current;e.disabled||r&&" "===t.key||b[a.dir].includes(t.key)&&(n.onOpenChange(!0),n.content?.focus(),t.preventDefault())})})})});eC.displayName=ek;var eS="MenuSubContent",eb=t.forwardRef((e,s)=>{let n=V(J,e.__scopeMenu),{forceMount:a=n.forceMount,...o}=e,c=D(J,e.__scopeMenu),l=$(J,e.__scopeMenu),u=ev(eS,e.__scopeMenu),d=t.useRef(null),h=(0,i.useComposedRefs)(s,d);return(0,T.jsx)(I.Provider,{scope:e.__scopeMenu,children:(0,T.jsx)(f.Presence,{present:a||c.open,children:(0,T.jsx)(I.Slot,{scope:e.__scopeMenu,children:(0,T.jsx)(Q,{id:u.contentId,"aria-labelledby":u.triggerId,...o,ref:h,align:"start",side:"rtl"===l.dir?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:e=>{l.isUsingKeyboardRef.current&&d.current?.focus(),e.preventDefault()},onCloseAutoFocus:e=>e.preventDefault(),onFocusOutside:(0,r.composeEventHandlers)(e.onFocusOutside,e=>{e.target!==u.trigger&&c.onOpenChange(!1)}),onEscapeKeyDown:(0,r.composeEventHandlers)(e.onEscapeKeyDown,e=>{l.onClose(),e.preventDefault()}),onKeyDown:(0,r.composeEventHandlers)(e.onKeyDown,e=>{let t=e.currentTarget.contains(e.target),r=E[l.dir].includes(e.key);t&&r&&(c.onOpenChange(!1),u.trigger?.focus(),e.preventDefault())})})})})})});function eE(e){return e?"open":"closed"}function eA(e){return"indeterminate"===e}function eI(e){return eA(e)?"indeterminate":e?"checked":"unchecked"}function eR(e){return t=>"mouse"===t.pointerType?e(t):void 0}eb.displayName=eS;var eO="DropdownMenu",[eP,ex]=(0,s.createContextScope)(eO,[x]),ej=x(),[eU,eN]=eP(eO),eD=e=>{let{__scopeDropdownMenu:r,children:i,dir:s,open:a,defaultOpen:o,onOpenChange:c,modal:l=!0}=e,u=ej(r),d=t.useRef(null),[p,m]=(0,n.useControllableState)({prop:a,defaultProp:o??!1,onChange:c,caller:eO});return(0,T.jsx)(eU,{scope:r,triggerId:(0,h.useId)(),triggerRef:d,contentId:(0,h.useId)(),open:p,onOpenChange:m,onOpenToggle:t.useCallback(()=>m(e=>!e),[m]),modal:l,children:(0,T.jsx)(M,{...u,open:p,onOpenChange:m,dir:s,modal:l,children:i})})};eD.displayName=eO;var eF="DropdownMenuTrigger",e$=t.forwardRef((e,t)=>{let{__scopeDropdownMenu:s,disabled:n=!1,...o}=e,c=eN(eF,s),l=ej(s);return(0,T.jsx)(K,{asChild:!0,...l,children:(0,T.jsx)(a.Primitive.button,{type:"button",id:c.triggerId,"aria-haspopup":"menu","aria-expanded":c.open,"aria-controls":c.open?c.contentId:void 0,"data-state":c.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...o,ref:(0,i.composeRefs)(t,c.triggerRef),onPointerDown:(0,r.composeEventHandlers)(e.onPointerDown,e=>{!n&&0===e.button&&!1===e.ctrlKey&&(c.onOpenToggle(),c.open||e.preventDefault())}),onKeyDown:(0,r.composeEventHandlers)(e.onKeyDown,e=>{!n&&(["Enter"," "].includes(e.key)&&c.onOpenToggle(),"ArrowDown"===e.key&&c.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(e.key)&&e.preventDefault())})})})});e$.displayName=eF;var eM=e=>{let{__scopeDropdownMenu:t,...r}=e,i=ej(t);return(0,T.jsx)(W,{...i,...r})};eM.displayName="DropdownMenuPortal";var eK="DropdownMenuContent",eq=t.forwardRef((e,i)=>{let{__scopeDropdownMenu:s,...n}=e,a=eN(eK,s),o=ej(s),c=t.useRef(!1);return(0,T.jsx)(z,{id:a.contentId,"aria-labelledby":a.triggerId,...o,...n,ref:i,onCloseAutoFocus:(0,r.composeEventHandlers)(e.onCloseAutoFocus,e=>{c.current||a.triggerRef.current?.focus(),c.current=!1,e.preventDefault()}),onInteractOutside:(0,r.composeEventHandlers)(e.onInteractOutside,e=>{let t=e.detail.originalEvent,r=0===t.button&&!0===t.ctrlKey,i=2===t.button||r;(!a.modal||i)&&(c.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});eq.displayName=eK;var eL=t.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...i}=e,s=ej(r);return(0,T.jsx)(Z,{...s,...i,ref:t})});eL.displayName="DropdownMenuGroup";var eV=t.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...i}=e,s=ej(r);return(0,T.jsx)(ee,{...s,...i,ref:t})});eV.displayName="DropdownMenuLabel";var eW=t.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...i}=e,s=ej(r);return(0,T.jsx)(ei,{...s,...i,ref:t})});eW.displayName="DropdownMenuItem";var eJ=t.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...i}=e,s=ej(r);return(0,T.jsx)(en,{...s,...i,ref:t})});eJ.displayName="DropdownMenuCheckboxItem";var eH=t.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...i}=e,s=ej(r);return(0,T.jsx)(el,{...s,...i,ref:t})});eH.displayName="DropdownMenuRadioGroup";var eB=t.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...i}=e,s=ej(r);return(0,T.jsx)(ed,{...s,...i,ref:t})});eB.displayName="DropdownMenuRadioItem";var ez=t.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...i}=e,s=ej(r);return(0,T.jsx)(ef,{...s,...i,ref:t})});ez.displayName="DropdownMenuItemIndicator";var eY=t.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...i}=e,s=ej(r);return(0,T.jsx)(ey,{...s,...i,ref:t})});eY.displayName="DropdownMenuSeparator";var eG=t.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...i}=e,s=ej(r);return(0,T.jsx)(e_,{...s,...i,ref:t})});eG.displayName="DropdownMenuArrow";var eX=t.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...i}=e,s=ej(r);return(0,T.jsx)(eC,{...s,...i,ref:t})});eX.displayName="DropdownMenuSubTrigger";var eQ=t.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...i}=e,s=ej(r);return(0,T.jsx)(eb,{...s,...i,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});eQ.displayName="DropdownMenuSubContent";var eZ=e=>{let{__scopeDropdownMenu:t,children:r,open:i,onOpenChange:s,defaultOpen:a}=e,o=ej(t),[c,l]=(0,n.useControllableState)({prop:i,defaultProp:a??!1,onChange:s,caller:"DropdownMenuSub"});return(0,T.jsx)(eT,{...o,open:c,onOpenChange:l,children:r})};e.s(["Arrow",()=>eG,"CheckboxItem",()=>eJ,"Content",()=>eq,"Group",()=>eL,"Item",()=>eW,"ItemIndicator",()=>ez,"Label",()=>eV,"Portal",()=>eM,"RadioGroup",()=>eH,"RadioItem",()=>eB,"Root",()=>eD,"Separator",()=>eY,"Sub",()=>eZ,"SubContent",()=>eQ,"SubTrigger",()=>eX,"Trigger",()=>e$],948247)}]);