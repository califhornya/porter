(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,412041,e=>{"use strict";var a=e.i(662790),r=e.i(106772),t=e.i(995403),n=e.i(125677),d=e.i(292405),i=e.i(187215),s=e.i(44762),l=e.i(287950),c=e.i(519273);let o=(0,e.i(383206).default)("calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);var p=e.i(519455),u=e.i(677572);function m({activeTab:e,onTabChange:n,deck:d,onCardAdd:i,onCardRemove:l,onFilterChange:c,onSortChange:m}){let[y,E]=(0,r.useState)(!1);if(!e||!n||!d||!i||!l||!c||!m)return null;let f=d.mainDeck.reduce((e,a)=>e+a.count,0)+d.champions.reduce((e,a)=>e+a.count,0),{data:g,refetch:h}=(0,s.useTRPCQuery)(({cards:e})=>e.search.queryOptions({type:"Rune"},{enabled:!1})),S=async()=>{if(0===f)return void t.toast.error("Please add some cards to your deck first");E(!0);try{let e,a=(e=new Map,[...d.mainDeck,...d.champions].forEach(({card:a,count:r})=>{let t=a.power||0,n=a.cardColors||[];if(0===n.length){let a=e.get("Colorless")||0;e.set("Colorless",a+t*r)}else{let a=t*r/n.length;n.forEach(({color:r})=>{let t=e.get(r.name)||0;e.set(r.name,t+a)})}}),e),r=g;if(r||(r=(await h()).data),!r||0===r.length)return void t.toast.error("No rune cards found");d.runes.forEach(e=>{l(e.card,e.variantId)});let n=Array.from(a.values()).reduce((e,a)=>e+a,0),s=Array.from(a.entries()).sort(([,e],[,a])=>a-e).filter(([,e])=>e>0);if(0===s.length)return void t.toast.error("No colored cards found in deck");let c=12,o=new Map;if(s.forEach(([e,a])=>{if(c<=0)return;let r=Math.round(a/n*12),t=Math.min(r,c);t>0&&(o.set(e,t),c-=t)}),c>0&&s.length>0){let e=s[0];if(e){let a=e[0],r=o.get(a)||0;o.set(a,r+c)}}let p=0;for(let[e,a]of o){if(p>=12)break;let t=r.filter(a=>a.cardColors?.some(a=>a.color.name===e));if(0!==t.length)for(let e=0;e<a&&p<12;e++){let a=t[e%t.length];if(!a)continue;let r=a.cardVariants?.find(e=>"Standard"===e.variantType);r&&(i(a,r.id),p++)}}t.toast.success(`Added ${p} runes to your deck`)}catch(e){console.error("Error calculating runes:",e),t.toast.error("Failed to calculate runes")}finally{E(!1)}},_=a=>{if("legend"===e&&!d.legend&&"legend"!==a)return void t.toast.error("Please select a legend first");if("legend"===a&&"legend"===e&&d.legend)return void t.toast.info("Legend already selected. Choose a different card or switch to another tab.");switch(n(a),a){case"legend":c({type:"SET_CARD_TYPE",payload:"Legend",tabInitiated:!0});break;case"mainDeck":c({type:"SET_CARD_TYPE",payload:"all",tabInitiated:!0}),m("energy_asc");break;case"battlefields":c({type:"SET_CARD_TYPE",payload:"Battlefield",tabInitiated:!0}),m("id_asc");break;case"runes":c({type:"SET_CARD_TYPE",payload:"Rune",tabInitiated:!0}),m("id_asc")}};return(0,r.useEffect)(()=>{"legend"===e&&d.legend&&_("mainDeck")},[d.legend,e]),(0,a.jsxs)(u.Tabs,{value:e,onValueChange:_,className:"mb-4",children:[(0,a.jsxs)(u.TabsList,{className:"grid w-full grid-cols-4",children:[(0,a.jsx)(u.TabsTrigger,{value:"legend",children:"Legend"}),(0,a.jsx)(u.TabsTrigger,{value:"mainDeck",children:"Main Deck"}),(0,a.jsx)(u.TabsTrigger,{value:"battlefields",children:"Battlefields"}),(0,a.jsx)(u.TabsTrigger,{value:"runes",children:"Runes"})]}),(0,a.jsx)(u.TabsContent,{value:"runes",className:"mt-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-center p-2 bg-muted/30 rounded-lg",children:[(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:[d.runes.reduce((e,a)=>e+a.count,0)," runes selected"]}),(0,a.jsx)(p.Button,{variant:"outline",size:"sm",onClick:S,disabled:y||0===f||d.runes.length>0,children:y?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-current mr-2"}),"Calculating..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o,{className:"mr-2 h-3 w-3"}),"Calculate Runes"]})})]})})]})}var y=e.i(688031),E=e.i(911106);let f=0,g=()=>{if(performance.memory){let e=performance.memory;console.log(`[CardLibrary MEMORY] Instances: ${f}, Used: ${(e.usedJSHeapSize/1024/1024).toFixed(2)}MB, Limit: ${(e.jsHeapSizeLimit/1024/1024).toFixed(2)}MB`)}},h=e=>({...e,cardColors:e.cardColors?.map(e=>({color:{...e.color,hexCode:e.color.hexCode||"#000000"}})),cardVariants:e.cardVariants?.map(e=>({...e,set:{prefix:e.set.prefix,name:e.set.name}}))}),S=(0,r.memo)(function({onCardClick:e=()=>{},dialogTrigger:o="left",defaultSearchType:p,defaultViewMode:u="compact",legend:S,deck:_,showDeckBuilderTabs:T=!1,activeTab:R,onTabChange:b,onCardAdd:C,onCardRemove:v,isSideboardMode:x=!1,deckJustCleared:A,onDeckClearHandled:w,onMyCollectionPage:N=!1}){let[k,M]=(0,r.useState)(6),[j,D]=(0,r.useState)(!1),[L,O]=(0,r.useState)("id_asc"),[P,V]=(0,r.useState)(u);(0,r.useEffect)(()=>{f++,console.log(`[CardLibrary] Mounted (total instances: ${f})`),g();let e=setInterval(g,3e4);return()=>{f--,console.log(`[CardLibrary] Unmounted (remaining instances: ${f})`),g(),clearInterval(e)}},[]),(0,r.useEffect)(()=>{let e=document.querySelector(".card-library-container");if(!e)return;let a=new ResizeObserver(e=>{let a;if(j)return;let r=e[0]?.contentRect.width??0;a=r<768?2:r<1024?4:r<1280?5:r<1536||r<2048?6:r<2560?7:9,M(T&&"battlefields"===R?Math.max(1,a-2):a)});return a.observe(e),()=>a.disconnect()},[j,T,R]);let[G,I]=(0,r.useReducer)(E.filterReducer,p?{...E.initialFilterState,selectedCardType:p}:E.initialFilterState),z=e=>{if("legend"===R||"battlefields"===R||"runes"===R){if(["SET_CARD_TYPE","SET_CARD_SUPER","SET_ENERGY_RANGE","SET_POWER_RANGE","SET_MIGHT_RANGE"].includes(e.type)){let e="legend"===R?"a legend":R;t.toast.error(`Cannot change this filter while selecting ${e}`);return}if("SET_SEARCH_TERM"===e.type&&function(e){if(!e)return!1;let a=e.toLowerCase();return["t:","type:","s:","super:","e:","energy:","p:","power:","pow:","m:","might:"].some(e=>a.includes(e))}(e.payload)){let e="legend"===R?"a legend":R;t.toast.error(`Cannot use type, energy, power, or might search while selecting ${e}`);return}if("RESET_FILTERS"===e.type){let a=G.selectedCardType;I(e),setTimeout(()=>{I({type:"SET_CARD_TYPE",payload:a})},0);return}}I(e)},F=(0,c.useDebounce)(G.searchTerm,500),{isAdvancedSearchEnabled:Y,setAdvancedSearchEnabled:H,isLoaded:B}=(0,l.useAdvancedSearch)();(0,r.useEffect)(()=>{B&&G.advancedSearchEnabled!==Y&&I({type:"SET_ADVANCED_SEARCH",payload:Y})},[B,Y,G.advancedSearchEnabled]),(0,r.useEffect)(()=>{if(S?.card?.cardColors&&S.card.cardColors.length>0){let e={Fury:"0f140bf1-6883-4318-aff4-2343efde718a",Calm:"4583bc2e-da65-492f-97dc-4876988048d7",Mind:"a403eb32-08aa-422b-889b-00e27b5b92ba",Body:"02b224ab-6514-4c74-9df0-532191b25418",Chaos:"cd53b80d-4394-447b-9e68-cb6996185203",Order:"4e77b844-6896-4d5e-9f2d-d07b40f6039f"};I({type:"SET_COLORS_FROM_LEGEND",payload:S.card.cardColors.map(a=>e[a.color.name]).filter(e=>e)})}else I({type:"SET_COLORS_FROM_LEGEND",payload:[]})},[S]),(0,r.useEffect)(()=>{A&&"legend"===R&&(I({type:"SET_CARD_TYPE",payload:"Legend"}),w?.())},[A,R,w]);let{data:U,isLoading:$}=(0,s.useTRPCQuery)(({cards:e})=>e.search.queryOptions({searchQuery:F,colorIds:G.selectedColors,type:"all"===G.selectedCardType?void 0:G.selectedCardType,super:"all"===G.selectedCardSuper?void 0:G.selectedCardSuper,rarity:"all"===G.selectedRarity?void 0:G.selectedRarity,setName:"all"===G.selectedSet?void 0:G.selectedSet,energyRange:{min:G.energyRange[0],max:G.energyRange[1]},mightRange:{min:G.mightRange[0],max:G.mightRange[1]},powerRange:{min:G.powerRange[0],max:G.powerRange[1]},advancedSearchEnabled:G.advancedSearchEnabled})),W=(0,r.useMemo)(()=>{if(!U)return[];let e=[...U];if(T&&"mainDeck"===R)if(e=e.filter(e=>!["Legend","Battlefield","Rune"].includes(e.type)),_?.legend?.card){let a=_.legend.card.tags||[];e=e.filter(e=>{if("Signature"!==e.super)return!0;if(0===a.length)return!1;let r=e.tags||[];if(0===r.length)return!1;let t=a.map(e=>e.toLowerCase());return r.map(e=>e.toLowerCase()).some(e=>t.includes(e))})}else e=e.filter(e=>"Signature"!==e.super);return e.sort((e,a)=>{switch(L){case"name_asc":return e.name.localeCompare(a.name);case"name_desc":return a.name.localeCompare(e.name);case"id_asc":let r=e.cardVariants?.find(e=>"Standard"===e.variantType)?.variantNumber??e.cardVariants?.[0]?.variantNumber??"",t=a.cardVariants?.find(e=>"Standard"===e.variantType)?.variantNumber??a.cardVariants?.[0]?.variantNumber??"",n=e.cardVariants?.find(e=>"Standard"===e.variantType)?.set?.prefix??e.cardVariants?.[0]?.set?.prefix??"",d=a.cardVariants?.find(e=>"Standard"===e.variantType)?.set?.prefix??a.cardVariants?.[0]?.set?.prefix??"",i=n.localeCompare(d);if(0!==i)return i;let s=r.match(/(\d+)([a-z]*)/i),l=t.match(/(\d+)([a-z]*)/i),c=s?.[1]??"0",o=s?.[2]??"",p=l?.[1]??"0",u=l?.[2]??"",m=parseInt(c)-parseInt(p);if(0!==m)return m;return o.localeCompare(u);case"id_desc":let y=e.cardVariants?.find(e=>"Standard"===e.variantType)?.variantNumber??e.cardVariants?.[0]?.variantNumber??"",E=a.cardVariants?.find(e=>"Standard"===e.variantType)?.variantNumber??a.cardVariants?.[0]?.variantNumber??"",f=e.cardVariants?.find(e=>"Standard"===e.variantType)?.set?.prefix??e.cardVariants?.[0]?.set?.prefix??"",g=(a.cardVariants?.find(e=>"Standard"===e.variantType)?.set?.prefix??a.cardVariants?.[0]?.set?.prefix??"").localeCompare(f);if(0!==g)return g;let h=y.match(/(\d+)([a-z]*)/i),S=E.match(/(\d+)([a-z]*)/i),_=h?.[1]??"0",T=h?.[2]??"",R=S?.[1]??"0",b=S?.[2]??"",C=parseInt(R)-parseInt(_);if(0!==C)return C;return b.localeCompare(T);case"might_asc":return(e.might??0)-(a.might??0);case"might_desc":return(a.might??0)-(e.might??0);case"power_asc":return(e.power??0)-(a.power??0);case"power_desc":return(a.power??0)-(e.power??0);case"energy_asc":let v=(e.energy??0)-(a.energy??0);if(0!==v)return v;let x=(e.power??0)-(a.power??0);if(0!==x)return x;return(e.might??0)-(a.might??0);case"energy_desc":let A=(a.energy??0)-(e.energy??0);if(0!==A)return A;let w=(a.power??0)-(e.power??0);if(0!==w)return w;return(a.might??0)-(e.might??0);default:return 0}}),e},[U,L,P,G.selectedRarity,T,R,_]),q=(0,r.useMemo)(()=>{if("full"!==P||!U)return[];let e=U.flatMap(e=>"Showcase"===G.selectedRarity?e.cardVariants?.filter(e=>"Showcase"===e.rarity&&["Alt Art","Overnumbered","Overnumbered Signed"].includes(e.variantType)).map(a=>({card:e,variant:a,variantNumber:a.variantNumber,setPrefix:a.set?.prefix??""}))??[]:e.cardVariants?.map(a=>({card:e,variant:a,variantNumber:a.variantNumber,setPrefix:a.set?.prefix??""}))??[]);if(T&&"mainDeck"===R)if(e=e.filter(({card:e})=>!["Legend","Battlefield","Rune"].includes(e.type)&&!["Token"].includes(e.super??"")),_?.legend?.card){let a=_.legend.card.tags||[];e=e.filter(({card:e})=>{if("Signature"!==e.super)return!0;if(0===a.length)return!1;let r=e.tags||[];if(0===r.length)return!1;let t=a.map(e=>e.toLowerCase());return r.map(e=>e.toLowerCase()).some(e=>t.includes(e))})}else e=e.filter(({card:e})=>"Signature"!==e.super);return e.sort((e,a)=>{if("id_asc"===L||"id_desc"===L){let r="id_asc"===L?e.setPrefix.localeCompare(a.setPrefix):a.setPrefix.localeCompare(e.setPrefix);if(0!==r)return r;let t=e.variantNumber.match(/(\d+)([a-z]*)/i),n=a.variantNumber.match(/(\d+)([a-z]*)/i),d=t?.[1]??"0",i=t?.[2]??"",s=n?.[1]??"0",l=n?.[2]??"",c="id_asc"===L?parseInt(d)-parseInt(s):parseInt(s)-parseInt(d);return 0!==c?c:"id_asc"===L?i.localeCompare(l):l.localeCompare(i)}let r=e.card,t=a.card;switch(L){case"name_asc":return r.name.localeCompare(t.name);case"name_desc":return t.name.localeCompare(r.name);case"might_asc":return(r.might??0)-(t.might??0);case"might_desc":return(t.might??0)-(r.might??0);case"power_asc":return(r.power??0)-(t.power??0);case"power_desc":return(t.power??0)-(r.power??0);case"energy_asc":let n=(r.energy??0)-(t.energy??0);if(0!==n)return n;let d=(r.power??0)-(t.power??0);if(0!==d)return d;return(r.might??0)-(t.might??0);case"energy_desc":let i=(t.energy??0)-(r.energy??0);if(0!==i)return i;let s=(t.power??0)-(r.power??0);if(0!==s)return s;return(t.might??0)-(r.might??0);default:return 0}})},[U,L,P,G.selectedRarity,T,R,_]);return(0,a.jsxs)("div",{className:"w-full card-library-container",children:[(0,a.jsx)(d.default,{filterState:G,activeTab:R,onFilterChange:e=>{switch(e.type){case"SET_SEARCH_TERM":z({type:"SET_SEARCH_TERM",payload:e.payload});break;case"SET_COLORS":z({type:"SET_COLORS",payload:e.payload});break;case"SET_COLORS_FROM_LEGEND":z({type:"SET_COLORS_FROM_LEGEND",payload:e.payload});break;case"SET_CARD_TYPE":z({type:"SET_CARD_TYPE",payload:e.payload});break;case"SET_CARD_SUPER":z({type:"SET_CARD_SUPER",payload:e.payload});break;case"SET_RARITY":z({type:"SET_RARITY",payload:e.payload});break;case"SET_SET":z({type:"SET_SET",payload:e.payload});break;case"SET_ENERGY_RANGE":z({type:"SET_ENERGY_RANGE",payload:e.payload});break;case"SET_MIGHT_RANGE":z({type:"SET_MIGHT_RANGE",payload:e.payload});break;case"SET_POWER_RANGE":z({type:"SET_POWER_RANGE",payload:e.payload});break;case"SET_ADVANCED_SEARCH":z({type:"SET_ADVANCED_SEARCH",payload:e.payload});break;case"RESET_FILTERS":z({type:"RESET_FILTERS"})}},isAdvancedSearchEnabled:Y,setAdvancedSearchEnabled:H,isAdvancedSearchLoaded:B}),T&&R&&b&&C&&v&&_&&(0,a.jsx)(m,{activeTab:R,onTabChange:b,deck:_,onCardAdd:C,onCardRemove:v,onFilterChange:e=>{if(e.tabInitiated)switch(e.type){case"SET_SEARCH_TERM":I({type:"SET_SEARCH_TERM",payload:e.payload});break;case"SET_CARD_TYPE":I({type:"SET_CARD_TYPE",payload:e.payload});break;default:z(e)}else switch(e.type){case"SET_SEARCH_TERM":z({type:"SET_SEARCH_TERM",payload:e.payload});break;case"SET_COLORS":z({type:"SET_COLORS",payload:e.payload});break;case"SET_COLORS_FROM_LEGEND":z({type:"SET_COLORS_FROM_LEGEND",payload:e.payload});break;case"SET_CARD_TYPE":z({type:"SET_CARD_TYPE",payload:e.payload});break;case"SET_CARD_SUPER":z({type:"SET_CARD_SUPER",payload:e.payload});break;case"SET_RARITY":z({type:"SET_RARITY",payload:e.payload});break;case"SET_SET":z({type:"SET_SET",payload:e.payload});break;case"SET_ENERGY_RANGE":z({type:"SET_ENERGY_RANGE",payload:e.payload});break;case"SET_MIGHT_RANGE":z({type:"SET_MIGHT_RANGE",payload:e.payload});break;case"SET_POWER_RANGE":z({type:"SET_POWER_RANGE",payload:e.payload});break;case"SET_ADVANCED_SEARCH":z({type:"SET_ADVANCED_SEARCH",payload:e.payload});break;case"RESET_FILTERS":z({type:"RESET_FILTERS"})}},isAdvancedSearchEnabled:Y,setAdvancedSearchEnabled:H,isAdvancedSearchLoaded:B,onSortChange:O}),$?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"text-sm text-zinc-400 flex items-center gap-4",children:[(0,a.jsx)("div",{className:"h-8 w-8 rounded-md bg-zinc-800 animate-pulse"}),(0,a.jsx)("div",{className:"h-4 w-32 rounded-md bg-zinc-800 animate-pulse"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"h-8 w-[180px] rounded-md bg-zinc-800 animate-pulse"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"h-8 w-8 rounded-md bg-zinc-800 animate-pulse"}),(0,a.jsx)("div",{className:"h-4 w-4 rounded-md bg-zinc-800 animate-pulse"}),(0,a.jsx)("div",{className:"h-8 w-8 rounded-md bg-zinc-800 animate-pulse"})]})]})]}),(0,a.jsx)("div",{className:"grid gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6",children:Array.from({length:50}).map((e,r)=>(0,a.jsx)(i.default,{},r))})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(y.default,{cardCount:"compact"===P?W.length:q.length,sortBy:L,onSortChange:O,gridSize:k,onGridSizeChange:e=>{M(e),D(!0)},viewMode:P,setViewMode:V,isLoading:$}),0===W.length?(0,a.jsx)("div",{className:"flex h-32 items-center justify-center rounded-lg border border-zinc-800 bg-zinc-900/50",children:(0,a.jsx)("p",{className:"text-lg text-zinc-400",children:"No cards found matching your filters"})}):(0,a.jsx)("div",{className:"grid gap-4",style:{gridTemplateColumns:`repeat(${k}, minmax(0, 1fr))`},children:"compact"===P?W.map(r=>{let t=r.cardVariants?.find(e=>"Standard"===e.variantType);"Showcase"===G.selectedRarity&&(t=r.cardVariants?.find(e=>"Showcase"===e.rarity&&["Alt Art","Overnumbered","Overnumbered Signed"].includes(e.variantType))||r.cardVariants?.find(e=>"Standard"===e.variantType));let d=T&&"battlefields"===R?"landscape":"portrait";return(0,a.jsx)(n.default,{card:h(r),viewMode:P,onCardClick:(a,r,t)=>{"remove"===t&&v?v(h(a),r):"add"===t&&C?C(h(a),r):e&&e(h(a),r)},dialogTrigger:o,chosenVariant:t?.id,deck:_,orientation:d,isSideboardMode:x,showCollectionCounter:N},r.id)}):q.map(({card:r,variant:t})=>{let d=T&&"battlefields"===R?"landscape":"portrait";return(0,a.jsx)(n.default,{card:h(r),viewMode:P,onCardClick:(a,r,t)=>{"remove"===t&&v?v(h(a),r):"add"===t&&C?C(h(a),r):e&&e(h(a),r)},dialogTrigger:o,chosenVariant:t.id,deck:_,orientation:d,isSideboardMode:x,showCollectionCounter:N},t.id)})})]})]})});e.s(["default",0,S],412041)}]);